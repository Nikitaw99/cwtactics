{"src_const/stub.js":{"code":"/** the global object which is shared between every module. */\r\ncwt = {};\r\n","lastModified":1455991613939},"src_const/base.js":{"code":"INACTIVE_ID = -1;\r\nDESELECT_ID = -2;\r\n\r\nACTIONS_BUFFER_SIZE = 200;\r\n\r\nMAX_PLAYERS = 4;\r\nMAX_UNITS = 50;\r\nMAX_MAP_WIDTH = 100;\r\nMAX_MAP_HEIGHT = 100;\r\nMAX_PROPERTIES = 300;\r\nMAX_SELECTION_RANGE = 15;\r\nMAX_BUFFER_SIZE = 200;\r\nTILE_LENGTH = 16;\r\n\r\nVERSION = \"0.3.6\";\r\nAI_VERSION = \"DumbBoy v. 0.1 Alpha\";","lastModified":1456566780638},"src_const/dev.js":{"code":"DEBUG = true;\r\nMOD_PATH = \"http://localhost/src_gamedata/\";\r\n","lastModified":1455991613923},"src_new/core/asserts.js":{"code":"cwt.assert_true = function(expr, msg) {\r\n  if (!expr) {\r\n    throw new Error(msg || \"AssertionFailed: expression is not true\");\r\n  }\r\n};\r\n\r\ncwt.assert_fails = function(callback, msg) {\r\n  try {\r\n    callback();\r\n    throw new Error(msg || \"AssertionFailed: callback does not thrown an error\");\r\n  } catch (ignore) {}\r\n};\r\n\r\ncwt.assert_equals = function(actual, expected, msg) {\r\n  if (actual !== expected) {\r\n    throw new Error(msg || \"AssertionFailed: actual and expected are not the same\");\r\n  }\r\n};\r\n\r\ncwt.assert_not_equals = function(actual, expected, msg) {\r\n  if (actual === expected) {\r\n    throw new Error(msg || \"AssertionFailed: actual and expected are the same\");\r\n  }\r\n};\r\n\r\n/**\r\n * asserts that two arrays contains the same content.\r\n *\r\n * @throws {Error} when arrays are not equal\r\n * @param {Array}  actual_array            left array\r\n * @param {Array}  expected_array          right array\r\n * @param {string} [msg=\"AssertionFailed:] message that will be used as error\r\n */\r\ncwt.assert_array_equals = function(actual_array, expected_array, msg) {\r\n  var i, e;\r\n\r\n  msg = msg || \"AssertionFailed: expected array \" + JSON.stringify(expected_array) + \" but got \" + JSON.stringify(actual_array);\r\n\r\n  if (actual_array.length !== expected_array.length) {\r\n    throw new Error(msg);\r\n  }\r\n\r\n  for (i = 0, e = actual_array.length; i < e; i += 1) {\r\n    cwt.assert_true(actual_array[i] === expected_array[i], msg);\r\n  }\r\n};","lastModified":1457262771700},"src_new/core/error.js":{"code":"if (!cwt.CONST_DUALCORE_MODE) {\r\n  window.onerror = function(err) {\r\n    cwt.log_error(\"got system error\", err);\r\n    cwt.game_event_error(err);\r\n  };\r\n}\r\n\r\ncwt.error_thrower_callback = function(message) {\r\n  return function(err) {\r\n    throw new Error(\"[\" + message + \"] \" + err);\r\n  };\r\n};","lastModified":1458082095411},"src_new/core/input.js":{"code":"var keys = {};\r\nvar pressed_keys = {};\r\nvar pressed_actions = {};\r\n\r\nvar input_block = 0;\r\n\r\ncwt.input_place_blocker = function(time) {\r\n  input_block = time || 250;\r\n};\r\n\r\ncwt.input_decrease_block_timer = function(delta) {\r\n  input_block = Math.max(input_block - delta, 0);\r\n};\r\n\r\ncwt.input_map_key_to_action = function(key, action) {\r\n  keys[cwt.require_string(key)] = cwt.require_string(action);\r\n};\r\n\r\ncwt.input_press_key = function(key) {\r\n  if (pressed_keys[key]) {\r\n    // ignore this event because the key is already pressed\r\n    return;\r\n  }\r\n\r\n  if (DEBUG) cwt.log_info(\"[INPUT] pressed key \" + key);\r\n\r\n  var mapping = keys[key];\r\n  if (mapping) {\r\n    pressed_actions[mapping] += 1;\r\n\r\n    if (DEBUG && pressed_actions[mapping] == 1) {\r\n      cwt.log_info(\"[INPUT] pressed action \" + mapping);\r\n    }\r\n  }\r\n  pressed_keys[key] = true;\r\n};\r\n\r\ncwt.input_release_key = function(key) {\r\n  if (DEBUG) cwt.log_info(\"[INPUT] released key \" + key);\r\n\r\n  var mapping = keys[key];\r\n  if (mapping) {\r\n    pressed_actions[mapping] -= 1;\r\n    cwt.assert_true(pressed_actions[mapping] >= 0, \"negative action input counter detected\");\r\n\r\n    if (DEBUG && pressed_actions[mapping] === 0) {\r\n      cwt.log_info(\"[INPUT] released action \" + mapping);\r\n    }\r\n  }\r\n\r\n  pressed_keys[key] = false;\r\n};\r\n\r\ncwt.input_is_key_pressed = function(key) {\r\n  return input_block > 0 ? false : pressed_keys[key];\r\n};\r\n\r\ncwt.input_is_action_pressed = function(action) {\r\n  return input_block > 0 ? false : pressed_actions[action] > 0;\r\n};","lastModified":1458172407689},"src_new/core/jobs.js":{"code":"cwt.jobs_execute = function(job_list, when_done, when_fail) {\r\n  var jobs = cwt.list_clone(job_list);\r\n  var cIndex = 0;\r\n\r\n  function executionIterator() {\r\n    if (cIndex == jobs.length) {\r\n      setTimeout(when_done, 10);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      jobs[cIndex](cIndex == jobs.length ? null : function() {\r\n        cIndex += 1;\r\n        setTimeout(executionIterator, 10);\r\n      });\r\n    } catch (err) {\r\n      when_fail(err);\r\n    }\r\n  }\r\n\r\n  executionIterator();\r\n};","lastModified":1458083265570},"src_new/core/list.js":{"code":"cwt.list_clone = function(source_list) {\r\n  var list, i;\r\n\r\n  list = [];\r\n  for (i = 0; i < source_list.length; i += 1) {\r\n    list[i] = source_list[i];\r\n  }\r\n\r\n  return list;\r\n};\r\n\r\ncwt.list_created_filled_list = function(size, value) {\r\n  return cwt.list_created_filled_list_with_provider(size, function() {\r\n    return value;\r\n  });\r\n};\r\n\r\ncwt.list_created_filled_list_with_provider = function(size, value_supplier) {\r\n  var list, i;\r\n\r\n  list = [];\r\n  for (i = 0; i < size; i += 1) {\r\n    list[i] = value_supplier(i);\r\n  }\r\n\r\n  return list;\r\n};\r\n\r\ncwt.list_for_each = function(list, iterator) {\r\n  for (var i = 0; i < list.length; i += 1) {\r\n    iterator(list[i], i, list);\r\n  }\r\n};\r\n\r\ncwt.list_filtered_for_each = function(list, handler, filter) {\r\n  var i, e, el;\r\n  for (i = 0, e = list.length; i < e; i += 1) {\r\n    el = list[i];\r\n    if (!filter || filter(el)) {\r\n      handler(el);\r\n    }\r\n  }\r\n};\r\n\r\ncwt.list_convert_arguments_to_list = function(args) {\r\n  var result = [];\r\n  for (var i = 0; i < args.length; i += 1) {\r\n    result[i] = args[i];\r\n  }\r\n  return result;\r\n};","lastModified":1458082559286},"src_new/core/logging.js":{"code":"/*global DEBUG, console*/\r\n\r\nvar $__Object$defineProperty = Object.defineProperty;\nvar $__Object$create = Object.create;\nvar $__Object$getPrototypeOf = Object.getPrototypeOf;\nvar $__Object$defineProperties = Object.defineProperties;\n\nvar HEADER_INFO = \"%c[FINE ] \";\nvar HEADER_WARN = \"%c[WARN ] \";\nvar HEADER_ERROR = \"%c[ERROR] \";\nvar HEADER_STYLE = \"%c\";\n\nvar STYLE_INFO = \"color: green;\";\nvar STYLE_WARN = \"color: orange;\";\nvar STYLE_ERROR = \"color: red;\";\n\ncwt.log_LEVEL_INFO = 1;\ncwt.log_LEVEL_WARN = 2;\ncwt.log_LEVEL_ERROR = 3;\ncwt.log_LEVEL_STYLED = 4;\n\ncwt.log_console_logger = function(message, log_level, arg) {\r\n  switch (log_level || cwt.log_LEVEL_INFO) {\r\n\r\n    case cwt.log_LEVEL_STYLED:\r\n      console.info(HEADER_STYLE + message, arg);\r\n      break;\r\n\r\n    case cwt.log_LEVEL_INFO:\r\n      console.info(HEADER_INFO + message, STYLE_INFO);\r\n      break;\r\n\r\n    case cwt.log_LEVEL_WARN:\r\n      console.warn(HEADER_WARN + message, STYLE_WARN);\r\n      break;\r\n\r\n    case cwt.log_LEVEL_ERROR:\r\n      console.warn(HEADER_ERROR + message, STYLE_ERROR);\r\n      console.error(arg);\r\n      break;\r\n  }\r\n};\n\ncwt.log_null_logger = function(message, log_level, arg) {\r\n  // null logger ignores logging messages\r\n};\n\ncwt.log_active_logger = (DEBUG ? cwt.log_console_logger : cwt.log_null_logger);\n\ncwt.log_styled = function(style, message) {\r\n  cwt.log_active_logger(message, cwt.log_LEVEL_STYLED, style);\r\n};\n\ncwt.log_info = function(message) {\r\n  cwt.log_active_logger(message, cwt.log_LEVEL_INFO, null);\r\n};\n\ncwt.log_warn = function(message) {\r\n  cwt.log_active_logger(message, cwt.log_LEVEL_WARN, null);\r\n};\n\ncwt.log_error = function(message, error) {\r\n  cwt.log_active_logger(message, cwt.log_LEVEL_ERROR, error);\r\n};\n\nvar LoggerFactory = function() {\n  \"use strict\";\n  function LoggerFactory() {}\n\n  $__Object$defineProperties(LoggerFactory, {\n    create: {\n      value: function() {\r\n        if (!LoggerFactory.LOG) {\r\n          LoggerFactory.LOG = new LegacyLogger();\r\n        }\r\n        return LoggerFactory.LOG;\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return LoggerFactory;\n}();\n\nvar Logger = function() {\n  \"use strict\";\n  function Logger() {}\n\n  $__Object$defineProperties(Logger.prototype, {\n    info: {\n      value: function(msg) {\r\n    \n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    warn: {\n      value: function(msg) {\r\n    \n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    error: {\n      value: function(msg, error) {\r\n    \n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return Logger;\n}();\n\nvar LegacyLogger = function($__super) {\n  \"use strict\";\n\n  function LegacyLogger() {\n    var $__0 = $__Object$getPrototypeOf(LegacyLogger.prototype);\n\n    if ($__0 !== null)\n      $__0.constructor.apply(this, arguments);\n  }\n\n  LegacyLogger.__proto__ = ($__super !== null ? $__super : Function.prototype);\n  LegacyLogger.prototype = $__Object$create(($__super !== null ? $__super.prototype : null));\n\n  $__Object$defineProperty(LegacyLogger.prototype, \"constructor\", {\n    value: LegacyLogger\n  });\n\n  $__Object$defineProperties(LegacyLogger.prototype, {\n    info: {\n      value: function(msg) {\r\n        cwt.log_info(msg);\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    warn: {\n      value: function(msg) {\r\n        cwt.log_warn(msg);\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    error: {\n      value: function(msg, error) {\r\n        cwt.log_error(msg);\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return LegacyLogger;\n}(Logger);\r\n","lastModified":1459101841985},"src_new/core/maps.js":{"code":"cwt.map_for_each_property = function(map, property_iterator) {\r\n  var keys, i;\r\n\r\n  keys = Object.keys(map);\r\n  i = keys.length;\r\n  while (i--) {\r\n    property_iterator(keys[i], map[keys[i]]);\r\n  }\r\n};","lastModified":1457868260537},"src_new/core/MessageBrooker.js":{"code":"var $__Object$defineProperties = Object.defineProperties;\n\nvar MessageBrooker = function() {\n  \"use strict\";\n  function MessageBrooker() {}\n\n  $__Object$defineProperties(MessageBrooker.prototype, {\n    subscribe: {\n      value: function(topic, handler) {\r\n    \n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    sendMessage: {\n      value: function(topic, data) {\r\n    \n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return MessageBrooker;\n}();","lastModified":1459080703111},"src_new/core/request.js":{"code":"function create_request() {\r\n  try {\r\n    return new XMLHttpRequest();\r\n  } catch (ignore) {\r\n    return new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n  }\r\n}\r\n\r\nfunction parse_text(response, when_done, when_fail) {\r\n  when_done(resonse);\r\n}\r\n\r\nfunction parse_json(response, when_done, when_fail) {\r\n  var data;\r\n\r\n  try {\r\n    data = JSON.parse(response);\r\n    when_done(data);\r\n  } catch (err) {\r\n    when_fail(err);\r\n  }\r\n}\r\n\r\nfunction reqListener() {\r\n  var handler;\r\n\r\n  if (this.readyState == 4) {\r\n    if (this.readyState == 4 && this.status == 200) {\r\n      switch (this.response_data_type) {\r\n\r\n        case \"json\":\r\n          handler = parse_json;\r\n          break;\r\n\r\n        case \"text\":\r\n          handler = parse_text;\r\n          break;\r\n\r\n        default:\r\n          this.when_fail(\"NoResponseDataType\");\r\n      }\r\n\r\n      handler(this.responseText, this.when_done, this.when_fail);\r\n\r\n    } else {\r\n      this.when_fail(this.statusText);\r\n    }\r\n  }\r\n}\r\n\r\ncwt.request_get_json = function(path, when_done, when_failed) {\r\n  var request, token;\r\n\r\n  request = create_request();\r\n\r\n  request.response_data_type = \"json\";\r\n  request.when_done = when_done;\r\n  request.when_fail = when_failed;\r\n  request.onreadystatechange = reqListener;\r\n\r\n  token = (parseInt(Math.random() * 100000, 10));\r\n  if (path.indexOf(\"?\") === -1) {\r\n    path += \"?random_token=\" + token;\r\n  } else {\r\n    path += \"&random_token=\" + token;\r\n  }\r\n\r\n  request.open(\"get\", path, true);\r\n  request.send();\r\n};","lastModified":1457176043330},"src_new/core/statemachine.js":{"code":"var active_state = null;\r\nvar states = {};\r\n\r\nfunction is_state(id) {\r\n  return states.hasOwnProperty(id);\r\n}\r\n\r\nfunction get_state(id) {\r\n  cwt.assert_true(is_state(ctx, id));\r\n  return states[id];\r\n}\r\n\r\nfunction empty_function() {}\r\n\r\ncwt.game_state_get_active_state_id = function() {\r\n  return active_state;\r\n};\r\n\r\ncwt.game_state_add_state = function(id, state_object) {\r\n  cwt.assert_true(!is_state(id));\r\n\r\n  function function_or_empty(fn) {\r\n    return fn ? cwt.require_function(fn) : empty_function;\r\n  }\r\n\r\n  states[id] = {\r\n    update: function_or_empty(state_object.update),\r\n    render: function_or_empty(state_object.render),\r\n    on_enter: function_or_empty(state_object.on_enter),\r\n    on_exit: function_or_empty(state_object.on_exit)\r\n  };\r\n\r\n  if (cwt.type_is_function(state_object.init)) {\r\n    state_object.init.apply(states[id], []);\r\n  }\r\n};\r\n\r\ncwt.game_state_update_state = function(delta) {\r\n  states[active_state].update(delta);\r\n};\r\n\r\ncwt.game_state_render_state = function(delta) {\r\n  states[active_state].render(delta);\r\n};\r\n\r\ncwt.game_state_set_state = function(id) {\r\n  cwt.assert_true(is_state(id), id + \" is not a valid state\");\r\n\r\n  cwt.log_info(\"leave \" + active_state + \" state\");\r\n  if (active_state) states[active_state].on_exit();\r\n\r\n  active_state = id;\r\n\r\n  cwt.log_info(\"enter \" + active_state + \" state\");\r\n  cwt.client_event_entered_state(id);\r\n  states[active_state].on_enter();\r\n\r\n  cwt.input_place_blocker();\r\n};","lastModified":1458172321090},"src_new/core/storage.js":{"code":"cwt.storage_save = function(key, item, when_done, error_receiver) {\r\n  localforage.setItem(key, item, function(err, value) {\r\n    if (err !== null) {\r\n      error_receiver(err);\r\n    } else {\r\n      when_done();\r\n    }\r\n  });\r\n};\r\n\r\ncwt.storage_load = function(key, item_receiver, error_receiver) {\r\n  localforage.getItem(key, function(err, value) {\r\n    if (err !== null) {\r\n      error_receiver(err);\r\n    } else {\r\n      item_receiver(value);\r\n    }\r\n  });\r\n};\r\n\r\ncwt.storage_remove_item = function(key, when_done, error_receiver) {\r\n  localforage.removeItem(key, function(err) {\r\n    if (err !== null) {\r\n      error_receiver(err);\r\n    } else {\r\n      when_done();\r\n    }\r\n  });\r\n};\r\n\r\ncwt.storage_remove_all = function(when_done, error_receiver) {\r\n  localforage.clear(function(err) {\r\n    if (err !== null) {\r\n      error_receiver(err);\r\n    } else {\r\n      when_done();\r\n    }\r\n  });\r\n};\r\n\r\ncwt.storage_for_each_key = function(keys_receiver, error_receiver) {\r\n  localforage.keys(function(error, keys) {\r\n    if (error !== null) {\r\n      error_receiver(error);\r\n    } else {\r\n      keys_receiver(keys);\r\n    }\r\n  });\r\n};","lastModified":1456530072054},"src_new/core/stress.js":{"code":"cwt.stress_simulate_a_lot_of_it = function(modifier) {\r\n  var iterations;\r\n\r\n  iterations = 100000 * modifier;\r\n  while (iterations > 0) {\r\n    var n = Math.sqrt(Math.random()) * Math.sqrt(Math.random());\r\n    iterations -= 1;\r\n  }\r\n};","lastModified":1457870931421},"src_new/core/types.js":{"code":"cwt.require_function = function(value) {\r\n  cwt.assert_true(cwt.type_is_function(value));\r\n  return value;\r\n};\r\n\r\ncwt.type_is_function = function(value) {\r\n  return typeof value === \"function\";\r\n};\r\n\r\ncwt.require_string = function(value) {\r\n  cwt.assert_true(cwt.type_is_string(value));\r\n  return value;\r\n};\r\n\r\ncwt.type_is_string = function(value) {\r\n  return typeof value === \"string\";\r\n};\r\n\r\ncwt.require_integer = function(value) {\r\n  cwt.assert_true(cwt.type_is_integer(value));\r\n  return value;\r\n};\r\n\r\ncwt.type_is_integer = function(value) {\r\n  return typeof value === \"number\" && value % 1 === 0;\r\n};\r\n\r\ncwt.require_number = function(value) {\r\n  cwt.assert_true(cwt.type_is_number(value));\r\n  return value;\r\n};\r\n\r\ncwt.type_is_number = function(value) {\r\n  return typeof value === \"number\";\r\n};\r\n\r\ncwt.require_non_null = function(value) {\r\n  cwt.assert_true(cwt.type_is_not_null(value));\r\n  return value;\r\n};\r\n\r\ncwt.type_is_not_null = function(value) {\r\n  return value !== null;\r\n};\r\n\r\ncwt.require_null = function(value) {\r\n  cwt.assert_true(!cwt.type_is_not_null(value));\r\n  return value;\r\n};\r\n\r\ncwt.type_is_null = function(value) {\r\n  return !cwt.type_is_not_null(value);\r\n};\r\n\r\ncwt.require_nothing = function(value) {\r\n  cwt.assert_true(cwt.type_is_nothing(value));\r\n  return value;\r\n};\r\n\r\ncwt.type_is_nothing = function(value) {\r\n  return value === undefined;\r\n};\r\n\r\ncwt.require_something = function(value) {\r\n  cwt.assert_true(cwt.type_is_something(value));\r\n  return value;\r\n};\r\n\r\ncwt.type_is_something = function(value) {\r\n  return value !== undefined && value !== null;\r\n};","lastModified":1456562125780},"src_new/core/utility.js":{"code":"var $__Object$defineProperty = Object.defineProperty;\nvar $__Object$create = Object.create;\nvar $__Object$defineProperties = Object.defineProperties;\n\nvar Utility = function() {\n  \"use strict\";\n  function Utility() {}\n\n  $__Object$defineProperties(Utility, {\n    createFilledListBySupplier: {\n      value: function(size, valueSupplier) {\r\n        var list, i;\r\n    \n        list = [];\r\n        for (i = 0; i < size; i += 1) {\r\n          list[i] = valueSupplier(i);\r\n        }\r\n    \n        return list;\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    convertStringToHash: {\n      value: function(str) {\r\n        var hash = 0;\r\n    \n        if (value.length === 0) {\r\n          return hash;\r\n        }\r\n    \n        for (var i = 0; i < value.length; i += 1) {\r\n          var c = value.charCodeAt(i);\r\n          hash = ((hash << 5) - hash) + c;\r\n          hash = hash & hash;\r\n        }\r\n    \n        return hash;\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return Utility;\n}();\n\nvar Buffer = function() {\n  \"use strict\";\n\n  function Buffer() {\r\n    this.items = [];\r\n  }\n\n  $__Object$defineProperties(Buffer.prototype, {\n    pushItem: {\n      value: function(item) {\r\n        this.items.push(Require.isSomething(item));\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    popItem: {\n      value: function(item) {\r\n        Require.isTrue(hasItems());\r\n        this.items.splice(0, 1);\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    hasItems: {\n      value: function() {\r\n        return this.items.length > 0;\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return Buffer;\n}();\n\nvar PrioritizedBuffer = function($__super) {\n  \"use strict\";\n\n  function PrioritizedBuffer(lowLevelBuffer, highLevelBuffer) {\r\n    this.lowLevelBuffer = Require.InstanceOf(lowLevelBuffer, Buffer);\r\n    this.highLevelBuffer = Require.InstanceOf(highLevelBuffer, Buffer);\r\n  }\n\n  PrioritizedBuffer.__proto__ = ($__super !== null ? $__super : Function.prototype);\n  PrioritizedBuffer.prototype = $__Object$create(($__super !== null ? $__super.prototype : null));\n\n  $__Object$defineProperty(PrioritizedBuffer.prototype, \"constructor\", {\n    value: PrioritizedBuffer\n  });\n\n  $__Object$defineProperties(PrioritizedBuffer.prototype, {\n    pushItem: {\n      value: function(item, executeSoonAsPossible) {\r\n        (executeSoonAsPossible ? this.highLevelBuffer : this.lowLevelBuffer).pushItem(item);\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    popItem: {\n      value: function(item) {\r\n        if (this.highLevelBuffer.hasItems()) {\r\n          return this.highLevelBuffer.popItem();\r\n        }\r\n    \n        if (this.lowLevelBuffer.hasItems()) {\r\n          return this.lowLevelBuffer.popItem();\r\n        }\r\n    \n        Require.isTrue(false);\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    hasItems: {\n      value: function() {\r\n    \n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return PrioritizedBuffer;\n}(Buffer);\n\n\nwindow.Require = function() {\n  \"use strict\";\n  function Require() {}\n\n  $__Object$defineProperties(Require, {\n    InstanceOf: {\n      value: function(instance, clazz) {\r\n        if (!(instance instanceof clazz)) {\r\n          throw new Error(\"NoInstanceOf: \" + clazz);\r\n        }\r\n        return instance;\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    isTrue: {\n      value: function(value) {\n        var msg = (arguments[1] !== void 0 ? arguments[1] : \"IsNotTrue\");\n        if (!value) {\r\n          throw new Error(msg);\r\n        }\n        return value;\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    isBoolean: {\n      value: function(value, msg) {\r\n        if (!Types.isBoolean(value)) {\r\n          throw new Error(\"IsNotABoolean\");\r\n        }\r\n        return value;\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    isSomething: {\n      value: function(value) {\r\n        if (!Types.isSomething(value)) {\r\n          throw new Error(\"IsNothing\");\r\n        }\r\n        return value;\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    isNothing: {\n      value: function(value) {\r\n        if (Types.isSomething(value)) {\r\n          throw new Error(\"IsNotNothing\");\r\n        }\r\n        return value;\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    isString: {\n      value: function(value) {\r\n        if (!Types.isString(value)) {\r\n          throw new Error(\"IsNotAString\");\r\n        }\r\n        return value;\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    isInteger: {\n      value: function(value) {\n        var msg = (arguments[1] !== void 0 ? arguments[1] : \"IsNotAnInteger\");\n        if (!Types.isInteger(value)) {\r\n          throw new Error(msg);\r\n        }\n        return value;\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return Require;\n}();\n\nwindow.Types = function() {\n  \"use strict\";\n  function Types() {}\n\n  $__Object$defineProperties(Types, {\n    isSomething: {\n      value: function(value) {\r\n        return value !== null && value !== undefined;\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    isInteger: {\n      value: function(value) {\r\n        return (typeof value === \"number\" && (value - (value % 1)) === value);\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    isBoolean: {\n      value: function(value) {\r\n        return (typeof value === \"boolean\");\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    isString: {\n      value: function(value) {\r\n        return (typeof value === \"string\");\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return Types;\n}();\r\n","lastModified":1459101254324},"src_new/events/events.js":{"code":"cwt.game_event_error = function(error) {};\r\n\r\ncwt.game_event_unit_attacks = function(attacker_id, attacker_x, attacker_y, defender_id, defender_x, defender_y) {};\r\n\r\ncwt.game_event_unit_will_be_attacked = function(unit_id, unit_x, unit_y) {};\r\n\r\ncwt.game_event_unit_lost_health = function(unit_id, x, y, lost_health, current_health) {};\r\n\r\ncwt.game_event_unit_destroyed = function(unit_id, x, y) {};\r\n\r\ncwt.game_event_unit_builded = function(factory_id, unit_type, owner_id, x, y) {};\r\n\r\ncwt.game_event_unit_leveled_up = function(unit_id, level) {};\r\n\r\ncwt.game_event_units_joined = function(source_unit_id, target_unit_id, target_x, target_y) {};\r\n\r\ncwt.game_event_unit_moved = function(unit_id, start_x, start_y, end_x, end_y, way) {};\r\n\r\ncwt.game_event_unit_placed_at_position = function(unit_id, x, y) {};\r\n\r\ncwt.game_event_turn_changed = function(day, turn_owner_id) {};\r\n\r\ncwt.game_event_weather_changes = function(weather_id, duration) {};\r\n\r\ncwt.game_event_modified_player_power = function(player_id, change, new_value) {};\r\n\r\ncwt.game_event_player_activates_power = function(player_id, power_level) {};\r\n\r\ncwt.game_event_fire_rocket = function(silo_id, unit_id, silo_x, silo_y, target_x, target_y) {};\r\n\r\ncwt.game_event_load_unit = function(transporter_id, load_id, transporter_x, transporter_y) {};\r\n\r\ncwt.game_event_unload_unit = function(transporter_id, load_id, transporter_x, transporter_y, unload_direction) {};\r\n\r\ncwt.game_event_unit_captures = function(property_id, capturer_id) {};\r\n\r\ncwt.game_event_property_captured = function(property_id, new_owner_id, capturer_id) {};\r\n\r\ncwt.game_event_tile_is_visible = function(tile_x, tile_y) {};\r\n\r\ncwt.game_event_tile_is_not_visible = function(tile_x, tile_y) {};\r\n\r\ncwt.game_event_tile_got_type = function(x, y, type) {};\r\n\r\ncwt.client_event_initialize_model = function() {};\r\n\r\ncwt.client_event_load_map = function(map) {};\r\n\r\ncwt.client_event_push_command = function(data) {};\r\n\r\ncwt.client_event_register_object_type = function(type, sheet) {};\r\n\r\ncwt.client_event_player_joins_battle = function(player_id, player_type, name) {};\r\n\r\ncwt.client_event_player_leaves_battle = function() {};\r\n\r\ncwt.client_event_prepare_battle = function(map) {};\r\n\r\ncwt.client_event_start_battle = function() {};\r\n\r\ncwt.client_event_entered_state = function(state_id) {};","lastModified":1458173700414},"src_new/game/event_handling.js":{"code":"cwt.client_event_initialize_model = function() {\r\n};\r\n\r\ncwt.client_event_register_object_type = function(type, sheet) {\r\n  switch (type) {\r\n\r\n    case \"tile\":\r\n      cwt.GAME.tileDB.registerSheet(sheet);\r\n      return;\r\n\r\n    case \"unit\":\r\n      cwt.GAME.unitDB.registerSheet(sheet);\r\n      return;\r\n\r\n    case \"movetype\":\r\n      cwt.GAME.movetypeDB.registerSheet(sheet);\r\n      return;\r\n\r\n    case \"weather\":\r\n      cwt.GAME.weatherDB.registerSheet(sheet);\r\n      return;\r\n\r\n    default:\r\n      Require.isTrue(false, \"unknown game object type \" + type);\r\n  }\r\n};\r\n\r\ncwt.client_event_load_map = function(map) {\r\n  cwt.GAME.mapLoader.loadMap(map);\r\n};\r\n\r\ncwt.client_event_push_command = function(data) {\r\n  cwt.GAME.commandInterpreter.pushCommand(data.key, data.p1, data.p2, data.p3, data.p4, data.p5);\r\n};\r\n\r\n/*\r\nstInterval(function() {\r\n  if (cwt.commands_has_buffered_commands()) {\r\n    cwt.commands_evaluate_next();\r\n  }\r\n}, 50);*/\r\n","lastModified":1459100631889},"src_new/game/game.js":{"code":"var $__Object$defineProperties = Object.defineProperties;\n\nvar GameFactory = function() {\n  \"use strict\";\n  function GameFactory() {}\n\n  $__Object$defineProperties(GameFactory, {\n    create: {\n      value: function() {\r\n    \n        var msgBrooker = new MessageBrooker();\r\n        var playerCtx = PlayerContextFactory.create();\r\n        var tileDB = TileDBFactory.create();\r\n        var unitDB = UnitDBFactory.create();\r\n        var movetypeDB = MovetypeDBFactory.create();\r\n        var weatherDB = WeatherDBFactory.create();\r\n        var map = new Map(tileDB, msgBrooker);\r\n        var turn = new Turn(playerCtx.players);\r\n        var unitCtx = new UnitHandler(unitDB, MAX_PLAYERS * MAX_UNITS, msgBrooker);\r\n        var commandInterpreter = CommandInterpreterFactory.create();\r\n    \n        var game = new Game({\r\n          playerCtx: playerCtx,\r\n          unitCtx: unitCtx,\r\n          tileDB: tileDB,\r\n          unitDB: unitDB,\r\n          movetypeDB: movetypeDB,\r\n          weatherDB: weatherDB,\r\n          weather: new WeatherHandler(weatherDB, msgBrooker),\r\n          turn: turn,\r\n          map: map,\r\n          mapLoader: MapLoaderFactory.create(map, turn, playerCtx.players, playerCtx.teams, unitCtx),\r\n          msgBrooker: msgBrooker,\r\n          commandInterpreter: commandInterpreter\r\n        });\r\n    \n        return game;\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return GameFactory;\n}();\n\nvar Game = function() {\n  \"use strict\";\n\n  function Game(deps) {\r\n    this.tileDB = Require.InstanceOf(deps.tileDB, SheetDatabase);\r\n    this.unitDB = Require.InstanceOf(deps.unitDB, SheetDatabase);\r\n    this.movetypeDB = Require.InstanceOf(deps.movetypeDB, SheetDatabase);\r\n    this.weatherDB = Require.InstanceOf(deps.weatherDB, SheetDatabase);\r\n    this.playerCtx = Require.InstanceOf(deps.playerCtx, PlayerContext);\r\n    this.unitCtx = Require.InstanceOf(deps.unitCtx, UnitHandler);\r\n    this.turn = Require.InstanceOf(deps.turn, Turn);\r\n    this.map = Require.InstanceOf(deps.map, Map);\r\n    this.weather = Require.InstanceOf(deps.weather, WeatherHandler);\r\n    this.commandInterpreter = Require.InstanceOf(deps.commandInterpreter, CommandInterpreter);\r\n    this.mapLoader = Require.InstanceOf(deps.mapLoader, MapLoader);\r\n  }\n\n  return Game;\n}();\r\n","lastModified":1459110944403},"src_new/game/commands/commands.js":{"code":"var $__Object$defineProperties = Object.defineProperties;\n\nvar CommandInterpreterFactory = function() {\n  \"use strict\";\n  function CommandInterpreterFactory() {}\n\n  $__Object$defineProperties(CommandInterpreterFactory, {\n    create: {\n      value: function() {\r\n        var buffer = new PrioritizedBuffer(new Buffer(), new Buffer());\r\n        var register = new CommandRegister();\r\n        return new CommandInterpreter(buffer, register);\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return CommandInterpreterFactory;\n}();\n\nvar CommandRegister = function() {\n  \"use strict\";\n\n  function CommandRegister() {\r\n    this.handlers = {};\r\n  }\n\n  $__Object$defineProperties(CommandRegister.prototype, {\n    registerHandler: {\n      value: function(commandkey, handler) {\r\n        var keyCode = Utility.convertStringToHash(commandkey);\r\n    \n        Require.isNothing(this.handlers[keyCode]);\r\n        this.handlers[keyCode] = handler;\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    getHandlerByKey: {\n      value: function(key) {\r\n        return this.getHandlerByCode(Utility.convertStringToHash(key));\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    getHandlerByCode: {\n      value: function(code) {\r\n        return Require.isSomething(this.handlers[code + \"\"]);\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return CommandRegister;\n}();\n\nvar CommandInterpreter = function() {\n  \"use strict\";\n\n  function CommandInterpreter(buffer, register) {\r\n    this.buffer = Require.InstanceOf(buffer, Buffer);\r\n    this.register = Require.InstanceOf(register, CommandRegister);\r\n  }\n\n  $__Object$defineProperties(CommandInterpreter.prototype, {\n    pushCommand: {\n      value: function(commandkey, p1, p2, p3, p4, p5) {\r\n        this.buffer.pushItem([Utility.convertStringToHash(commandkey), p1, p2, p3, p4, p5], false);\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    pushImportantCommand: {\n      value: function() {\r\n        this.buffer.pushItem([Utility.convertStringToHash(commandkey), p1, p2, p3, p4, p5], true);\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    hasCommands: {\n      value: function() {\r\n        return this.buffer.hasItems();\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    evaluateNext: {\n      value: function() {\r\n        Require.isTrue(hasCommands());\r\n        var data = this.buffer.popItem();\r\n        this.register.getHandlerByCode(data[0])(data[1], data[2], data[3], data[4], data[5]);\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return CommandInterpreter;\n}();\r\n","lastModified":1459084882392},"src_new/game/model/map.js":{"code":"var $__Object$defineProperties = Object.defineProperties;\n\nvar Map = function() {\n  \"use strict\";\n\n  function Map(tileDB, msgBrooker) {\r\n    this.map = [];\r\n    for (var x = 0; x < MAX_MAP_WIDTH; x += 1) {\r\n      this.map[x] = [];\r\n    }\r\n    this.width = 10;\r\n    this.height = 10;\r\n    this.tileDB = Require.InstanceOf(tileDB, SheetDatabase);\r\n    this.msgBrooker = Require.InstanceOf(msgBrooker, MessageBrooker);\r\n  }\n\n  $__Object$defineProperties(Map.prototype, {\n    setSize: {\n      value: function(width, height) {\r\n        Require.isInteger(width);\r\n        Require.isInteger(height);\r\n        Require.isTrue(width > 0 && height > 0);\r\n    \n        this.width = width;\r\n        this.height = height;\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    fillWithTiles: {\n      value: function(tileType) {\r\n        // we're doing this to make sure that we got a valid tile type\r\n        this.tileDB.getSheet(tileType);\r\n    \n        for (var x = 0; x < this.width; x += 1) {\r\n          for (var y = 0; y < this.height; y += 1) {\r\n            this.setTile(x, y, tileType);\r\n          }\r\n        }\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    getTile: {\n      value: function(x, y) {\r\n        return this.map[x][y];\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    setTile: {\n      value: function(x, y, type) {\r\n        Require.isInteger(y);\r\n        Require.isInteger(x);\r\n        Require.isString(type);\r\n    \n        this.map[x][y] = type;\r\n        this.msgBrooker.sendMessage(\"map:tile-set-type\", [x, y, type]);\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return Map;\n}();\r\n","lastModified":1459102057037},"src_new/game/model/mapLoader.js":{"code":"var $__Object$defineProperties = Object.defineProperties;\n\nvar MapLoaderFactory = function() {\n  \"use strict\";\n  function MapLoaderFactory() {}\n\n  $__Object$defineProperties(MapLoaderFactory, {\n    create: {\n      value: function(map, turn, players, teams, units) {\r\n        return new MapLoader(map, turn, players, teams, units, LoggerFactory.create());\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return MapLoaderFactory;\n}();\n\nvar MapLoader = function() {\n  \"use strict\";\n\n  function MapLoader(map, turn, players, teams, units, log) {\r\n    this.log = Require.InstanceOf(log, Logger);\r\n    this.map = Require.InstanceOf(map, Map);\r\n    this.turn = Require.InstanceOf(turn, Turn);\r\n    this.players = Require.InstanceOf(players, PlayerHandler);\r\n    this.teams = Require.InstanceOf(teams, TeamHandler);\r\n    this.units = Require.InstanceOf(units, UnitHandler);\r\n  }\n\n  $__Object$defineProperties(MapLoader.prototype, {\n    loadMap: {\n      value: function(map) {\r\n        this.log.info(\"loading map \" + map.name);\r\n    \n        this.turn.setDay(Types.isSomething(map.day) ? map.day : 0);\r\n        this.turn.setTurnOwner(Types.isSomething(map.turn_owner) ? map.turn_owner : 0);\r\n    \n        this.map.setSize(Require.isInteger(map.width), Require.isInteger(map.height));\r\n        this.map.fillWithTiles(Require.isString(map.fill_type));\r\n    \n        var players = this.players;\r\n        var teams = this.teams;\r\n    \n        players.deactivatePlayers();\r\n        if (Types.isSomething(map.players)) {\r\n          if (Types.isInteger(map.players)) {\r\n            for (var i = 0; i < map.players; i += 1) {\r\n              players.activatePlayer(i);\r\n              players.getPlayer(i).name = \"Player \" + id;\r\n              teams.setTeam(i, i);\r\n            }\r\n    \n          } else {\r\n            map.players.forEach(function(data, index) {\r\n              players.activatePlayer(index);\r\n              teams.setTeam(index, Types.isSomething(data.team) ? data.team : index);\r\n              players.getPlayer(index).name = Types.isSomething(data.name) ? data.name : \"Player \" + index;\r\n            });\r\n          }\r\n        }\r\n    \n        this.units.releaseAllUnits();\r\n        if (Types.isSomething(map.units)) {\r\n          map.units.forEach(function(data) {\r\n            this.units.createUnitAt(data.type, players.getPlayer(data.owner), data.x, data.y);\r\n          }.bind(this));\r\n        }\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return MapLoader;\n}();\r\n","lastModified":1459110273292},"src_new/game/model/movetypes.js":{"code":"var $__Object$defineProperties = Object.defineProperties;\n\nvar MovetypeDBFactory = function() {\n  \"use strict\";\n  function MovetypeDBFactory() {}\n\n  $__Object$defineProperties(MovetypeDBFactory, {\n    create: {\n      value: function() {\r\n        return new SheetDatabase(function(sheet, data) {\r\n        });\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return MovetypeDBFactory;\n}();\r\n","lastModified":1459088640824},"src_new/game/model/players.js":{"code":"var $__Object$defineProperties = Object.defineProperties;\n\nvar PlayerContextFactory = function() {\n  \"use strict\";\n  function PlayerContextFactory() {}\n\n  $__Object$defineProperties(PlayerContextFactory, {\n    create: {\n      value: function() {\r\n        var players = new PlayerHandler(MAX_PLAYERS);\r\n        var teams = new TeamHandler(players);\r\n        return new PlayerContext(players, teams);\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return PlayerContextFactory;\n}();\n\nvar PlayerContext = function() {\n  \"use strict\";\n\n  function PlayerContext(players, teams) {\r\n    this.players = Require.InstanceOf(players, PlayerHandler);\r\n    this.teams = Require.InstanceOf(teams, TeamHandler);\r\n  }\n\n  return PlayerContext;\n}();\n\nvar TeamHandler = function() {\n  \"use strict\";\n\n  function TeamHandler(players) {\r\n    this.players = Require.InstanceOf(players, PlayerHandler);\r\n  }\n\n  $__Object$defineProperties(TeamHandler.prototype, {\n    inSameTeam: {\n      value: function(playerIdA, playerIdB) {\r\n        return this.getTeam(playerIdA) == this.getTeam(playerIdB);\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    getTeam: {\n      value: function(playerId) {\r\n        this.players.getPlayer(playerId).team;\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    setTeam: {\n      value: function(playerId, team) {\r\n        this.players.getPlayer(playerId).team = Require.isInteger(team);\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return TeamHandler;\n}();\n\nvar PlayerHandler = function() {\n  \"use strict\";\n\n  function PlayerHandler(maxPlayers) {\r\n    this.players = Utility.createFilledListBySupplier(maxPlayers, function(index) {\n      return new Player(index);\n    });\r\n  }\n\n  $__Object$defineProperties(PlayerHandler.prototype, {\n    deactivatePlayers: {\n      value: function() {\r\n        this.players.forEach(function(player) {\n          return player.id = -player.id;\n        });\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    activatePlayer: {\n      value: function(id) {\r\n        var player = this.getPlayer(id);\r\n        player.id = Math.abs(player.id);\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    isPlayerActive: {\n      value: function(id) {\r\n        return this.getPlayer(id).id < 0;\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    isPlayer: {\n      value: function(id) {\r\n        Require.isInteger(id);\r\n        return id >= 0 && id < MAX_PLAYERS;\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    isNeutralPlayerId: {\n      value: function(id) {\r\n        return this.getNeutralPlayerId() === id;\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    getNeutralPlayerId: {\n      value: function() {\r\n        return MAX_PLAYERS;\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    getPlayer: {\n      value: function(id) {\r\n        Require.isInteger(id);\r\n        Require.isTrue(id >= 0 && id < MAX_PLAYERS);\r\n        return this.players[id];\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return PlayerHandler;\n}();\n\nvar Player = function() {\n  \"use strict\";\n\n  function Player(id) {\r\n    this.id = id;\r\n    this.name = \"Player \" + id;\r\n    this.team = id;\r\n  }\n\n  return Player;\n}();\r\n","lastModified":1459105257445},"src_new/game/model/sheets.js":{"code":"var $__Object$defineProperties = Object.defineProperties;\n\nvar SheetDatabase = function() {\n  \"use strict\";\n\n  function SheetDatabase(sheetParser) {\r\n    this.sheets = {};\r\n    this.names = [];\r\n    this.sheetParser = Require.isSomething(sheetParser);\r\n  }\n\n  $__Object$defineProperties(SheetDatabase.prototype, {\n    registerSheet: {\n      value: function(data) {\r\n        Require.isSomething(data);\r\n        Require.isTrue(data.id.length === 4);\r\n    \n        var sheet = {};\r\n    \n        sheet.id = Require.isString(data.id);\r\n    \n        cwt.log_info(\"registering object type with id \" + data.id);\r\n        Require.isNothing(this.sheets[data.id]);\r\n    \n        this.sheets[data.id] = sheet;\r\n        this.names.push(data.id);\r\n    \n        this.sheetParser(sheet, data);\r\n    \n        return sheet;\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    getRandomSheet: {\n      value: function() {\r\n        return this.sheet[this.names[parseInt(Math.random() * this.names.length, 10)]];\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    getSheet: {\n      value: function(id) {\r\n        return Require.isSomething(this.sheets[id]);\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    isValidId: {\n      value: function(id) {\r\n        return Types.isSomething(this.sheets[id]);\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return SheetDatabase;\n}();\r\n","lastModified":1459085554131},"src_new/game/model/tiles.js":{"code":"var $__Object$defineProperties = Object.defineProperties;\n\nvar TileDBFactory = function() {\n  \"use strict\";\n  function TileDBFactory() {}\n\n  $__Object$defineProperties(TileDBFactory, {\n    create: {\n      value: function() {\r\n        return new SheetDatabase(function(sheet, data) {\r\n        });\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return TileDBFactory;\n}();\r\n","lastModified":1459085731632},"src_new/game/model/turn.js":{"code":"var $__Object$defineProperties = Object.defineProperties;\n\nvar Turn = function() {\n  \"use strict\";\n\n  function Turn(players) {\r\n    this.players = Require.InstanceOf(players, PlayerHandler);\r\n    this.setTurnOwner(0);\r\n    this.setDay(0);\r\n  }\n\n  $__Object$defineProperties(Turn.prototype, {\n    setDay: {\n      value: function(day) {\r\n        this.day = day;\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    setTurnOwner: {\n      value: function(id) {\r\n        Require.isTrue(this.players.isPlayer(id));\r\n        this.turnOwner = id;\r\n        cwt.game_event_turn_changed(this.day, this.turnOwner);\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    pickNextTurnOwner: {\n      value: function() {\r\n        var current_owner_id, next_possible_owner_id;\r\n    \n        current_owner_id = this.turnOwner;\r\n        next_possible_owner_id = current_owner_id;\r\n        do {\r\n    \n          next_possible_owner_id += 1;\r\n          if (next_possible_owner_id === this.players.getNeutralPlayerId()) {\r\n            next_possible_owner_id = 0;\r\n    \n            // if the next possible turn owner is player 0 then\r\n            // it means that means all players acted and the next\r\n            // day starts\r\n            this.setDay(this.day + 1);\r\n          }\r\n    \n          if (this.players.isPlayerActive(next_possible_owner_id)) {\r\n            this.setTurnOwner(this.players.getPlayer(next_possible_owner_id));\r\n            return next_possible_owner_id;\r\n          }\r\n    \n        } while (current_owner_id != next_possible_owner_id);\r\n    \n        Require.isTrue(false, \"unable to pick a new turn owner\");\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return Turn;\n}();","lastModified":1459079778840},"src_new/game/model/units.js":{"code":"var $__Object$defineProperties = Object.defineProperties;\n\nvar UnitDBFactory = function() {\n  \"use strict\";\n  function UnitDBFactory() {}\n\n  $__Object$defineProperties(UnitDBFactory, {\n    create: {\n      value: function() {\r\n        return new SheetDatabase(function(sheet, data) {});\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return UnitDBFactory;\n}();\n\nvar UnitHandler = function() {\n  \"use strict\";\n\n  function UnitHandler(unitDB, maxUnits, msgBrooker) {\r\n    this.types = Require.InstanceOf(unitDB, SheetDatabase);\r\n    this.units = Utility.createFilledListBySupplier(maxUnits, function(index) {\n      return new Unit();\n    });\r\n    this.positions = {};\r\n    this.msgBrooker = Require.InstanceOf(msgBrooker, MessageBrooker);\r\n\r\n    this.releaseAllUnits();\r\n  }\n\n  $__Object$defineProperties(UnitHandler.prototype, {\n    _getFreeId: {\n      value: function() {\r\n        for (var i = 0; i < this.units.length; i += 1) {\r\n          if (this.units[i].owner === -1) {\r\n            return i;\r\n          }\r\n        }\r\n        Require.isTrue(false, \"no free unit slot left\");\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    _getPositionCode: {\n      value: function(x, y) {\r\n        return (x * 1000) + y;\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    createUnitAt: {\n      value: function(type, owner, x, y) {\r\n        var unitId = this._getFreeId();\r\n        this.setUnitOwner(unitId, owner);\r\n        this.setUnitPosition(unitId, x, y);\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    setUnitOwner: {\n      value: function(unitId, owner) {\r\n        this.getUnitById(unitId).owner = Require.InstanceOf(owner, Player).id;\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    setUnitPosition: {\n      value: function(unitId, x, y) {\r\n        Require.isNothing(this.positions[this._getPositionCode(x, y)]);\r\n    \n        var unit = this.getUnitById(unitId);\r\n        delete this.positions[this._getPositionCode(unit.x, unit.y)];\r\n    \n        unit.x = Require.isInteger(x);\r\n        unit.y = Require.isInteger(y);\r\n    \n        Require.isTrue(unit.x >= 0 && unit.y >= 0);\r\n        this.positions[this._getPositionCode(x, y)] = unitId;\r\n    \n        this.msgBrooker.sendMessage(\"unit:set-position\", [unitId, x, y]);\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    releaseUnit: {\n      value: function(unitId) {\r\n        this.getUnitById(unitId).owner = -1;\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    releaseAllUnits: {\n      value: function() {\r\n        this.units.forEach(function(unit) {\n          return unit.owner = -1;\n        });\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    getUnitById: {\n      value: function(id) {\r\n        return this.units[cwt.require_integer(id)];\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    getUnitByPosition: {\n      value: function(x, y) {\r\n        return Require.isSomething(this.positions[this._getPositionCode(x, y)], \"no unit at {\" + x + \", \" + y + \"}\");\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return UnitHandler;\n}();\n\nvar Unit = function() {\n  \"use strict\";\n\n  function Unit() {\r\n    this.x = 0;\r\n    this.y = 0;\r\n    this.owner = -1;\r\n  }\n\n  return Unit;\n}();\r\n","lastModified":1459105015862},"src_new/game/model/weather.js":{"code":"var $__Object$defineProperties = Object.defineProperties;\n\nvar WeatherDBFactory = function() {\n  \"use strict\";\n  function WeatherDBFactory() {}\n\n  $__Object$defineProperties(WeatherDBFactory, {\n    create: {\n      value: function() {\r\n        return new SheetDatabase(function(sheet, data) {\r\n          sheet.defaultWeather = Types.isBoolean(data.defaultWeather) ? data.defaultWeather : false;\r\n          sheet.minDuration = Require.isInteger(data.minDuration, data.id + \":minDuration\");\r\n          sheet.maxDuration = Require.isInteger(data.maxDuration, data.id + \":maxDuration\");\r\n        });\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return WeatherDBFactory;\n}();\n\nvar WeatherHandler = function() {\n  \"use strict\";\n\n  function WeatherHandler(weatherDB, msgBrooker) {\r\n    this.weatherDB = Require.InstanceOf(weatherDB, SheetDatabase);\r\n    this.msgBrooker = Require.InstanceOf(msgBrooker, MessageBrooker);\r\n    this.active = null;\r\n    this.leftDays = 0;\r\n\r\n    this.msgBrooker.subscribe(\"turn:next-day\", function() {\n      return this.leftDays--;\n    }.bind(this));\r\n  }\n\n  $__Object$defineProperties(WeatherHandler.prototype, {\n    setWeather: {\n      value: function(id) {\r\n        this.active = this.weatherDB.getSheet(id);\r\n        var duration = this.active.minDuration;\r\n        duration += parseInt(Math.random() * (this.active.maxDuration - duration), 10);\r\n        this.leftDays = duration;\r\n        this.msgBrooker.sendMessage(\"weather:changed\", [id, duration]);\r\n      },\n\n      enumerable: false,\n      writable: true\n    },\n\n    changeWeather: {\n      value: function() {\r\n        setWeather(this.weatherDB.getRandomSheet());\r\n      },\n\n      enumerable: false,\n      writable: true\n    }\n  });\n\n  return WeatherHandler;\n}();\r\n","lastModified":1459101033057},"src_new/controller/states/loading_state.js":{"code":"var TOOLTIP_TIMEOUT = 5000;\r\n\r\nvar tips;\r\nvar tip_active;\r\nvar tip_timer;\r\n\r\nfunction hasTips() {\r\n  return !!tips && tips.length > 0;\r\n}\r\n\r\nfunction selectRandomTip() {\r\n  tip_active = tips[parseInt(Math.random() * tips.length, 10)];\r\n  cwt.log_info(\"changed tooltip [\" + tip_active + \"]\");\r\n}\r\n\r\nfunction load_object_types() {\r\n  var load_jobs;\r\n\r\n  function loading_done() {\r\n    cwt.log_info(\"completed loading data\");\r\n  }\r\n\r\n  function loading_failed(err) {\r\n    cwt.log_error(\"failed to load data\", err);\r\n  }\r\n\r\n  function load_objects_json(job_list, file_name, type) {\r\n    load_jobs.push(function(when_done) {\r\n      cwt.request_get_json(\"../src_gamedata/\" + file_name + \".json\", function(data) {\r\n        cwt.list_for_each(data, function(el) {\r\n          cwt.client_event_register_object_type(type, el);\r\n        });\r\n        when_done();\r\n      }, cwt.error_thrower_callback(\"DataLoader(\" + type + \")\"));\r\n    });\r\n  }\r\n\r\n  load_jobs = [];\r\n\r\n  load_objects_json(load_jobs, \"tiles\", \"tile\");\r\n  load_objects_json(load_jobs, \"units\", \"unit\");\r\n  load_objects_json(load_jobs, \"movetypes\", \"movetype\");\r\n  load_objects_json(load_jobs, \"weathers\", \"weather\");\r\n\r\n  cwt.jobs_execute(load_jobs, loading_done, loading_failed);\r\n}\r\n\r\ncwt.game_state_add_state(\"loading_state\", {\r\n\r\n  on_enter: function() {\r\n    cwt.request_get_json(\"../src_gamedata/tips.json\", function(data) {\r\n      tips = cwt.require_something(data);\r\n      // this leads into a selection of a new timeout\r\n      tip_timer = TOOLTIP_TIMEOUT;\r\n\r\n    }, function(err) {\r\n      cwt.log_error(\"error\", err);\r\n    });\r\n\r\n    load_object_types();\r\n\r\n    tip_timer = 0;\r\n    tip_active = \"\";\r\n  },\r\n\r\n  update: function(delta) {\r\n    if (hasTips()) {\r\n      tip_timer += delta;\r\n      if (tip_timer > TOOLTIP_TIMEOUT) {\r\n        tip_timer = 0;\r\n        selectRandomTip();\r\n      }\r\n    }\r\n\r\n    if (cwt.input_is_key_pressed(\"KEY_ENTER\")) {\r\n      cwt.game_state_set_state(\"main_menu\");\r\n    }\r\n  },\r\n\r\n  render: function(delta) {\r\n\r\n  }\r\n});","lastModified":1458177812646},"src_new/controller/states/load_map.js":{"code":"cwt.game_state_add_state(\"load_map\", {\r\n\r\n  on_enter: function() {\r\n    cwt.client_event_load_map({\r\n      name: \"development fake map\",\r\n      height: 15,\r\n      width: 15,\r\n      day: 10,\r\n      fill_type: \"PLIN\",\r\n      players: [{\r\n        team: 3,\r\n        name: \"Willy Wonker\"\r\n      }, {\r\n        team: 1\r\n      }],\r\n      units: [{\r\n        type: \"INFT\",\r\n        x: 2,\r\n        y: 2,\r\n        owner: 0\r\n      }, {\r\n        type: \"INFT\",\r\n        x: 3,\r\n        y: 4,\r\n        owner: 0\r\n      }, {\r\n        type: \"INFT\",\r\n        x: 3,\r\n        y: 3,\r\n        owner: 1\r\n      }]\r\n    });\r\n  }\r\n});\r\n","lastModified":1459110378200},"src_new/controller/states/main_menu.js":{"code":"cwt.game_state_add_state(\"main_menu\", {\r\n\r\n  update: function(delta) {\r\n    if (cwt.input_is_key_pressed(\"KEY_ENTER\")) {\r\n      cwt.game_state_set_state(\"load_map\");\r\n    }\r\n  },\r\n});","lastModified":1457125869269},"src_new/controller/states/start_game.js":{"code":"cwt.game_state_add_state(\"start_game\", {\r\n\r\n  on_enter: function() {\r\n    cwt.log_info(\"starting game\");\r\n\r\n    cwt.client_event_initialize_model();\r\n\r\n    cwt.game_state_set_state(\"loading_state\");\r\n  },\r\n\r\n  render: function(delta) {\r\n    // TODO render the loading status here\r\n  }\r\n});","lastModified":1457887969920},"src_new/controller/input/keyboard.js":{"code":"var KEY_MAP = {\r\n  \"38\": \"KEY_UP\",\r\n  \"40\": \"KEY_DOWN\",\r\n  \"37\": \"KEY_LEFT\",\r\n  \"39\": \"KEY_RIGHT\",\r\n  \"13\": \"KEY_ENTER\",\r\n  \"8\": \"KEY_BACKSPACE\"\r\n};\r\n\r\ndocument.onkeydown = function(event) {\r\n  var key = KEY_MAP[event.keyCode];\r\n  if (cwt.type_is_something(key)) {\r\n    cwt.input_press_key(key);\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\ndocument.onkeyup = function(event) {\r\n  var key = KEY_MAP[event.keyCode];\r\n  if (cwt.type_is_something(key)) {\r\n    cwt.input_release_key(key);\r\n  }\r\n\r\n  return false;\r\n};","lastModified":1456609426357},"src_new/controller/main.js":{"code":"function enter_loop() {\r\n  var last_timestamp, timestamp, delta, fps, fpsMin, fpsMax, fpsCount, fpsNum, FPS_UPDATE_INTERVAL;\r\n\r\n  FPS_UPDATE_INTERVAL = 100;\r\n\r\n  last_timestamp = new Date().getTime();\r\n\r\n  fpsTime = 0;\r\n  fpsCount = 0;\r\n  fpsNum = 0;\r\n  fpsMin = 99;\r\n  fpsMax = 0;\r\n\r\n  function loop() {\r\n\r\n    timestamp = new Date().getTime();\r\n    delta = timestamp - last_timestamp;\r\n    last_timestamp = timestamp;\r\n\r\n    if (DEBUG && delta > 0) {\r\n      fpsCount += parseInt(1000 / delta, 10);\r\n      fpsNum += 1;\r\n      fpsTime += delta;\r\n      if (fpsTime >= FPS_UPDATE_INTERVAL) {\r\n        fps = parseInt(fpsCount / fpsNum, 10);\r\n\r\n        if (fps < fpsMin) fpsMin = fps;\r\n        if (fps > fpsMax) fpsMax = fps;\r\n\r\n        document.getElementById(\"fpsCounter\").innerHTML = \"FPS[NOW:\" + fps + \" MIN:\" + fpsMin + \" MAX:\" + fpsMax + \"]\";\r\n\r\n        fpsTime = 0;\r\n        fpsCount = 0;\r\n        fpsNum = 0;\r\n      }\r\n    }\r\n\r\n    cwt.input_decrease_block_timer(delta);\r\n    cwt.game_state_update_state(delta);\r\n    cwt.game_state_render_state(delta);\r\n\r\n    requestAnimationFrame(loop);\r\n  }\r\n  requestAnimationFrame(loop);\r\n}\r\n\r\ncwt.main = function() {\r\n  cwt.log_info(\"starting CustomWars Tactics\");\r\n  cwt.GAME = GameFactory.create();\r\n  cwt.client_intialize_workers();\r\n  if (cwt.type_is_function(cwt.client_intialize_tester)) {\r\n    cwt.client_intialize_tester();\r\n  }\r\n  cwt.game_state_set_state(\"start_game\");\r\n  enter_loop();\r\n};\r\n","lastModified":1459092052115},"src_new/events/fake_handler.js":{"code":"cwt.client_intialize_workers = function() {};","lastModified":1458096448229}}