<!DOCTYPE html>
<!--
    CURRENT NO-VISIBLE TEST FILE FOR CWT GAME ENGINE.

    TEST SYSTEM:
        BLACKCAT: GOOGLE CHROME 16 ON MAC OSX 10.6

    SINCE: 22.01.2012
-->
<html>
    <head>
    
        <style>
            body {
                overflow:hidden;
                background: #d7d7d7;
                margin:0;
                padding:0;
            }
        </style>

        <!-- IPAD META DATA -->
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0" />        
        <!-- END OF IPAD META DATA -->
        
        <script type="text/javascript">
            var TYPED = false;
            var DEBUG = false;
            
                var units = {
                    "sheets" : [
                        
                        {
                            "ID"            : "INFANTRY",
                            
                            "cost"          : 1000,
                            
                            "moveRange"     : 3,
                            "moveType"      : "MV_INFANTRY",
                            "vision"        : 2,
                            "maxFuel"       : 99,
                            
                            "captures"      : 10,
                            "weight"        : 1,
                            
                            "maxAmmo"       : 0,
                            "weapons"       : [ "WP_MG" ],
                            
                            "tags"          : [ "GROUND", "FOOT", "SOFT" ]
                        },
                        
                        {
                            "ID"            : "MECH",
                            
                            "cost"          : 3000,
                            
                            "moveRange"     : 2,
                            "moveType"      : "MV_BAZOOKA",
                            "vision"        : 2,
                            "maxFuel"       : 70,
                            
                            "captures"      : 10,
                            "weight"        : 1,
                            
                            "maxAmmo"       : 3,
                            "weapons"       : [ "WP_BAZOOKA", "WP_MG" ],
                            
                            "tags"          : [ "GROUND", "FOOT", "SOFT", "ANTI_TANK" ]
                        },
                        
                        {
                            "ID"            : "RECKON",
                            
                            "cost"          : 4000,
                            
                            "moveRange"     : 8,
                            "moveType"      : "MV_TIRE_A",
                            "vision"        : 5,
                            "maxFuel"       : 80,
                            
                            "weight"        : 1,
                            
                            "maxAmmo"       : 0,
                            "weapons"       : [ "WP_MG" ],
                            
                            "tags"          : [ "GROUND", "VEHICLE", "FOOT", "SOFT" ]
                        },
                        
                        {
                            "ID"            : "MOTORBIKE",
                            
                            "cost"          : 2500,
                            
                            "moveRange"     : 5,
                            "moveType"      : "MV_TIRE_B",
                            "vision"        : 2,
                            "maxFuel"       : 70,
                            "captures"      : 10,
                            
                            "weight"        : 1,
                            
                            "maxAmmo"       : 0,
                            "weapons"       : [ "WP_MG" ],
                            
                            "tags"          : [ "GROUND", "BIKE" ]
                        },
                        
                        {
                            "ID"            : "LTANK",
                            
                            "cost"          : 7000,
                            
                            "moveRange"     : 6,
                            "moveType"      : "MV_TANK",
                            "vision"        : 3,
                            "maxFuel"       : 70,
                            
                            "weight"        : 2,
                            
                            "maxAmmo"       : 6,
                            "weapons"       : [ "WP_LT_CANNON", "WP_MG" ],
                            
                            "tags"          : [ "GROUND", "VEHICLE", "FOOT", "SOFT" ]
                        },
                        
                        {
                            "ID"            : "PAK",
                            
                            "cost"          : 11000,
                            
                            "moveRange"     : 4,
                            "moveType"      : "MV_TIRE_B",
                            "vision"        : 2,
                            "maxFuel"       : 40,
                            
                            "weight"        : 2,
                            
                            "maxAmmo"       : 6,
                            "weapons"       : [ "WP_AT_CANNON" ],
                            
                            "tags"          : []
                        },
                        
                        {
                            "ID"            : "MDTANK",
                            
                            "cost"          : 12000,
                            
                            "moveRange"     : 5,
                            "moveType"      : "MV_TANK",
                            "vision"        : 2,
                            "maxFuel"       : 50,
                            
                            "weight"        : 2,
                            
                            "maxAmmo"       : 5,
                            "weapons"       : [ "WP_MD_CANNON", "WP_MG" ],
                            
                            "tags"          : [ "GROUND", "TANK" ]
                        },
                        
                        {
                            "ID"            : "HTANK",
                            
                            "cost"          : 16000,
                            
                            "moveRange"     : 4,
                            "moveType"      : "MV_TANK",
                            "vision"        : 1,
                            "maxFuel"       : 50,
                            
                            "weight"        : 3,
                            
                            "maxAmmo"       : 3,
                            "weapons"       : [ "WP_HV_CANNON", "WP_MG" ],
                            
                            "tags"          : []
                        },
                        
                        {
                            "ID"            : "AATANK",
                            
                            "cost"          : 7000,
                            
                            "moveRange"     : 6,
                            "moveType"      : "MV_TANK",
                            "vision"        : 3,
                            "maxFuel"       : 60,
                            
                            "weight"        : 2,
                            
                            "maxAmmo"       : 6,
                            "weapons"       : [ "WP_AA_CANN", "WP_MG" ],
                            
                            "tags"          : []
                        },
                        
                        {
                            "ID"            : "ARTILLERY",
                            
                            "cost"          : 6000,
                            
                            "moveRange"     : 5,
                            "moveType"      : "MV_TANK",
                            "vision"        : 3,
                            "maxFuel"       : 50,
                            
                            "weight"        : 2,
                            
                            "maxAmmo"       : 6,
                            "weapons"       : [ "WP_HOWITZER" ],
                            
                            "tags"          : [ "INDIRECT_UNIT" ]
                        },
                        
                        {
                            "ID"            : "APC",
                            
                            "cost"          : 5000,
                            
                            "moveRange"     : 6,
                            "moveType"      : "MV_TANK",
                            "vision"        : 1,
                            "maxFuel"       : 99,
                            
                            "weight"        : 3,
                            
                            "maxAmmo"       : 99,
                            "weapons"       : [],
                            
                            "transport"     : {
                                "canLoad"   : ["SOFT"],
                                "maxWeight" : 2
                            },
                            
                            "supply"        : ["SOFT","TANK","AIR","SHIP"],
                            
                            "tags"          : [ "TANK","SUPPLY","TRANSPORT" ]
                        },
                        
                        {
                            "ID"            : "BHELI",
                            
                            "cost"          : 9000,
                            
                            "moveRange"     : 6,
                            "moveType"      : "MV_AIR",
                            "vision"        : 2,
                            "maxFuel"       : 99,
                            
                            "weight"        : 1,
                            
                            "maxAmmo"       : 6,
                            "weapons"       : [ "WP_AG_ROCKET", "WP_MG" ],
                            
                            "tags"          : [ "AIR", "COPTER" ]
                        },
                        
                        {
                            "ID"            : "BOMB",
                            
                            "cost"          : 20000,
                            
                            "moveRange"     : 7,
                            "moveType"      : "MV_AIR",
                            "vision"        : 3,
                            "maxFuel"       : 99,
                            
                            "weight"        : 3,
                            
                            "maxAmmo"       : 6,
                            "weapons"       : [ "WP_BOMBS" ],
                            
                            "tags"          : [ "AIR", "PLANE" ]
                        },
                        
                        {
                            "ID"            : "THELI",
                            
                            "cost"          : 5000,
                            
                            "moveRange"     : 6,
                            "moveType"      : "MV_AIR",
                            "vision"        : 1,
                            "maxFuel"       : 99,
                            
                            "weight"        : 2,
                            
                            "maxAmmo"       : 0,
                            "weapons"       : [],
                            
                            "transport"     : {
                                "canLoad"   : ["SOFT"],
                                "maxWeight" : 2
                            },
                            
                            "tags"          : [ "AIR", "COPTER", "TRANSPORT" ]
                        },
                        
                        {
                            "ID"            : "WARPLANE",
                            
                            "cost"          : 20000,
                            
                            "moveRange"     : 5,
                            "moveType"      : "MV_AIR",
                            "vision"        : 1,
                            "maxFuel"       : 99,
                            
                            "weight"        : 3,
                            
                            "maxAmmo"       : 0,
                            "weapons"       : [],
                            
                            "transport"     : {
                                "canLoad"   : ["VEHICLE","SOFT","TANK"],
                                "maxWeight" : 4
                            },
                            
                            "tags"          : [ "AIR", "PLANE", "TRANSPORT" ]
                        },
                        
                        {
                            "ID"            : "SUB",
                            
                            "cost"          : 20000,
                            
                            "moveRange"     : 6,
                            "moveType"      : "MV_SHIP",
                            "vision"        : 5,
                            "maxFuel"       : 70,
                            
                            "weight"        : 1,
                            
                            "maxAmmo"       : 6,
                            "weapons"       : [ "WP_TORPEDO" ],
                            
                            "tags"          : [ "SUB", "SHIP", "STEALTH" ]
                        },
                        
                        {
                            "ID"            : "CRUISER",
                            
                            "cost"          : 16000,
                            
                            "moveRange"     : 5,
                            "moveType"      : "MV_WATER_TRANSPORT",
                            "vision"        : 2,
                            "maxFuel"       : 40,
                            
                            "weight"        : 2,
                            
                            "maxAmmo"       : 9,
                            "weapons"       : [ "WP_WATERBOMBS" ],
                            
                            "transport"     : {
                                "canLoad"   : ["COPTER"],
                                "maxWeight" : 2
                            },
                            
                            
                            "tags"          : [ "WATRER", "SHIP", "TRANSPORT" ]
                        },
                        
                        {
                            "ID"            : "AAROCKET",
                            
                            "cost"          : 12000,
                            
                            "moveRange"     : 5,
                            "moveType"      : "MV_TIRE_A",
                            "vision"        : 2,
                            "maxFuel"       : 40,
                            
                            "weight"        : 2,
                            
                            "maxAmmo"       : 6,
                            "weapons"       : [ "WP_AA_ROCKET" ],
                            
                            "tags"          : [ "VEHICLE", "ANTI_AIR", "INDIRECT" ]
                        },
                        
                        {
                            "ID"            : "JET",
                            
                            "cost"          : 20000,
                            
                            "moveRange"     : 9,
                            "moveType"      : "MV_AIR",
                            "vision"        : 5,
                            "maxFuel"       : 99,
                            
                            "weight"        : 2,
                            
                            "maxAmmo"       : 6,
                            "weapons"       : [ "WP_AA_JETROCKET" ],
                            
                            "tags"          : [ "AIR", "PLANE", "ANTI_AIR" ]
                        },
                        
                        {
                            "ID"            : "DUSTER",
                            
                            "cost"          : 13000,
                            
                            "moveRange"     : 7,
                            "moveType"      : "MV_AIR",
                            "vision"        : 4,
                            "maxFuel"       : 45,
                            
                            "weight"        : 2,
                            
                            "maxAmmo"       : 6,
                            "weapons"       : [ "WP_PLANE_CANNON", "WP_MG" ],
                            
                            "tags"          : [ "AIR", "PLANE", "SCOUT" ]
                        },
                        
                        {
                            "ID"            : "SHIP_PLANE",
                            
                            "cost"          : 15000,
                            
                            "moveRange"     : 7,
                            "moveType"      : "MV_AIR",
                            "vision"        : 4,
                            "maxFuel"       : 99,
                            
                            "weight"        : 2,
                            
                            "maxAmmo"       : 4,
                            "weapons"       : [ "WP_WATERBOMBS", "WP_PLANE_CANNON" ],
                            
                            "tags"          : [ "AIR", "PLANE", "ANTI_AIR" ]
                            
                        },
                        
                        {
                            "ID"            : "CARRIER",
                            
                            "cost"          : 28000,
                            
                            "moveRange"     : 5,
                            "moveType"      : "MV_SHIP",
                            "vision"        : 4,
                            "maxFuel"       : 99,
                            
                            "weight"        : 3,
                            
                            "maxAmmo"       : 0,
                            "weapons"       : [ "WP_AA_SHIPCANNON" ],
                            
                            "transport"     : [ "AIR" ],
                            "canLoad"       : 2,
                            
                            "tags"          : [ "WATER", "SHIP", "TRANSPORT" ]
                        },
                        
                        {
                            "ID"            : "LANDER",
                            
                            "cost"          : 10000,
                            
                            "moveRange"     : 6,
                            "moveType"      : "MV_WATER_TRANSPORT",
                            "vision"        : 1,
                            "maxFuel"       : 99,
                            
                            "weight"        : 3,
                            
                            "transport"     : {
                                "canLoad"   : ["SOFT","VEHICLE","TANK"],
                                "maxWeight" : 1
                            },
                            
                            
                            "tags"          : [ "WATER", "SHIP", "TRANSPORT" ]
                        },
                        
                        {
                            "ID"            : "ROCKET",
                            
                            "cost"          : 15000,
                            
                            "moveRange"     : 5,
                            "moveType"      : "MV_TIRE_A",
                            "vision"        : 3,
                            "maxFuel"       : 50,
                            
                            "weight"        : 2,
                            
                            "maxAmmo"       : 5,
                            "weapons"       : [ "WP_HV_ROCKET" ],
                            
                            "tags"          : [ "GROUND", "VEHICLE", "AT" ]
                        },
                        
                        {
                            "ID"            : "BSHIP",
                            
                            "cost"          : 25000,
                            
                            "moveRange"     : 5,
                            "moveType"      : "MV_SHIP",
                            "vision"        : 3,
                            "maxFuel"       : 99,
                            
                            "weight"        : 3,
                            
                            "maxAmmo"       : 6,
                            "weapons"       : [ "WP_SHIP_HOWITZER" ],
                            
                            "tags"          : [ "WATER", "SHIP", "INDIRECT", "AT" ]
                        }
                        
                    ]
                }
            
            
                var tiles = {
                    "sheets" : [
                        
                        {
                            "ID"                : "PLAIN",
                            "tags"              : [],
                            "defense"           : 0
                        },
                        
                        {
                            "ID"                : "FOREST",
                            "tags"              : [ "VISION_BLOCK" ],
                            "defense"           : 0
                        },
                        
                        {
                            "ID"                : "MOUNTAIN",
                            "tags"              : [ "" ],
                            "defense"           : 0
                        },
                        
                        {
                            "ID"                : "CITY",
                            "vision"            : 0,
                            "capturePoints"     : 20,
                            "funds"             : 1000,
                            "repairs"           : {
                                "*"             : 20
                            },
                            "tags"              : [ "PROPERTY" ],
                            "defense"           : 0
                        },
                        
                        {
                            "ID"                : "GROUND_FACTORY",
                            "vision"            : 0,
                            "capturePoints"     : 20,
                            "funds"            : 1000,
                            "repairs"           : {
                                "*"             : 20
                            },
                            "tags"              : [ "PROPERTY", "FACTORY" ],
                            "defense"           : 0
                        },
                        
                        {
                            "ID"                : "AIRPORT",
                            "vision"            : 0,
                            "capturePoints"     : 20,
                            "funds"            : 1000,
                            "repairs"           : {
                                "*"             : 20
                            },
                            "tags"              : [ "PROPERTY", "FACTORY" ],
                            "defense"           : 0
                        },
                        
                        {
                            "ID"                : "PORT",
                            "vision"            : 0,
                            "capturePoints"     : 20,
                            "funds"            : 1000,
                            "repairs"           : {
                                "*"             : 20
                            },
                            "tags"              : [ "PROPERTY", "FACTORY" ],
                            "defense"           : 0
                        },
                        
                        {
                            "ID"                : "SILO",
                            "vision"            : 0,
                            "capturePoints"     : 20,
                            "tags"              : [ "PROPERTY" ],
                            "defense"           : 0
                        },
                        
                        {
                            "ID"                : "HQ",
                            "vision"            : 1,
                            "capturePoints"     : 20,
                            "funds"            : 1000,
                            "repairs"           : {
                                "*"             : 20
                            },
                            "tags"              : [ "PROPERTY", "HQ" ],
                            "defense"           : 0
                        },
                        
                        {
                            "ID"                : "RADAR",
                            "vision"            : 4,
                            "capturePoints"     : 20,
                            "tags"              : [ "PROPERTY", "SCOUT" ],
                            "defense"           : 0
                        },
                        
                        {
                            "ID"                : "STREET",
                            "tags"              : [],
                            "defense"           : 0
                        },
                        
                        {
                            "ID"                : "RIVER",
                            "tags"              : [],
                            "defense"           : 0
                        },
                        
                        {
                            "ID"                : "WATER",
                            "tags"              : [],
                            "defense"           : 0
                        },
                        
                        {
                            "ID"                : "REEF",
                            "tags"              : [ "VISION_BLOCK" ],
                            "defense"           : 0
                        },
                        
                        {
                            "ID"                : "SHOAL",
                            "tags"              : [ "VISION_BLOCK" ],
                            "defense"           : 0
                        }
                    ]
                }
                
                
                var movetypes = {
                    "sheets" : [
                        
                        {
                            "ID"            : "MV_INFANTRY",
                            "costs"         : {
                                "MOUNTAIN"      : 2,
                                "WATER"         : 0, 
                                "REEF"          : 0,
                                "*"             : 1
                            }
                        },
                        
                        {
                            "ID"            : "MV_BAZOOKA",
                            "costs"         :{
                                "WATER"         : 0,
                                "REEF"          : 0,
                                "*"             : 1
                            }
                        },
                        
                        {
                            "ID"            : "MV_TIRE_A",
                            "costs"         :{
                                "PLAIN"         : 2,
                                "FOREST"        : 3,
                                "MOUNTAIN"      : 0,
                                "RIVER"         : 0,
                                "WATER"         : 0,
                                "REEF"          : 0,
                                "*"             : 1
                            }
                        },
                        
                        {
                            "ID"            : "MV_TIRE_B",
                            "costs"         :{
                                "FOREST"        : 3,
                                "MOUNTAIN"      : 0,
                                "RIVER"         : 0,
                                "WATER"         : 0,
                                "REEF"          : 0,
                                "*"             : 1
                            }
                        },
                        
                        {
                            "ID"            : "MV_TANK",
                            "costs"         :{
                                "FOREST"        : 2,
                                "MOUNTAIN"      : 0,
                                "RIVER"         : 0,
                                "WATER"         : 0,
                                "REEF"          : 0,
                                "*"             : 1
                            }
                        },
                        
                        {
                            "ID"            : "MV_AIR",
                            "costs"         :{
                                "*"             : 1
                            }
                        },
                        
                        {
                            "ID"            : "MV_SHIP",
                            "costs"         :{
                                "WATER"         : 1,
                                "RIVER"         : 1,
                                "PORT"          : 1,
                                "REEF"          : 2,
                                "*"             : 0
                            }
                        },
                        
                        {
                            "ID"            : "MV_WATER_TRANSPORT",
                            "costs"         :{
                                "WATER"         : 1,
                                "RIVER"         : 1,
                                "PORT"          : 1,
                                "REEF"          : 2,
                                "SHOAL"         : 1,
                                "*"             : 0
                            }
                        }
                    ]
                }
                
            /*
             * A VERY SIMPLE TEST MAP
             */
            var testmap = {
                    "name":"Test Map",
                    
                    "author":"BlackCat",
                    "version":"0.1",
                    
                    "players":2,
                    
                    "height":10,
                    "width":10,
                    
                    "filler":"PLAIN",
                    "tiles":[
                        { "x":2, "y":3, "id":"FOREST" },
                        { "x":4, "y":4, "id":"FOREST" },
                        { "x":1, "y":1, "id":"HQ", "owner":0 },
                        { "x":8, "y":8, "id":"HQ", "owner":1 },
                        { "x":8, "y":1, "id":"MOUNTAIN" },
                        { "x":7, "y":2, "id":"MOUNTAIN" },
                        { "x":7, "y":1, "id":"MOUNTAIN" },
                        { "x":6, "y":3, "id":"MOUNTAIN" }
                    ]
            };
        </script>
        
        
        <!-- NEKO SCRIPTS -->
        <script type="text/javascript" src="neko.js"></script>
        <script type="text/javascript" src="collection.js"></script>
        <script type="text/javascript" src="events.js"></script>
        <script type="text/javascript" src="objects.js"></script>
        <!-- END OF NEKO SCRIPTS -->
        
        <!-- CWT GAME SCRIPTS -->
        <script type="text/javascript" src="db.js"></script>
        <script type="text/javascript" src="model.js"></script>
        <script type="text/javascript" src="kernel.js"></script>
        <!-- END OF CWT GAME SCRIPTS -->
        
        <script type="text/javascript" src="log4js-lib.js"></script>
        
        <!-- 
          TARGET BETA 1
            - map with units, tiles and properties
            - player
            - moving of units
        -->
        <script type="text/javascript">
            
            var log = log4javascript.getLogger("main");
			var appender = new log4javascript.InPageAppender();
			log.addAppender(appender);
            
            log_info = function(msg){
                log.info(msg);
            }
            log_warn = function(msg){
                log.warn(msg);
            }
            log_error = function(msg){
                log.error(msg);
            }
            
            var targetFPSdiffer = 500;
            var stop = false;
            function mainLoop(){
                log_info("do a game loop");

                if( stop === true ){
                  log_info("waiting...");
                  waitInStop();
                  
                } 
                else setTimeout(mainLoop,targetFPSdiffer);
            }
            
            function waitInStop(){
              
                if( stop == true ) setTimeout(waitInStop,1500);
                else{ 
                  mainLoop();
                  log_info("done");
                }
            }
            
            // load mod
            collection_each(tiles.sheets, function( element ){ db_parseSheet(element , "TILE"); });
            collection_each(movetypes.sheets, function( element ){ db_parseSheet(element, "MOVETYPE"); });
            collection_each(units.sheets, function( element ){ db_parseSheet(element, "UNIT"); });
            
            // load map
            game_loadMap( testmap );
            
            var u1 = { type:"INFANTRY" }
            game_map_units[0] = u1;
            
            // start loop
            mainLoop();
        </script>
    </head>
    <body>
      <div id="debugIn">
        <input id="evalIn"></input>
        <input type="button" value='Parse' onclick='eval( document.getElementById(id).value );' />
      </div>
      <div id="app_draw_canv">
        <canvas id="canvasObj" width="1024" height="768" style="position:absolute;left:0px;top:0px;z-index:2">
          Fallback-Inhalt
        </canvas>
        <div id="fps" style="position:absolute;left:10px;top:20px;z-index:5"></div>
      </div>
    </body>
</html>
