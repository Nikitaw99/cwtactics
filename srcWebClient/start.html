<!DOCTYPE HTML>
<html>
    <head>

        <meta charset="utf-8">
        <meta name = "viewport" content = "user-scalable=no, initial-scale=1, maximum-scale=1,  width=device-width" />

        <title>Custom Wars Tactics</title>

        <link rel="stylesheet" href="style.css"  type="text/css" />

        <!-- GAME: EXTERNAL LIBRARIES  -->
        <script src="../libJs/jquery-min.js"                    type="text/javascript" ></script>
        <script src="../libJs/hqx.js"                           type="text/javascript" ></script>
        <script src="../libJs/fsm.js"                           type="text/javascript" ></script>
        <script src="../libJs/popup.js"                         type="text/javascript" ></script>
        <script src="../libJs/toastr.js"                        type="text/javascript" ></script>
        <script src="../libJs/amanda.js"                        type="text/javascript" ></script>
        <script src="../libJs/hammer.js"                        type="text/javascript" ></script>
        <script src="../libJs/animFrame.js"                     type="text/javascript" ></script>
        <script src="../libJs/graph.js"                         type="text/javascript" ></script>
        <script src="../libJs/astar.js"                         type="text/javascript" ></script>
        <link rel="stylesheet" href="../libJs/toastr.css"       type="text/css" />
        <link rel="stylesheet" href="../libJs/toastr-r.css"     type="text/css" />
        <!-- END: EXTERNAL LIBRARIES  -->

        <!-- START: GAME ENGINE -->
        <script src="../game-engine/system.js"                type="text/javascript" ></script>
        <script src="../game-engine/system/logger.js"         type="text/javascript" ></script>
        <script src="../game-engine/system/action.js"         type="text/javascript" ></script>
        <script src="../game-engine/system/transaction.js"    type="text/javascript" ></script>
        <script src="../game-engine/system/commandPipe.js"    type="text/javascript" ></script>
        <script src="../game-engine/system/persist.js"        type="text/javascript" ></script>
        <script src="../game-engine/system/annotation.js"     type="text/javascript" ></script>
        <script src="../game-engine/controller/db.js"         type="text/javascript" ></script>
        <script src="../game-engine/controller/model.js"      type="text/javascript" ></script>
        <script src="../game-engine/controller/selector.js"   type="text/javascript" ></script>
        <script src="../game-engine/controller/move.js"       type="text/javascript" ></script>
        <script src="../game-engine/controller/properties.js" type="text/javascript" ></script>
        <script src="../game-engine/controller/turn.js"       type="text/javascript" ></script>
        <!-- END: GAME ENGINE -->

        <!-- START: DEFAULT MOD -->
        <script src="../mod/awds.js"                          type="text/javascript" ></script>
        <script src="../mod/movetypes.js"                     type="text/javascript" ></script>
        <script src="../mod/weapons.js"                       type="text/javascript" ></script>
        <script src="../mod/tiles.js"                         type="text/javascript" ></script>
        <script src="../mod/units.js"                         type="text/javascript" ></script>
        <!-- END: DEFAULT MOD -->

        <!-- START: GRAPHIC ENGINE -->
        <script src="../srcWebClient/main.js"                    type="text/javascript" ></script>
        <script src="../srcWebClient/model/images.js"            type="text/javascript" ></script>
        <script src="../srcWebClient/controller/draw.js"         type="text/javascript" ></script>
        <script src="../srcWebClient/controller/draw.js"         type="text/javascript" ></script>
        <script src="../srcWebClient/controller/input.js"        type="text/javascript" ></script>
        <script src="../srcWebClient/controller/menu.js"         type="text/javascript" ></script>
        <script src="../srcWebClient/controller/screen.js"       type="text/javascript" ></script>
        <!-- END: GRAPHIC ENGINE -->

        <!-- START: DEFAULT GRAPHICS -->
        <script src="../image/webClientGraphics.js"              type="text/javascript"></script>
        <!-- END: DEFAULT GRAPHICS -->

        <script src="testMap.js"                              type="text/javascript"></script>

        <script type="text/javascript">
          window.onerror = function( e ){ cwt.log.error( "error: {0}", e ); }

          // some toastr options
          toastr.options.fadeIn = 500;
          toastr.options.fadeOut = 500;
          toastr.options.timeOut = 3000;

          function start(){
            document.getElementById("cwt_maplayer").height = window.innerHeight - 32;
            document.getElementById("cwt_maplayer").width = window.innerWidth;

            cwt.util.setDebug( true );
            cwt.start();
            cwt.loadDefaultMod();
            cwt.model.loadMap( testMap );
            cwt.client.imageLoadingStatus.init();
            cwt.client.completeRedraw();

            function waitWebClient(){

              // wait for loading and filtering
              if( cwt.client.imageLoadingStatus.current !== "ready" ){
                setTimeout( waitWebClient, 250);
              }
              // else start rendering
              else { // stepWebClient();

                var start = new Date().getTime();
                function x(){
                  requestAnimationFrame( x );

                  var now = new Date().getTime();
                  var time = now - start;
                  start = now;

                  cl.update( time );
                }

                window.requestAnimationFrame( x );
              }
            }

            var fpsOut = document.getElementById('fps');
            var fpsFilter = 25;
            var fps = 0, now, lastUpdate = (new Date)*1 - 1;
            var cl = cwt.client;
            function stepWebClient(){
              var diff = ((now=new Date) - lastUpdate);

              // calculate fps
              var thisFrameFPS = 1000 / diff;
              fps += (thisFrameFPS - fps) / fpsFilter;
              lastUpdate = now * 1 - 1;
              fpsOut.innerHTML = fps.toFixed(1) + "fps";

              // update game
              cl.update(diff);

              // better than intervall because intervall slows down if the draw routine needs
              // longer to finish than the set interval. This can be better controlled later to
              // get a stable fps.
              setTimeout( stepWebClient, 20-diff ); //TODO do a better fps management here!
            }

            waitWebClient();
          }
        </script>
    </head>

    <body onLoad="start();"
          onkeydown="cwt.client._keyboardEvent( event );">

      <div id="app">

              <div id="fps" style="position: absolute;" ></div>

              <!-- MAP -->
              <canvas id="cwt_maplayer" class="draw_panel" >
                  <div style="color: red;" >
                    could not display map container! </div> </canvas>

              <!-- MENU -->
              <div id="menu">
                <ul class="cwtwc_menu">

                  <li><button id="menuEntry_0" onclick="cwt.client.menuController.doAction(0)"></button></li>
                  <li><button id="menuEntry_1" onclick="cwt.client.menuController.doAction(1)"></button></li>
                  <li><button id="menuEntry_2" onclick="cwt.client.menuController.doAction(2)"></button></li>
                  <li><button id="menuEntry_3" onclick="cwt.client.menuController.doAction(3)"></button></li>
                  <li><button id="menuEntry_4" onclick="cwt.client.menuController.doAction(4)"></button></li>
                  <li><button id="menuEntry_5" onclick="cwt.client.menuController.doAction(5)"></button></li>
                  <li><button id="menuEntry_6" onclick="cwt.client.menuController.doAction(6)"></button></li>
                  <li><button id="menuEntry_7" onclick="cwt.client.menuController.doAction(7)"></button></li>
                  <li><button id="menuEntry_8" onclick="cwt.client.menuController.doAction(8)"></button></li>
                  <li><button id="menuEntry_9" onclick="cwt.client.menuController.doAction(9)"></button></li>

                  <li><button                  onclick="cwt.client.menuController.cancel()" >CANCEL</button></li>

                </ul>
              </div>
      </div>
    </body>
</html>