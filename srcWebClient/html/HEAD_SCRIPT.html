<script >

  // Check if a new cache is available on page load.
  window.addEventListener( 'load', function( e ){
    var appCache = window.applicationCache;

    if( appCache ) {

      // update is available
      appCache.addEventListener( 'updateready', function( e ){
        if( appCache.status === appCache.UPDATEREADY ) {

          // Browser downloaded a new app cache. Swap it in and reload 
          // the page to get the new hotness.
          appCache.swapCache();

          if( confirm( 'A new version of this site is available. Load it?' ) ) {

            // forces reload of all program files
            window.location.reload();
          }
        } else startGame();
      }, false );
      
      appCache.addEventListener( 'noupdate', function(){
        controller.screenStateMachine.event( 'start' );
      }, false );
      
      appCache.addEventListener( 'downloading', function(){}, false );
      
      appCache.addEventListener( 'progress', function(){}, false );
      
      // Start when you collected all data
      appCache.addEventListener( 'cached', function(){
        controller.screenStateMachine.event( 'start' );
      }, false );
       
      // The manifest returns 404 or 410, the download failed,
      // or the manifest changed while the download was in progress.
      appCache.addEventListener( 'error', function(){
        alert( "could not download the game data into the offline storage" );
      }, false );
      
    }
  }, false );

</script>