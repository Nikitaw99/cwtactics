<!DOCTYPE HTML>
<html debug="true" >
    <head >

        <meta charset="utf-8">
        <meta name = "viewport" content = "user-scalable=no, initial-scale=1, maximum-scale=1,  width=device-width" />

        <title>Custom Wars Tactics</title>

        <!--                    GAME ENGINE                           -->
        <script src="gameEngineDeps_min.js" type="text/javascript" ></script>
        <script src="gameEngine_min.js" type="text/javascript" ></script>

        <script src="defaultMod_min.js" type="text/javascript" ></script>

        <!--                    WEB CLIENT                           -->
        <script src="webClientDeps_min.js" type="text/javascript" ></script>
        <link   href="webClientDeps.css" type="text/css" rel="stylesheet" />

        <script src="webClient_min.js" type="text/javascript" ></script>
        <link   href="webClient.css"      type="text/css" rel="stylesheet" />

        <script src="webClientGraphics.js" type="text/javascript"></script>

        <script src="testMap.js" type="text/javascript"></script>

        <script type="text/javascript">
          window.onerror = function( e ){ cwt.error( "error: {0}", e ); }

          function start(){
            document.getElementById("cwt_maplayer").height = window.innerHeight;
            document.getElementById("cwt_maplayer").width = window.innerWidth;
    
            log.toggle();

            cwt.util.setDebug( false );
            cwt.start();
            cwt.loadDefaultMod();
            cwt.loadMap( testMap );
            cwtwc.imageLoadingStatus.init();
            cwtwc.completeRedraw();

            function waitWebClient(){

              // wait for loading and filtering
              if( cwtwc.imageLoadingStatus.current !== "ready" ){
                setTimeout( waitWebClient, 250);
              }
              // else start rendering
              else { // stepWebClient();

                var start = new Date().getTime();
                function x(){
                  requestAnimationFrame( x );

                  var now = new Date().getTime();
                  var time = now - start;
                  start = now;

                  cl.update( time );
                }

                window.requestAnimationFrame( x );
              }
            }

            var fpsOut = document.getElementById('fps');
            var fpsFilter = 25;
            var fps = 0, now, lastUpdate = (new Date)*1 - 1;
            var cl = cwtwc;
            function stepWebClient(){
              var diff = ((now=new Date) - lastUpdate);

              // calculate fps
              var thisFrameFPS = 1000 / diff;
              fps += (thisFrameFPS - fps) / fpsFilter;
              lastUpdate = now * 1 - 1;
              fpsOut.innerHTML = fps.toFixed(1) + "fps";

              // update game
              cl.update(diff);

              // better than intervall because intervall slows down if the draw routine needs
              // longer to finish than the set interval. This can be better controlled later to
              // get a stable fps.
              setTimeout( stepWebClient, 20-diff ); //TODO do a better fps management here!
            }

            waitWebClient();
          }
        </script>
    </head>

    <body onLoad="start();"
          onkeydown="cwtwc._keyboardEvent( event );">

      <div id="app">

              <div id="fps" style="position: absolute;" ></div>

              <!-- MAP -->
              <canvas id="cwt_maplayer" class="draw_panel" >
                  <div style="color: red;" >
                    could not display map container! </div> </canvas>

              <!-- MENU -->
              <div id="menu">
                <ul class="cwtwc_menu">

                  <li><button id="menuEntry_0" onclick="cwt.input.doAction(0)"></button></li>
                  <li><button id="menuEntry_1" onclick="cwt.input.doAction(1)"></button></li>
                  <li><button id="menuEntry_2" onclick="cwt.input.doAction(2)"></button></li>
                  <li><button id="menuEntry_3" onclick="cwt.input.doAction(3)"></button></li>
                  <li><button id="menuEntry_4" onclick="cwt.input.doAction(4)"></button></li>
                  <li><button id="menuEntry_5" onclick="cwt.input.doAction(5)"></button></li>
                  <li><button id="menuEntry_6" onclick="cwt.input.doAction(6)"></button></li>
                  <li><button id="menuEntry_7" onclick="cwt.input.doAction(7)"></button></li>
                  <li><button id="menuEntry_8" onclick="cwt.input.doAction(8)"></button></li>
                  <li><button id="menuEntry_9" onclick="cwt.input.doAction(9)"></button></li>

                  <li><button                  onclick="cwt.input.back()" >CANCEL</button></li>

                </ul>
              </div>
      </div>
    </body>
</html>