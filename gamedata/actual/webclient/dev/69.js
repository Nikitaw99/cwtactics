var Lawnchair=function(e,t){if(!(this instanceof Lawnchair))return new Lawnchair(e,t);if(!JSON)throw"JSON unavailable! Include http://www.json.org/json2.js to fix.";if(!(2>=arguments.length&&arguments.length>0))throw"Incorrect # of ctor args!";if(t="function"==typeof arguments[0]?arguments[0]:arguments[1],e="function"==typeof arguments[0]?{}:arguments[0],"function"!=typeof t)throw"No callback was provided";this.record=e.record||"record",this.name=e.name||"records";var o;if(e.adapter){for(var n=0,r=Lawnchair.adapters.length;r>n;n++)if(Lawnchair.adapters[n].adapter===e.adapter){o=Lawnchair.adapters[n].valid()?Lawnchair.adapters[n]:void 0;break}}else for(var n=0,r=Lawnchair.adapters.length;r>n&&!(o=Lawnchair.adapters[n].valid()?Lawnchair.adapters[n]:void 0);n++);if(!o)throw"No valid adapter.";for(var l in o)this[l]=o[l];for(var n=0,r=Lawnchair.plugins.length;r>n;n++)Lawnchair.plugins[n].call(this);this.init(e,t)};Lawnchair.adapters=[],Lawnchair.adapter=function(e,t){t.adapter=e;var o="adapter valid init keys save batch get exists all remove nuke".split(" "),n=this.prototype.indexOf;for(var r in t)if(-1===n(o,r))throw"Invalid adapter! Nonstandard method: "+r;Lawnchair.adapters.splice(0,0,t)},Lawnchair.plugins=[],Lawnchair.plugin=function(e){for(var t in e)"init"===t?Lawnchair.plugins.push(e[t]):this.prototype[t]=e[t]},Lawnchair.prototype={isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},indexOf:function(e,t,o,n){if(e.indexOf)return e.indexOf(t);for(o=0,n=e.length;n>o;o++)if(e[o]===t)return o;return-1},lambda:function(e){return this.fn(this.record,e)},fn:function(e,t){return"string"==typeof t?Function(e,t):t},uuid:function(){var e=function(){return(0|65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},each:function(e){var t=this.lambda(e);if(this.__results)for(var o=0,n=this.__results.length;n>o;o++)t.call(this,this.__results[o],o);else this.all(function(e){for(var o=0,n=e.length;n>o;o++)t.call(this,e[o],o)});return this}},Lawnchair.adapter("dom",function(){var e=window.localStorage,t=function(t){return{key:t+"._index_",all:function(){var t=e.getItem(this.key);return t&&(t=JSON.parse(t)),null===t&&e.setItem(this.key,JSON.stringify([])),JSON.parse(e.getItem(this.key))},add:function(t){var o=this.all();o.push(t),e.setItem(this.key,JSON.stringify(o))},del:function(t){for(var o=this.all(),n=[],r=0,l=o.length;l>r;r++)o[r]!=t&&n.push(o[r]);e.setItem(this.key,JSON.stringify(n))},find:function(e){for(var t=this.all(),o=0,n=t.length;n>o;o++)if(e===t[o])return o;return!1}}};return{valid:function(){return!!e},init:function(e,o){this.indexer=t(this.name),o&&this.fn(this.name,o).call(this,this)},save:function(t,o){var n=t.key?this.name+"."+t.key:this.name+"."+this.uuid();return this.indexer.find(n)===!1&&this.indexer.add(n),delete t.key,e.setItem(n,JSON.stringify(t)),t.key=n.slice(this.name.length+1),o&&this.lambda(o).call(this,t),this},batch:function(e,t){for(var o=[],n=0,r=e.length;r>n;n++)this.save(e[n],function(e){o.push(e)});return t&&this.lambda(t).call(this,o),this},keys:function(e){if(e){var t=this.name,o=this.indexer.all().map(function(e){return e.replace(t+".","")});this.fn("keys",e).call(this,o)}return this},get:function(t,o){if(this.isArray(t)){for(var n=[],r=0,l=t.length;l>r;r++){var i=this.name+"."+t[r],a=e.getItem(i);a&&(a=JSON.parse(a),a.key=t[r],n.push(a))}o&&this.lambda(o).call(this,n)}else{var i=this.name+"."+t,a=e.getItem(i);a&&(a=JSON.parse(a),a.key=t),o&&this.lambda(o).call(this,a)}return this},exists:function(e,t){var o=this.indexer.find(this.name+"."+e)===!1?!1:!0;return this.lambda(t).call(this,o),this},all:function(t){for(var o,n,r=this.indexer.all(),l=[],i=0,a=r.length;a>i;i++)n=r[i],o=JSON.parse(e.getItem(n)),o.key=n.replace(this.name+".",""),l.push(o);return t&&this.fn(this.name,t).call(this,l),this},remove:function(t,o){var n=this.name+"."+(t.key?t.key:t);return this.indexer.del(n),e.removeItem(n),o&&this.lambda(o).call(this),this},nuke:function(e){return this.all(function(t){for(var o=0,n=t.length;n>o;o++)this.remove(t[o]);e&&this.lambda(e).call(this)}),this}}}()),Lawnchair.adapter("window-name",function(e,t){var o=window.top.name?JSON.parse(window.top.name):{};return{valid:function(){return window.top.name!==void 0},init:function(n,r){o[this.name]=o[this.name]||{index:[],store:{}},e=o[this.name].index,t=o[this.name].store,this.fn(this.name,r).call(this,this)},keys:function(t){return this.fn("keys",t).call(this,e),this},save:function(n,r){var l=n.key||this.uuid();return n.key&&delete n.key,this.exists(l,function(i){i||e.push(l),t[l]=n,window.top.name=JSON.stringify(o),n.key=l,r&&this.lambda(r).call(this,n)}),this},batch:function(e,t){for(var o=[],n=0,r=e.length;r>n;n++)this.save(e[n],function(e){o.push(e)});return t&&this.lambda(t).call(this,o),this},get:function(e,o){var n;if(this.isArray(e)){n=[];for(var r=0,l=e.length;l>r;r++)n.push(t[e[r]])}else n=t[e],n&&(n.key=e);return o&&this.lambda(o).call(this,n),this},exists:function(e,o){return this.lambda(o).call(this,!!t[e]),this},all:function(o){for(var n=[],r=0,l=e.length;l>r;r++){var i=t[e[r]];i.key=e[r],n.push(i)}return this.fn(this.name,o).call(this,n),this},remove:function(n,r){for(var l=this.isArray(n)?n:[n],i=0,a=l.length;a>i;i++)delete t[l[i]],e.splice(this.indexOf(e,l[i]),1);return window.top.name=JSON.stringify(o),r&&this.lambda(r).call(this),this},nuke:function(t){return storage={},e=[],window.top.name=JSON.stringify(o),t&&this.lambda(t).call(this),this}}}());