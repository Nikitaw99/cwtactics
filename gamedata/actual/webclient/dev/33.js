controller.registerInvokableCommand("deactivateCoPower"),controller.registerInvokableCommand("activateCoPower"),controller.registerInvokableCommand("activateSuperCoPower"),controller.registerInvokableCommand("modifyPowerLevel"),controller.defineEvent("modifyPowerLevel"),controller.defineEvent("activateSuperCoPower"),controller.defineEvent("activateCoPower"),controller.defineEvent("deactivateCoPower"),controller.defineGameConfig("coStarCost",5,5e4,9e3,5),controller.defineGameConfig("coStarCostIncrease",0,5e4,1800,5),controller.defineGameConfig("coStarCostIncreaseSteps",0,50,10),model.coTypeParser.addHandler(function(e){return util.expectNumber(e,"coStars",!0,!0,-1,10)?util.not(e,"coStars",0)?util.expectNumber(e,"scoStars",!0,!0,-1,10)?util.not(e,"scoStars",0)?util.expectArray(e,"d2d",!0)?util.expectArray(e,"cop",!0)?util.expectArray(e,"scop",!0)?util.expectString(e,"faction",!0)?util.isIn(e.faction,model.factionTypes)?util.expectString(e,"music",!1)?void 0:!0:!0:!0:!0:!0:!0:!0:!0:!0:!0}),model.coData=util.list(constants.MAX_PLAYER,function(){return{power:0,timesUsed:0,level:0,coA:null,coB:null}}),controller.persistenceHandler(function(e){var t=e.co;constants.MAX_PLAYER!==t.length&&util.raiseError("");for(var r,o,n=0,l=constants.MAX_PLAYER;l>n;n++)o=model.coData[n],r=t[n],0===r?(o.power=0,o.timesUsed=0,o.level=model.INACTIVE_POWER,o.coA=null,o.coB=null):(o.power=r[0],o.timesUsed=r[1],o.level=r[2],o.coA=r[3]?model.coTypes[r[3]]:null,o.coB=r[4]?model.coTypes[r[4]]:null)},function(e){for(var t,r=[],o=0,n=constants.MAX_PLAYER;n>o;o++)t=model.coData[o],model.players[o].team===constants.INACTIVE_ID?r.push(0):r.push([t.power,t.timesUsed,t.level,t.coA,t.coB]);e.co=r}),model.powerLevel={INACTIVE:0,COP:1,SCOP:2,TSCOP:3},util.scoped(function(){function e(e,t,r){model.isValidPlayerId(e)||model.criticalError(constants.error.ILLEGAL_PARAMETERS,constants.error.UNKNOWN_PLAYER_ID);var o=model.coData[e];o.power=0,o.level=t,o.timesUsed++,controller.events[r](e)}model.deactivateCoPower=function(t){e(t,model.powerLevel.INACTIVE,"deactivateCoPower")},model.activateCoPower=function(t){e(t,model.powerLevel.COP,"activateCoPower")},model.activateSuperCoPower=function(t){e(t,model.powerLevel.SCOP,"activateSuperCoPower")}}),model.modifyPowerLevel=function(e,t){var r=model.coData[e];r.power+=t,0>r.power&&(r.power=0),controller.events.modifyPowerLevel(e,t)},model.canActivatePower=function(e,t){var r=model.coData[model.turnOwner];if(null===r.coA)return!1;if(r.level!==model.powerLevel.INACTIVE)return!1;var o;switch(t){case model.powerLevel.COP:o=r.coA.coStars;break;case model.powerLevel.SCOP:o=r.coA.scoStars;break;default:model.criticalError(constants.error.ILLEGAL_PARAMETERS,constants.error.UNKNOWN)}return r.power>=model.coStarCost(model.turnOwner)*o},model.coStarCost=function(e){var t=controller.configValue("coStarCost"),r=model.coData[e].timesPowerUsed,o=controller.configValue("coStarCostIncreaseSteps");return r>o&&(r=o),t+=r*controller.configValue("coStarCostIncrease")},model.setMainCo=function(e,t){model.coData[e].coA=null===t?null:model.coTypes[t]};