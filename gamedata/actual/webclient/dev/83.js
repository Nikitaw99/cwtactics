controller.mapCursorX=0,controller.mapCursorY=0,controller.mapTargetCursorX=0,controller.mapTargetCursorY=0,controller.resetMapCursor=function(){controller.mapCursorX=0,controller.mapCursorY=0},controller.cursorAction=function(e){if(!controller.inAnimationHookPhase()){var t=controller.stateMachine.state,o="MOVEPATH_SELECTION"===t||"IDLE_R"===t||"ACTION_SELECT_TARGET_A"===t||"ACTION_SELECT_TARGET_B"===t;e?controller.stateMachine.event("cancel",controller.mapCursorX,controller.mapCursorY):-1!==controller.menuCursorIndex?controller.stateMachine.event("action",controller.menuCursorIndex):controller.stateMachine.event("action",controller.mapCursorX,controller.mapCursorY);var n=controller.stateMachine.state,r="MOVEPATH_SELECTION"===n||"IDLE_R"===n||"ACTION_SELECT_TARGET_A"===n||"ACTION_SELECT_TARGET_B"===n;if((o&&!r||r)&&view.markSelectionMapForRedraw(controller.stateMachine.data),"ACTION_MENU"===n||"ACTION_SUBMENU"===n){var i=controller.stateMachine.data.menu;controller.showMenu(i,controller.mapCursorX,controller.mapCursorY)}else("ACTION_MENU"===t||"ACTION_SUBMENU"===t)&&controller.hideMenu()}},controller.cursorActionCancel=function(){controller.cursorAction(!0),controller.playSound("CANCEL")},controller.cursorActionClick=function(){controller.cursorAction(!1),controller.playSound("ACTION")},controller.moveCursor=function(e,t){1===arguments.length&&(t=1),controller.eraseWantedCursorPosition();var o=controller.mapCursorX,n=controller.mapCursorY;switch(e){case model.moveCodes.UP:n--;break;case model.moveCodes.RIGHT:o++;break;case model.moveCodes.DOWN:n++;break;case model.moveCodes.LEFT:o--}controller.setCursorPosition(o,n)},controller.setWantedCursorPosition=function(e,t){controller.mapTargetCursorX=e,controller.mapTargetCursorY=t},controller.eraseWantedCursorPosition=function(){controller.mapTargetCursorX=-1,controller.mapTargetCursorY=-1},controller.setCursorPosition=function(e,t,o){if(!controller.isMenuOpen()&&(o&&(e+=controller.screenX,t+=controller.screenY),model.isValidPosition(e,t)&&(e!==controller.mapCursorX||t!==controller.mapCursorY))){view.markForRedraw(controller.mapCursorX,controller.mapCursorY),controller.mapCursorY<model.mapHeight-1&&view.markForRedraw(controller.mapCursorX,controller.mapCursorY+1),controller.playSound("MAPTICK"),view.markForRedraw(controller.mapCursorX,controller.mapCursorY),controller.mapCursorX=e,controller.mapCursorY=t,controller.updateSimpleTileInformation();var n=controller.screenScale;0===n?n=.8:-1===n&&(n=.7);var r=parseInt(parseInt((window.innerWidth-80)/16,10)/n,10),i=parseInt(parseInt((window.innerHeight-80)/16,10)/n,10);0>controller.sideSimpleTileInformationPanel&&.25*r>e-controller.screenX&&controller.moveSimpleTileInformationToRight(),controller.sideSimpleTileInformationPanel>0&&e-controller.screenX>=.75*r&&controller.moveSimpleTileInformationToLeft();var l=-1;1>=e-controller.screenX?l=model.moveCodes.LEFT:e-controller.screenX>=r-1?l=model.moveCodes.RIGHT:1>=t-controller.screenY?l=model.moveCodes.UP:t-controller.screenY>=i-1&&(l=model.moveCodes.DOWN),-1!==l&&controller.shiftScreenPosition(l,5),constants.DEBUG&&util.log("set cursor position to",e,t,"screen node is at",controller.screenX,controller.screenY),view.markForRedraw(e,t)}};