controller.setupMouseControls=function(e,t){function o(e){if(controller.inputCoolDown>0)return!1;if(controller.menuVisible)return!1;var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));t>0?controller.screenStateMachine.event("INP_SPECIAL_5"):controller.screenStateMachine.event("INP_SPECIAL_6"),controller.inputCoolDown=1e3}constants.DEBUG&&util.log("initializing mouse support");var n=!1;t.onmouseout=function(){n=!1},t.onmouseover=function(){n=!0},document.addEventListener&&(document.addEventListener("mousewheel",o,!1),document.addEventListener("DOMMouseScroll",o,!1));var r=TILE_LENGTH,i=0,a=0,l=0;document.addEventListener("mousemove",function(e){var t=e.target.id;if("cwt_canvas"===t||controller.menuVisible){var o,n;e=e||window.event,controller.menuVisible?(o=e.pageX,n=e.pageY,-1!==l?l-16>=n?(controller.screenStateMachine.event("INP_UP"),l=n):n>=l+16&&(controller.screenStateMachine.event("INP_DOWN"),l=n):l=n):("number"==typeof e.offsetX?(o=e.offsetX,n=e.offsetY):(o=e.layerX,n=e.layerY),o=parseInt(o/r,10),n=parseInt(n/r,10),controller.screenStateMachine.event("INP_HOVER",o,n))}}),document.onmousedown=function(e){e=e||window.event,"number"==typeof e.offsetX?(i=e.offsetX,a=e.offsetY):(i=e.layerX,a=e.layerY)},document.onmouseup=function(e){e=e||window.event;var t,o;switch("number"==typeof e.offsetX?(t=e.offsetX,o=e.offsetY):(t=e.layerX,o=e.layerY),Math.abs(i-t),Math.abs(a-o),l=-1,e.which){case 1:controller.screenStateMachine.event("INP_ACTION");break;case 2:break;case 3:controller.screenStateMachine.event("INP_CANCEL")}}};