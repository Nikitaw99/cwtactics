controller.registerInvokableCommand("buildUnit"),controller.defineEvent("buildUnit"),model.unitTypeParser.addHandler(function(e){return util.expectNumber(e,"cost",!0,!0,0,99999)?void 0:!1}),model.tileTypeParser.addHandler(function(e){if(util.expectArray(e,"builds",!1)===util.expectMode.DEFINED)for(var t=e.builds,r=0,o=t.length;o>r;r++)if(!util.expectString(t,r,!0))return!1}),model.buildUnit=function(e,t,r){var o=model.getPropertyByPos(e,t);o||model.criticalError(constants.error.ILLEGAL_PARAMETERS,constants.error.PROPERTY_NOT_FOUND),o.owner===constants.INACTIVE_ID&&model.criticalError(constants.error.ILLEGAL_PARAMETERS,constants.error.UNKNOWN_PLAYER_ID);var n=controller.events.buildUnit;n&&n(e,t,r);var l=model.createUnit(model.turnOwner,e,t,r),a=model.unitTypes[r].cost,i=model.players[o.owner];a>i.gold&&model.criticalError(constants.error.ILLEGAL_DATA,constants.error.NOT_ENOUGH_MONEY),i.gold-=a,model.decreaseManpower(model.turnOwner),model.markUnitNonActable(l)},model.propertyCanBuild=function(e){if(!model.isFactory(e))return!1;var t=model.properties[e].owner;return model.hasLeftManpower(t)?model.hasFreeUnitSlots(t)?!0:!1:!1},model.isFactory=function(e){return model.properties[e].type.builds},model.getBuildMenu=function(e,t){model.isFactory(e)||model.criticalError(constants.error.ILLEGAL_DATA,constants.error.FACTORY_EXPECTED);for(var r=model.properties[e],o=model.players[r.owner].gold,n=model.listOfUnitTypes,l=r.type.builds,a=0,i=n.length;i>a;a++){var s=n[a],c=model.unitTypes[s];c.cost>o||-1!==l.indexOf(c.movetype)&&t.addEntry(s)}};