(function(){var t=function(t){"string"==typeof t&&(t=JSON.parse(t));for(var n=0,e=t.length;e>n;n++){var r=t[n];if(void 0!==r.$set&&"boolean"!=typeof r.$set)throw Error("rule.$set value must be a boolean");if(void 0!==r.$when){var o=r.$when;if(0!==o.length%2)throw Error("rule.$when lenght must be odd");for(var i=0,s=o.length;s>i;i+=2);}}},n=function(t,n,e,r){"number"!=typeof r&&(r=0);for(var o=0,i=t.length;i>o;o++){var s=t[o],h=s[e];if("number"==typeof h){var p=!0,a=s.$when;if(a)for(var u=0,c=a.length;c>u;u+=2){var f=n[a[u]],l=a[u+1],E=!1;if(l[0]===!0)f>=l[1]&&l[2]>=f&&(E=!0);else for(var d=0,v=l.length;v>d;d++)if(f===l[d]){E=!0;break}if(!E){p=!1;break}}p&&(s.$set&&(r=0),r+=h)}}return r};"undefined"!=typeof exports&&(exports.mapStrings=t,exports.solve=n),"undefined"!=typeof window&&(window.jsonScript||(window.jsonScript={}),window.jsonScript.mapStrings=t,window.jsonScript.solve=n)})(),function(){var t={"":["RULE"],END:["RULE",null],RULE:["WHEN","THEN"],WHEN:["SLOT","THEN"],SLOT:["IS","IN","BETWEEN"],IS:["SLOT","THEN"],IN:["SLOT","THEN"],BETWEEN:["SLOT","THEN"],THEN:["INCREASE","DECREASE","END"],INCREASE:["INCREASE","DECREASE","END"],DECREASE:["INCREASE","DECREASE","END"]},n=function(n){var e,r,o,i,s,h;h=t[""],o=[],n=n.replace(/(\r\n|\n|\r|\n|\t)/gm," "),r=n.split(" ");for(var p=0,a=r.length;a>p;p++)if(e=r[p],0!==e.length){if(-1===h.indexOf(e))throw Error(e+" token not allowed => expected "+JSON.stringify(h));switch(e){case"RULE":i={},o.push(i);break;case"WHEN":s=[];break;case"THEN":null!==s&&(i.$when=s,s=null);break;case"SLOT":s.push(r[p+1]),p+=1;break;case"IS":s.push([!0,r[p+1],r[p+1]]),p+=1;break;case"BETWEEN":if(s.push(r[p+1].split(",")),2!==s[s.length-1].length)throw Error("BETWEEN expects list with two values (lower,upper)");p+=1;break;case"IN":s.push(r[p+1].split(",")),p+=1;break;case"INCREASE":if("BY"!==r[p+2])throw Error("by expected after attribute but found "+r[p+2]);var u=parseInt(r[p+3],10);if("number"!=typeof u)throw Error("number expected by increase");i[r[p+1]]=u,p+=3;break;case"DECREASE":if("BY"!==r[p+2])throw Error("by expected after attribute but found "+r[p+2]);var u=-parseInt(r[p+3],10);if("number"!=typeof u)throw Error("number expected by decrease");i[r[p+1]]=u,p+=3;break;case"END":i=null;break;default:throw Error("unknown token => "+e)}h=t[e]}if(-1===h.indexOf(null))throw Error("end of rule defintion is not allowed");return o},e=function(t){for(var n,e,r=[],o=0,i=t.length;i>o;o++){if(n=t[o],e=Object.keys(n),r.push("RULE"),r.push("\n"),n.$when)for(var s=n.$when,h=0,p=s.length;p>h;h+=2)r.push(" SLOT"),r.push(s[h]),s[h+1][0]===!0?s[h+1][1]===s[h+1][2]?(r.push("IS"),r.push(s[h+1][1])):(r.push("BETWEEN"),r.push(s[h+1][1]+","+s[h+1][2])):(r.push("IN"),r.push(s[h+1].join(","))),r.push("\n");r.push("THEN"),r.push("\n");for(var h=0,p=e.length;p>h;h++)"$when"!==e[h]&&(0>n[e[h]]?r.push(" DECREASE"):r.push(" INCREASE"),r.push(e[h]),r.push("BY"),r.push(0>n[e[h]]?-n[e[h]]:n[e[h]]),r.push("\n"));r.push("END"),r.push("\n")}return r.join(" ")};"undefined"!=typeof exports&&(exports.compile=n,exports.decompile=e),"undefined"!=typeof window&&(window.jsonScript||(window.jsonScript={}),window.jsonScript.compile=n,window.jsonScript.decompile=e)}();