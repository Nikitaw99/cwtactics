util.scoped(function(){function e(e,t,n,r){if(n-=r-1,!(0>n||n>9)){var i=TILE_LENGTH,a=48*n,l=0,s=48,c=48,d=e*i,u=t*i,m=i,p=i;view.canvasCtx.drawImage(o,a,l,s,c,d,u,m,p),view.markForRedraw(e,t)}}function t(e,t){if(model.isValidPosition(e,t)){var o=model.unitPosMap[e][t];null!==o&&controller.updateUnitStatus(model.extractUnitId(o))}}var o,n;view.registerAnimationHook({key:"startFireSilo",prepare:function(e,t,o,r,i){n||(n=view.getInfoImageForType("FLYING_ROCKET")),this.siloX=controller.getCanvasPosX(e),this.siloY=controller.getCanvasPosY(t),this.targetX=controller.getCanvasPosX(r),this.targetY=controller.getCanvasPosY(i),this.curX=this.siloX,this.curY=this.siloY,this.phase=0},render:function(){var e=TILE_LENGTH,t=0,o=0,r=24,i=24,a=this.curX*e-4,l=this.curY*e-4,s=e+8,c=e+8;view.canvasCtx.drawImage(n,t,o,r,i,a,l,s,c),view.markForRedrawWithNeighboursRing(this.curX,this.curY)},update:function(e){var t=e/1e3*8*tileSize;0===this.phase?(this.curY-=t,0>=this.curY&&(controller.setScreenPosition(this.targetX,this.targetY,!0),this.curX=this.targetX,this.curY=0,this.phase=1)):(this.curY+=t,this.curY>=this.targetX&&(this.phase=2))},isDone:function(){return 2===this.phase}}),view.registerAnimationHook({key:"doExplosionAt",prepare:function(e,t,n){o||(o=view.getInfoImageForType("EXPLOSION_GROUND")),controller.playSound("ROCKET_IMPACT"),this.x=e,this.y=t,this.range=n,this.maxStep=10+n+1,this.step=0,this.time=0},render:function(){model.doInRange(this.x,this.y,this.range,e,this.step)},update:function(e){this.time+=e,this.time>75&&(this.step++,this.time=0)},isDone:function(){var e=this.step===this.maxStep;return e&&model.doInRange(this.x,this.y,this.range,t),e}}),controller.onEvent("fireCannon",function(){controller.playSound("CANNON")})});