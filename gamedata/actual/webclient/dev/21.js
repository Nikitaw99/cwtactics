controller.stateMachine.data={source:Object.create(controller.TaggedPosition),target:Object.create(controller.TaggedPosition),targetselection:Object.create(controller.TaggedPosition),thereIsUnitRelationShip:function(t,e){return t.unit&&t.unit===e.unit?model.relationModes.SAME_OBJECT:model.relationShipCheck(null!==t.unit?t.unit.owner:-1,null!==e.unit?e.unit.owner:-1)},thereIsUnitToPropertyRelationShip:function(t,e){return model.relationShipCheck(null!==t.unit?t.unit.owner:-1,null!==e.property?e.property.owner:null)},action:{selectedEntry:null,selectedSubEntry:null,object:null},movePath:{data:util.scoped(function(){var t=util.list(constants.MAX_SELECTION_RANGE,constants.INACTIVE_ID);return t.getLastCode=function(){for(var t=this.length-1;t>0;t--)if(this[t]!==constants.INACTIVE_ID)return this[t];return constants.INACTIVE_ID},t.getSize=function(){for(var t=this.length-1;t>0;t--)if(this[t]!==constants.INACTIVE_ID)return t+1;return 0},t}),clean:function(){this.data.resetValues()},clone:function(){for(var t=[],e=0,n=this.data.length;n>e&&-1!==this.data[e];e++)t[e]=this.data[e];return t},addCodeToPath:function(t,e,n){var r=model.addMoveCodeToPath(n,this.data);r||this.setPathByRecalculation(t,e)},setPathByRecalculation:function(t,e){var n=controller.stateMachine.data,r=n.source,o=n.selection,i=n.movePath.data;this.data.resetValues(),model.generatePath(r.x,r.y,t,e,o,i)},fillMoveMap:function(t,e,n){var r=controller.stateMachine.data;model.fillMoveMap(r.source,r.selection,t,e,n)}},menu:{data:util.list(20,null),enabled:util.list(20,null),extraData:util.list(20,null),size:0,addEntry:function(t,e,n){this.size===this.data.length&&util.raiseError(),this.data[this.size]=t,e!==!1&&(e=!0),this.enabled[this.size]=t,n||(n=null),this.extraData[this.size]=n,this.size++},clean:function(){this.size=0},generate:util.scoped(function(){var t;return function(){t||(t=Object.keys(controller.actionObjects));var e=controller.stateMachine.data,n=!1,r=!0,o=e.source.unit;null===o||o.owner!==model.turnOwner?r=!1:model.canAct(e.source.unitId)||(r=!1);var i=!0,a=e.source.property;null!==o&&(i=!1),(null===a||a.owner!==model.turnOwner)&&(i=!1),r||i||(n=!0);for(var l=e.thereIsUnitRelationShip(e.source,e.target),s=e.thereIsUnitRelationShip(e.source,e.targetselection),c=e.thereIsUnitToPropertyRelationShip(e.source,e.target),u=e.thereIsUnitToPropertyRelationShip(e.source,e.targetselection),E=0,h=t.length;h>E;E++){var _=controller.actionObjects[t[E]];if(_.clientAction||model.isClientPlayer(model.turnOwner)&&!controller.isPlayerAiControlled(model.turnOwner)){if(_.unitAction){if(!r)continue;if(_.relation){var d=null;"S"===_.relation[0]&&"T"===_.relation[1]?d=l:"S"===_.relation[0]&&"ST"===_.relation[1]?d=s:model.criticalError(constants.error.UNKNOWN,constants.error.UNKNOWN);for(var T=!1,p=2,A=_.relation.length;A>p;p++)_.relation[p]===d&&(T=!0);if(!T)continue}if(_.relationToProp){var d=null;"S"===_.relation[0]&&"T"===_.relationToProp[1]?d=c:"S"===_.relation[0]&&"ST"===_.relationToProp[1]?d=u:model.criticalError(constants.error.UNKNOWN,constants.error.UNKNOWN);for(var T=!1,p=2,A=_.relationToProp.length;A>p;p++)_.relationToProp[p]===d&&(T=!0);if(!T)continue}}else if(_.propertyAction){if(!i)continue}else{if(_.mapAction===!0&&!n)continue;if(_.clientAction===!0&&!n)continue}(!_.condition||_.condition(e))&&e.menu.addEntry(t[E])}}}})},selection:util.scoped(function(){var t=util.selectionMap(4*constants.MAX_SELECTION_RANGE+1);return t.prepare=function(){var t=controller.stateMachine.data.target,e=t.x,n=t.y;this.setCenter(e,n,-1);var r=controller.stateMachine.data.action.object;return r.prepareTargets(controller.stateMachine.data),"A"===r.targetSelectionType?"ACTION_SELECT_TARGET_A":"ACTION_SELECT_TARGET_B"},t}),selectionRange:-1,inMultiStep:!1};