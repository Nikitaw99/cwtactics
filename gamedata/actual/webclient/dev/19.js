controller.scriptTags={},controller.prepareTags=function(t,e,r,o,n,i){var l=controller.scriptTags;l.__oldUnit__&&(l[l.__oldUnit__]=!1),l.__oldTile__&&(l[l.__oldTile__]=!1),l.INDIRECT=!1,l.DIRECT=!1;var s=r>-1?model.units[r]:model.unitPosMap[t][e];s&&(l.__oldUnit__=s.type.ID,l[l.__oldUnit__]=!0,model.isIndirectUnit(r>-1?r:model.extractUnitId(s))?l.INDIRECT=!0:l.DIRECT=!0);var a=model.map[t][e].ID,c=model.propertyPosMap[t][e];c&&(a=c.type.ID),l.__oldTile__=a,l[l.__oldTile__]=!0,arguments.length>3&&(l.OTHER_INDIRECT=!1,l.OTHER_DIRECT=!1,s=i>-1?model.units[i]:model.unitPosMap[o][n],s&&(model.isIndirectUnit(i>-1?i:model.extractUnitId(s))?l.OTHER_INDIRECT=!0:l.OTHER_DIRECT=!0))},controller.configBoundaries_={},controller.defineGameConfig=function(t,e,r,o,n){(!t||controller.configBoundaries_.hasOwnProperty(t))&&model.criticalError(constants.error.ILLEGAL_PARAMETERS,constants.error.ILLEGAL_CONFIG_VAR_DEFINTION),(e>r||e>o||o>r)&&model.criticalError(constants.error.ILLEGAL_PARAMETERS,constants.error.ILLEGAL_CONFIG_VAR_DEFINTION),controller.configBoundaries_[t]={min:e,max:r,defaultValue:o,step:"number"==typeof n?n:1}},controller.buildRoundConfig=function(t){var e=controller.configBoundaries_;model.configRule={};for(var r=Object.keys(e),o=0,n=r.length;n>o;o++){var i,l=r[o];t&&t.hasOwnProperty(l)?(i=t[l],e[l].min>i&&util.raiseError(l,"is greater than it's minimum value"),i>e[l].max&&util.raiseError(l,"is greater than it's maximum value"),e[l].hasOwnProperty("step")&&0!==i%e[l].step&&util.raiseError(l,"is does not fits one of it's possible values")):i=e[l].defaultValue,model.configRule[l]=i}},controller.configValue=function(t){return model.configRule[t]},controller.scriptBoundaries_={},controller.defineGameScriptable=function(t,e,r){(!t||controller.scriptBoundaries_.hasOwnProperty(t)||e>r)&&model.criticalError(constants.error.ILLEGAL_PARAMETERS,constants.error.ILLEGAL_CONFIG_VAR_DEFINTION),controller.scriptBoundaries_[t]=[e,r]},util.scoped(function(){function t(t,e,r,o){for(var n=0,i=t.length;i>n;n++){var l=t[n];if(l){var s=l[r];if("number"==typeof s){var a,c;if(c=l.$all,c!==void 0){a=!1;for(var E=0,u=c.length;u>E;E++)if(e[c[E]]!==!0){a=!0;break}if(a)continue}if(c=l.$any,c!==void 0){a=!0;for(var E=0,u=c.length;u>E;E++)if(e[c[E]]===!0){a=!1;break}if(a)continue}o+=s}}}return bounds=controller.scriptBoundaries_[r],void 0!==bounds?bounds[0]>o?o=bounds[0]:o>bounds[1]&&(o=bounds[1]):util.raiseError("no boundaries given for "+r),o}controller.scriptedValue=function(e,r,o){"number"!=typeof o&&util.raiseError("numberic value as parameter value expected");var n=controller.scriptTags;o=t(model.globalRules,n,r,o),o=t(model.mapRules,n,r,o);var i=model.players[e].mainCo,l=!0;i&&(o=t(i.d2d,n,r,o),l=0===t(i.d2d,n,"neutralizeWeather",0));var s=model.weather;l&&s&&(o=t(s.rules,n,r,o));var a=controller.scriptBoundaries_[r];return a[0]>o?o=a[0]:o>a[1]&&(o=a[1]),o}});