controller.colorizeImages=util.singleLazyCall(function(e,t){function o(e){var t=document.createElement("canvas"),o=t.getContext("2d"),r=e.width,n=e.height;return t.width=r,t.height=n,o.drawImage(e,0,0),o.getImageData(0,0,r,n).data}function r(e,t,o,r,n){var i=document.createElement("canvas"),l=i.getContext("2d"),a=e.width,s=e.height;i.width=a,i.height=s,l.drawImage(e,0,0);for(var c=l.getImageData(0,0,a,s),d=4*r*o,u=4*n*o,m=0,p=0;c.height>p;p++)for(var f=0;c.width>f;f++)for(var E=4*p*c.width+4*f,h=c.data[E],v=c.data[E+1],I=c.data[E+2],T=0,_=4*o;_>T;T+=4){var g=t[d+T],A=t[d+T+1],y=t[d+T+2];if(g===h&&A===v&&y===I){var w=u+T,S=t[w],L=t[w+1],N=t[w+2];c.data[E]=S,c.data[E+1]=L,c.data[E+2]=N,m++}}return l.putImageData(c,0,0),i}function n(e){var t=document.createElement("canvas"),o=t.getContext("2d"),r=e.width,n=e.height;t.width=r,t.height=n,o.drawImage(e,0,0);for(var i=o.getImageData(0,0,r,n),l=0;i.height>l;l++)for(var a=0;i.width>a;a++){var s=4*l*i.width+4*a,c=i.data[s+3];c>0&&(i.data[s]=0,i.data[s+1]=0,i.data[s+2]=0)}return o.putImageData(i,0,0),t}if(e)return constants.DEBUG&&util.log("break at colorize images due error from previous inits"),t.pass(!0);constants.DEBUG&&util.log("colorize images"),t.take();try{for(var i=model.graphics,l={BLACK_MASK:8,RED:0,BLUE:3,GREEN:4,colors:6},a={RED:0,GRAY:1,BLUE:3,GREEN:4,YELLOW:5,BLACK_MASK:8,colors:4},s=[view.IMAGE_CODE_IDLE,view.IMAGE_CODE_IDLE_INVERTED,view.IMAGE_CODE_DOWN,view.IMAGE_CODE_UP,view.IMAGE_CODE_RIGHT,view.IMAGE_CODE_LEFT],c=o(view.getInfoImageForType(view.IMG_COLOR_MAP_PROPERTIES_ID)),d=o(view.getInfoImageForType(view.IMG_COLOR_MAP_UNITS_ID)),u=i.units,m=0,p=u.length;p>m;m++)for(var f=u[m][0],E=0,h=s.length;h>E;E++){var v=s[E],I=view.getUnitImageForType(f,v,view.COLOR_RED);view.setUnitImageForType(r(I,d,l.colors,l.RED,l.BLUE,f),f,v,view.COLOR_BLUE),view.setUnitImageForType(r(I,d,l.colors,l.RED,l.GREEN,f),f,v,view.COLOR_GREEN),view.setUnitImageForType(r(I,d,l.colors,l.RED,l.BLACK_MASK,f),f,v,view.COLOR_BLACK_MASK)}for(var T=i.properties,m=0,p=T.length;p>m;m++){var f=T[m][0],I=view.getPropertyImageForType(f,view.COLOR_RED);view.setPropertyImageForType(r(I,c,a.colors,a.RED,a.BLUE),f,view.COLOR_BLUE),view.setPropertyImageForType(r(I,c,a.colors,a.RED,a.GREEN),f,view.COLOR_GREEN),view.setPropertyImageForType(r(I,c,a.colors,a.RED,a.GRAY),f,view.COLOR_NEUTRAL),view.setPropertyImageForType(n(I),f,view.COLOR_BLACK_MASK)}for(var _=i.tiles,m=0,p=_.length;p>m;m++){var f=_[m][0],I=view.getTileImageForType(f);view.setTileShadowImageForType(n(I),f)}t.pass(!1)}catch(p){controller.loadFault(p,t)}});