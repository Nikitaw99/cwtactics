controller.buildAction=function(){var t=controller.stateMachine.data,e=t.target,n=t.source,r=t.movePath,o=t.action,i=o.object,s=!1;if(-1!==r.data[0]){for(var a=r.data,c=n.x,E=n.y,l=0,_=a.length;_>l&&-1!==a[l];l++){switch(a[l]){case model.moveCodes.DOWN:E++;break;case model.moveCodes.UP:E--;break;case model.moveCodes.LEFT:c--;break;case model.moveCodes.RIGHT:c++}var u=model.unitPosMap[c][E];null!==u&&model.players[model.turnOwner].team!==model.players[u.owner].team&&(e.set(c,E),a.splice(l),s=!0)}controller.sharedInvokement("moveUnit",[r.clone(),n.unitId,n.x,n.y])}return s?controller.sharedInvokement("trapWait",[n.unitId]):i.invoke(t),i.unitAction&&"wait"!==o.selectedEntry&&controller.sharedInvokement("markUnitNonActable",[n.unitId]),s};