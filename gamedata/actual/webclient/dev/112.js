controller.setupTouchControls=function(){util.scoped(function(){var e,t,o,n,r,i,a,l,s,c,d,u=0,m=!1;document.addEventListener("touchstart",function(d){if("cwt_options_mapIn"!==d.target.id&&d.preventDefault(),e=d.touches[0].screenX,t=d.touches[0].screenY,o=e,n=t,m=!1,2===d.touches.length){r=d.touches[1].screenX,i=d.touches[1].screenY,a=r,l=i;var u=Math.abs(e-r),p=Math.abs(t-i);c=Math.sqrt(u*u+p*p)}else r=-1;s=d.timeStamp},!1),document.addEventListener("touchmove",function(i){if("cwt_options_mapIn"!==i.target.id&&i.preventDefault(),o=i.touches[0].screenX,n=i.touches[0].screenY,2===i.touches.length){a=i.touches[1].screenX,l=i.touches[1].screenY;var c=Math.abs(o-a),p=Math.abs(n-l);d=Math.sqrt(c*c+p*p)}else r=-1;var c=Math.abs(e-o),p=Math.abs(t-n),f=Math.sqrt(c*c+p*p),E=i.timeStamp-s;if(f>16&&E>300)if(m=!0,u>75){var h;h=c>p?e>o?"INP_LEFT":"INP_RIGHT":t>n?"INP_UP":"INP_DOWN",u=0,e=o,t=n,controller.screenStateMachine.event(h,1)}else u+=E},!1),document.addEventListener("touchend",function(i){if("cwt_options_mapIn"!==i.target.id&&i.preventDefault(),!(controller.inputCoolDown>0)){var a=Math.abs(e-o),l=Math.abs(t-n),u=Math.sqrt(a*a+l*l),m=i.timeStamp-s;if(-1!==r){var p=Math.abs(d-c);if(32>=p)if(a>48||l>48){var f;f=a>l?e>o?"INP_SPECIAL_2":"INP_SPECIAL_1":t>n?"INP_SPECIAL_3":"INP_SPECIAL_4",controller.screenStateMachine.event(f)}else controller.screenStateMachine.event("INP_CANCEL");else c>d?controller.screenStateMachine.event("INP_SPECIAL_6"):controller.screenStateMachine.event("INP_SPECIAL_5");controller.inputCoolDown=500}else if(16>=u)500>=m&&controller.screenStateMachine.event("INP_ACTION");else if(300>=m){var f;f=a>l?e>o?"INP_LEFT":"INP_RIGHT":t>n?"INP_UP":"INP_DOWN",controller.screenStateMachine.event(f,1)}}},!1)})};