(function(){var t={},e=function(t,e,o){var n=function(t,e,o){var n=[],i=function(t,r){var i=n.length+1;n.push(function(){return e(t,r,function(t){var e=n[i];return!t&&e?e():t||e?o(t):o()})})};if(r(t)&&!a(t))for(var l=0,u=t.length;u>l;l++)i(l,t[l]);else{if(!m(t)||a(t))return o();for(l in t)t.hasOwnProperty(l)&&i(l,t[l])}return n[0]()};return o===void 0?function(t,e){if(r(t)&&!a(t))for(var o=0,n=t.length;n>o;o++)e.apply(t,[o,t[o]]);if(m(t)&&!a(t))for(var i in t)t.hasOwnProperty(i)&&e.apply(t,[i,t[i]])}.apply(this,arguments):n.apply(this,arguments)},o=function(t,e,o){return Array.prototype.filter.apply(t,[e,o||this])},r=function(t){return"[object Array]"===Object.prototype.toString.call(t)},n=function(t){return"boolean"==typeof t},i=function(t){return t!==void 0},a=function(t){if(c(t))return!1;if(null===t)return!0;if(r(t)||"string"==typeof t)return 0===t.length;if(m(t))for(var e in t)if(hasOwnProperty.call(t,e))return!1;return!0},l=function(t,e){if(r(t,e))return t.length!==e.length?!1:Array.prototype.every.apply(t,[function(t,o){return e[o]===t}]);if(m(t,e)){var o=Object.keys(t),n=Object.keys(e);if(!l(o,n))return!1;for(key in t)if(!e[key]||t[key]!==e[key])return!1;return!0}return!1},u=function(t){return"function"==typeof t},s=function(t){return c(t)&&0===t%1},d=function(t){return null===t},c=function(t){return"number"==typeof t},m=function(t){return"[object Object]"===Object.prototype.toString.call(t)},p=function(t){return"string"==typeof t},f=function(t){return t===void 0},h=function(t,e){for(var o in e)e.hasOwnProperty(o)&&!t.hasOwnProperty(o)&&(t[o]=e[o]);return t},g=function(t,e){for(var o=[],r=0,n=t.length;n>r;r++){var i=t[r][e];-1===o.indexOf(i)&&o.push(i)}return o},_=function(){return!0};(function(){var A=function(t){var o=this,r={singleError:!0,messages:T,cache:!1};e(r,function(e,n){o[e]=m(n)&&t[e]?h(t[e],r[e]):m(n)&&!t[e]?h({},r[e]):i(t[e])?t[e]:r[e]}),this.errors=new E(this)};A.prototype.attributes={},A.prototype.addAttribute=function(t,e){return A.prototype.attributes[t]=e},A.prototype.addAttributeConstructor=function(t,e){return A.prototype.attributes[t]=e()},A.prototype.addAttribute("additionalProperties",function(t,r,n,i,l){var u=this;if(!0===n)return l();var s=Object.keys(r),s=o(s,function(t){return!i.properties[t]});return a(s)?l():!1===n?(s.forEach(function(e){this.addError({property:this.joinPath(t,e),propertyValue:r[e]})},this),l()):m(n)?e(s,function(e,o,i){return u.validateSchema(r[o],n,t+o,i)},l):void 0}),A.prototype.addAttribute("divisibleBy",function(t,e,o,r,n){if(0===o)throw Error("The value of this attribute should not be 0.");return c(e)&&0!==e%o&&this.addError(),n()}),A.prototype.addAttribute("enum",function(t,e,o,r,n){return-1===o.indexOf(e)&&this.addError(),n()}),A.prototype.addAttribute("except",function(t,e,o,r,n){return-1!==o.indexOf(e)&&this.addError(),n()}),A.prototype.addAttributeConstructor("format",function(){var t={"date-time":{type:"string",pattern:/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-[0-9]{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z$/},date:function(t){return p(t)?t.match(/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-[0-9]{2}$/):m(t)?"[object Date]"===Object.prototype.toString.call(t):!1},time:{type:"string",pattern:/^\d{2}:\d{2}:\d{2}$/},"utc-milisec":{type:"number"},regex:function(t){return t&&t.test&&t.exec},color:{type:"string"},style:{type:"string"},phone:{type:"number"},uri:{type:"string",pattern:/^(?:(?:ht|f)tp(?:s?)\:\/\/|~\/|\/)?(?:\w+:\w+@)?((?:(?:[-\w\d{1-3}]+\.)+(?:com|org|cat|coop|int|pro|tel|xxx|net|gov|mil|biz|info|mobi|name|aero|jobs|edu|co\.uk|ac\.uk|it|fr|tv|museum|asia|local|travel|[a-z]{2})?)|((\b25[0-5]\b|\b[2][0-4][0-9]\b|\b[0-1]?[0-9]?[0-9]\b)(\.(\b25[0-5]\b|\b[2][0-4][0-9]\b|\b[0-1]?[0-9]?[0-9]\b)){3}))(?::[\d]{1,5})?(?:(?:(?:\/(?:[-\w~!$+|.,=]|%[a-f\d]{2})+)+|\/)+|\?|#)?(?:(?:\?(?:[-\w~!$+|.,*:]|%[a-f\d{2}])+=?(?:[-\w~!$+|.,*:=]|%[a-f\d]{2})*)(?:&(?:[-\w~!$+|.,*:]|%[a-f\d{2}])+=?(?:[-\w~!$+|.,*:=]|%[a-f\d]{2})*)*)*(?:#(?:[-\w~!$ |\/.,*:;=]|%[a-f\d]{2})*)?$/},email:{type:"string",pattern:/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/},"ip-address":{type:"string",pattern:/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/},ipv6:{type:"string",pattern:/(?:(?:[a-f\d]{1,4}:)*(?:[a-f\d]{1,4}|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|(?:(?:[a-f\d]{1,4}:)*[a-f\d]{1,4})?::(?:(?:[a-f\d]{1,4}:)*(?:[a-f\d]{1,4}|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}))?)/},"host-name":{type:"string"},alpha:{required:!0,type:"string",pattern:/^[a-zA-Z]+$/},alphanumeric:{required:!0,type:["string","number"],pattern:/^[a-zA-Z0-9]+$/},decimal:function(t){return c(t)?(t+"").match(/^[0-9]+(\.[0-9]{1,2})?$/):!1},percentage:{required:!0,type:["string","number"],pattern:/^-?[0-9]{0,2}(\.[0-9]{1,2})?$|^-?(100)(\.[0]{1,2})?$/,minimum:-100,maximum:100},port:{required:!0,type:["string","number"],pattern:/\:\d+/}};return e({url:"uri",ip:"ip-address",ipv4:"ip-address",host:"host-name",hostName:"host-name"},function(e,o){t[e]=t[o]}),function(e,o,r,n,i){if(m(r))return this.validateProperty(e,o,r,i);if(p(r)&&!Object.prototype.hasOwnProperty.apply(t,[r]))throw Error("The format ‘"+r+"’ is not supported.");if(p(r)){if(r=t[r],u(r))return r(o)||this.addError(),i();if(m(r))return this.validateProperty(e,o,r,i)}}}),A.prototype.addAttribute("length",function(t,e,o,r,n){return p(e)&&e.length!==o&&this.addError(),n()}),A.prototype.addAttribute("maximum",function(t,e,o,r,n){return c(e)&&(r.exclusiveMaximum&&e>=o||e>o)&&this.addError(),n()}),A.prototype.addAttribute("maxItems",function(t,e,o,n,i){return r(e)&&e.length>o&&this.addError(),i()}),A.prototype.addAttribute("maxLength",function(t,e,o,r,n){return p(e)&&e.length>o&&this.addError(),n()}),A.prototype.addAttribute("minimum",function(t,e,o,r,n){return c(e)&&(r.exclusiveMinimum&&o>=e||o>e)&&this.addError(),n()}),A.prototype.addAttribute("minItems",function(t,e,o,n,i){return r(e)&&o>e.length&&this.addError(),i()}),A.prototype.addAttribute("minLength",function(t,e,o,r,n){return p(e)&&o>e.length&&this.addError(),n()}),A.prototype.addAttribute("pattern",function(t,e,o,r,n){return p(e)&&!e.match(o)&&this.addError(),n()}),function(){A.prototype.addAttribute("patternProperties",function(t,o,r,n,i){var l=this;if(a(r))return i();var u={},s=Object.keys(r);return e(o,function(t){e(s,function(e,o){t.match(RegExp(o))&&(u[t]=r[o])})}),a(u)?i():(e(u,function(e,r,n){return l.validateSchema(o[e],r,l.joinPath(t,e),n)},i),void 0)})}(),A.prototype.addAttribute("required",function(t,e,o,n,i){return o&&(t=f(e),e=(p(e)||r(e)||m(e))&&a(e),(t||e)&&this.addError()),i()}),A.prototype.addAttributeConstructor("type",function(){var t={string:p,number:c,"function":u,"boolean":n,object:m,array:r,integer:s,"int":s,"null":d,any:_};return function(e,o,n,i,a){if(r(n))n.some(function(e){if(!Object.prototype.hasOwnProperty.apply(t,[e]))throw Error("Type ‘"+n+"’ is not supported.");return t[e](o)})||this.errors.addError();else{if(!Object.prototype.hasOwnProperty.apply(t,[n]))throw Error("Type ‘"+n+"’ is not supported.");t[n](o)||this.addError()}return a()}}),function(){A.prototype.addAttribute("uniqueItems",function(t,o,n,i,a){var u=this;return e(o,function(e,n){p(n)&&e>o.indexOf(n)&&u.addError(),(m(n)||r(n))&&o.forEach(function(o,r){r!==e&&l(n,o)&&u.addError({property:u.joinPath(t,r)})})}),a()})}();var E=function(t){this.length=0,this.errorMessages=t.messages};E.prototype.renderErrorMessage=function(t){var e=this.errorMessages[t.attributeName];return e&&u(e)?e(t.property,t.propertyValue,t.attributeValue):e&&p(e)?(["property","propertyValue","attributeValue"].forEach(function(o){e=e.replace(RegExp("{{"+o+"}}","g"),t[o])}),e=e.replace(/{{validator}}/g,t.attributeValue),e.replace(/\s+/g," ")):t.message},E.prototype.push=function(t){this[this.length]={property:t.property,propertyValue:t.propertyValue,attributeName:t.attributeName,attributeValue:t.attributeValue,message:this.renderErrorMessage(t),validator:t.attributeName,validatorName:t.attributeName,validatorValue:t.attributeValue},this.length+=1},E.prototype.getProperties=function(){return g(this,"property")},E.prototype.getMessages=function(){return g(this,"message")};var T={required:function(t){return"The ‘"+t+"’ property is required."},minLength:function(t,e,o){return["The "+t+" property must be at least "+o+" characters.","The length of the property is "+e.length+"."].join(" ")},maxLength:function(t,e,o){return["The "+t+" property must not exceed "+o+" characters.","The length of the property is "+e.length+"."].join(" ")},length:function(t,e,o){return["The "+t+" property must be exactly "+o+" characters.","The length of the property is "+e.length+"."].join(" ")},format:function(t,e,o){return["The ‘"+t+"’ property must be a/an ‘"+o+"’.","The current value of the property is ‘"+e+"’"].join(" ")},type:function(t,e,o){return["The ‘"+t+"’ property must be a/an ‘"+o+"’.","The type of the property is ‘"+typeof e+"’"].join(" ")},except:function(){},minimum:function(t,e,o){return["The minimum value of the ‘"+t+"’ must be "+o+".","The current value of the property is ‘"+e+"’"].join(" ")},maximum:function(t,e,o){return["The maximum value of the ‘"+t+"’ must be "+o+".","The current value of the property is ‘"+e+"’."].join(" ")},pattern:function(t,e,o){return"The ‘"+t+"’ does not match the ‘"+o+"’ pattern."},maxItems:function(t,e,o){return["The ‘"+t+"’ property must not contain more than ‘"+o+"’ items.","Currently it contains ‘"+e.items+"’ items."].join(" ")},minItems:function(t,e,o){return["The ‘"+t+"’ property must contain at least ‘"+o+"’ items.","Currently it contains ‘"+e.items+"’ items."].join(" ")},divisibleBy:function(t,e,o){return"The ‘"+t+"’ is not divisible by ‘"+o+"’."},uniqueItems:function(t){return"All items in the ‘"+t+"’ property must be unique."},"enum":function(t,e,o){return"Value of the ‘"+t+"’ must be "+o.join(" or ")+"."}};A.prototype.getProperty=function(t,e){return t.match(/([a-zA-Z0-9\s]+)/g).reduce(function(t,e){return t&&i(t[e])?t[e]:void 0},e)},A.prototype.joinPath=function(t,e){return t=t||"",e+="",e.match(/^[a-zA-Z]+$/)?t?t+"."+e:e:e.match(/\d+/)?t+"["+e+"]":t+'["'+e+'"]'},A.prototype.validate=function(t,e,o){var n=this;this.instance=t,this.schema=e;var i=function(){return 0!==n.errors.length?o(n.errors):o()};if(-1!=="string,number,function,boolean,integer,int,null".split(",").indexOf(e.type))return this.validateProperty(void 0,t,e,i);if(-1!==["object","array"].indexOf(e.type)){if(p(t))try{t=JSON.parse(t)}catch(a){}return this.validateSchema(t,e,"",i)}if("any"===e.type||!e.type){if(p(t))try{return t=JSON.parse(t),this.validateSchema(t,e,"",i)}catch(l){}return m(t)||r(t)?this.validateSchema(t,e,"",i):this.validateProperty(void 0,t,e,i)}},A.prototype.validateItems=function(t,o,n,i){var l=this;return r(o.items)?f(o.additionalItems)||!0===o.additionalItems?e(o.items,function(e,o,r){return l.validateSchema(t[e],o,l.joinPath(n,e),r)},i):e(t,function(t,e,r){return o.items[t]||m(o.additionalItems)?l.validateSchema(e,o.items[t],l.joinPath(n,t),r):!1===o.additionalItems?(l.errors.push({property:l.joinPath(n,t),propertyValue:e,attributeName:"additionalItems",attributeValue:!1}),r()):void 0},i):m(o.items)&&t&&!a(t)?e(t,function(e,r,i){return l.validateSchema(t[e],o.items,l.joinPath(n,e),i)},i):i()},A.prototype.validateProperties=function(t,o,r,n){var i=this;return e(o.properties,function(e,n,a){var l="object"===n.type&&n.properties,u="array"===n.type,s=i.getProperty(e,t),d=i.joinPath(r,e);return l||u?i.validateSchema(s,o.properties[e],d,a):i.validateProperty(d,s,n,a)},n)},A.prototype.validateProperty=function(t,o,r,n){var a=this,l={};return"validateItems,validateProperties,validateSchema,validateProperty,getProperty,attributes,errors,joinPath".split(",").forEach(function(t){l[t]=this[t]},a),!0!==r.required&&f(o)?n():e(a.attributes,function(e,n,u){var s=a.errors.length;l.addError=function(n){return m(n)?a.errors.push({property:n.property||t,propertyValue:n.propertyValue||o,attributeName:n.attributeName||e,attributeValue:n.attributeValue||r[e],message:n.message||void 0}):a.errors.push({property:t,propertyValue:o,attributeName:e,attributeValue:r[e],message:n})};var d=function(t){return!0===t||p(t)?(l.addError(t),u(!0)):a.errors.length>s&&a.singleError?u(!0):u()};return i(r[e])?n.apply(l,[t,o,r[e],r,d]):u()},n)},A.prototype.validateSchema=function(t,e,o,r){var n=this;return n.validateProperty(o,t,e,function(){return e.properties?n.validateProperties(t,e,o,r):e.items?n.validateItems(t,e,o,r):r()})},t.json=function(){return{validate:function(t,e,o,r){return"function"==typeof o&&(r=o,o={}),new A(o).validate(t,e,r)},addAttribute:function(){return A.prototype.addAttribute.apply(A,arguments)},addAttributeConstructor:function(){return A.prototype.addAttributeConstructor.apply(A,arguments)}}}()})();var A=function(e){if(!Object.prototype.hasOwnProperty.apply(t,[e]))throw Error("The ‘"+e+"’ engine is not supported. Please use a different one.");return t[e]};A.validate=function(){var e=t.json;return e.validate.apply(e,arguments)},A.addValidator=function(){var e=t.json;return e.addAttribute.apply(e,arguments)},A.addAttribute=function(){var e=t.json;return e.addAttribute.apply(e,arguments)},A.addAttributeConstructor=function(){var e=t.json;return e.addAttributeConstructor.apply(e,arguments)},"undefined"!=typeof module&&module.exports?module.exports=A:"undefined"!=typeof define?define(function(){return A}):this.amanda=A})();var Flow=function(){var t,e=[],o=setTimeout(function(){o=null,t._next()},0);return t={destroy:function(){o&&clearTimeout(o)},par:function(o,r){return(r||!(e[e.length-1]instanceof Array))&&e.push([]),e[e.length-1].push(o),t},seq:function(e){return t.par(e,!0)},_next:function(o,r){for(var n=[],i=[],a=e.shift()||[],l=a.length,u=1==l,s=0;a.length>s;s++)(function(e,a){e(function(e,o){n[a]=e,i[a]=o,0==--l&&t._next(u?n[0]:n,u?i[0]:i)},o,r)})(a[s],s)}}};"undefined"!=typeof module&&"exports"in module&&(module.exports=Flow),"function"==typeof define&&define.amd&&define("Flow",[],function(){return Flow});