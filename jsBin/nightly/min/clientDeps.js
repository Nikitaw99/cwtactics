function getQueryParams(e){e=e.split("+").join(" ");for(var t,o={},n=/[?&]?([^=]+)=([^&]*)/g;t=n.exec(e);)o[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return o}(function(){for(var e=0,t=["ms","moz","webkit","o"],o=0;t.length>o&&!window.requestAnimationFrame;++o)window.requestAnimationFrame=window[t[o]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[o]+"CancelAnimationFrame"]||window[t[o]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var o=(new Date).getTime(),n=Math.max(0,16-(o-e)),r=window.setTimeout(function(){t(o+n)},n);return e=o+n,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})})();var Base64Helper={};Base64Helper.canvasToBase64=function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var o=t.getContext("2d");o.drawImage(e,0,0);var n=t.toDataURL("image/png");return n.replace(/^data:image\/(png|jpg);base64,/,"")},function(e){var t=e;Base64Helper.encodeBuffer=function(e){for(var o,n,r,i,a,l="",s=new Uint8Array(e),c=s.byteLength,u=c%3,d=c-u,m=0;d>m;m+=3)a=s[m]<<16|s[m+1]<<8|s[m+2],o=(16515072&a)>>18,n=(258048&a)>>12,r=(4032&a)>>6,i=63&a,l+=t[o]+t[n]+t[r]+t[i];return 1==u?(a=s[d],o=(252&a)>>2,n=(3&a)<<4,l+=t[o]+t[n]+"=="):2==u&&(a=s[d]<<8|s[d+1],o=(64512&a)>>10,n=(1008&a)>>4,r=(15&a)<<2,l+=t[o]+t[n]+t[r]+"="),l},Base64Helper.decodeBuffer=function(t){var o,n,r,i,a,l=.75*t.length,s=t.length,c=0;"="===t[t.length-1]&&(l--,"="===t[t.length-2]&&l--);var u=new ArrayBuffer(l),d=new Uint8Array(u);for(o=0;s>o;o+=4)n=e.indexOf(t[o]),r=e.indexOf(t[o+1]),i=e.indexOf(t[o+2]),a=e.indexOf(t[o+3]),d[c++]=n<<2|r>>4,d[c++]=(15&r)<<4|i>>2,d[c++]=(3&i)<<6|63&a;return u}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),function(e,t){function o(e){d[d.length]=e}function n(e){u.className=u.className.replace(RegExp("\\b"+e+"\\b"),"")}function r(e,t){for(var o=0,n=e.length;n>o;o++)t.call(e,e[o],o)}function i(){u.className=u.className.replace(/ (w-|eq-|gt-|gte-|lt-|lte-|portrait|no-portrait|landscape|no-landscape)\d+/g,"");var t=e.innerWidth||u.clientWidth,n=e.outerWidth||e.screen.width;_.screen.innerWidth=t,_.screen.outerWidth=n,o("w-"+t),r(m.screens,function(e){t>e?(m.screensCss.gt&&o("gt-"+e),m.screensCss.gte&&o("gte-"+e)):e>t?(m.screensCss.lt&&o("lt-"+e),m.screensCss.lte&&o("lte-"+e)):t===e&&(m.screensCss.lte&&o("lte-"+e),m.screensCss.eq&&o("e-q"+e),m.screensCss.gte&&o("gte-"+e))});var n=e.innerHeight||u.clientHeight,i=e.outerHeight||e.screen.height;_.screen.innerHeight=n,_.screen.outerHeight=i,_.feature("portrait",n>t),_.feature("landscape",t>n)}function a(){e.clearTimeout(g),g=e.setTimeout(i,100)}var l=e.document,s=e.navigator,c=e.location,u=l.documentElement,d=[],m={screens:[240,320,480,640,768,800,1024,1280,1440,1680,1920],screensCss:{gt:!0,gte:!1,lt:!0,lte:!1,eq:!1},browsers:[{ie:{min:6,max:10}}],browserCss:{gt:!0,gte:!1,lt:!0,lte:!1,eq:!0},section:"-section",page:"-page",head:"head"};if(e.head_conf)for(var p in e.head_conf)e.head_conf[p]!==t&&(m[p]=e.head_conf[p]);var _=e[m.head]=function(){_.ready.apply(null,arguments)};switch(_.feature=function(e,t,r){return e?("[object Function]"===Object.prototype.toString.call(t)&&(t=t.call()),o((t?"":"no-")+e),_[e]=!!t,r||(n("no-"+e),n(e),_.feature()),_):(u.className+=" "+d.join(" "),d=[],_)},_.feature("js",!0),p=s.userAgent.toLowerCase(),s=/mobile|midp/.test(p),_.feature("mobile",s,!0),_.feature("desktop",!s,!0),p=/(chrome|firefox)[ \/]([\w.]+)/.exec(p)||/(iphone|ipad|ipod)(?:.*version)?[ \/]([\w.]+)/.exec(p)||/(android)(?:.*version)?[ \/]([\w.]+)/.exec(p)||/(webkit|opera)(?:.*version)?[ \/]([\w.]+)/.exec(p)||/(msie) ([\w.]+)/.exec(p)||[],s=p[1],p=parseFloat(p[2]),s){case"msie":s="ie",p=l.documentMode||p;break;case"firefox":s="ff";break;case"ipod":case"ipad":case"iphone":s="ios";break;case"webkit":s="safari"}_.browser={name:s,version:p},_.browser[s]=!0;for(var f=0,h=m.browsers.length;h>f;f++)for(var E in m.browsers[f])if(s===E){o(E);for(var v=m.browsers[f][E].max,I=m.browsers[f][E].min;v>=I;I++)p>I?(m.browserCss.gt&&o("gt-"+E+I),m.browserCss.gte&&o("gte-"+E+I)):I>p?(m.browserCss.lt&&o("lt-"+E+I),m.browserCss.lte&&o("lte-"+E+I)):p===I&&(m.browserCss.lte&&o("lte-"+E+I),m.browserCss.eq&&o("eq-"+E+I),m.browserCss.gte&&o("gte-"+E+I))}else o("no-"+E);"ie"===s&&9>p&&r("abbr article aside audio canvas details figcaption figure footer header hgroup mark meter nav output progress section summary time video".split(" "),function(e){l.createElement(e)}),r(c.pathname.split("/"),function(e,n){if(this.length>2&&this[n+1]!==t)n&&o(this.slice(1,n+1).join("-").toLowerCase()+m.section);else{var r=e||"index",i=r.indexOf(".");i>0&&(r=r.substring(0,i)),u.id=r.toLowerCase()+m.page,n||o("root"+m.section)}}),_.screen={height:e.screen.height,width:e.screen.width},i();var g=0;e.addEventListener?e.addEventListener("resize",a,!1):e.attachEvent("onresize",a)}(window);var Lawnchair=function(e,t){if(!(this instanceof Lawnchair))return new Lawnchair(e,t);if(!JSON)throw"JSON unavailable! Include http://www.json.org/json2.js to fix.";if(!(2>=arguments.length&&arguments.length>0))throw"Incorrect # of ctor args!";if(t="function"==typeof arguments[0]?arguments[0]:arguments[1],e="function"==typeof arguments[0]?{}:arguments[0],"function"!=typeof t)throw"No callback was provided";this.record=e.record||"record",this.name=e.name||"records";var o;if(e.adapter){for(var n=0,r=Lawnchair.adapters.length;r>n;n++)if(Lawnchair.adapters[n].adapter===e.adapter){o=Lawnchair.adapters[n].valid()?Lawnchair.adapters[n]:void 0;break}}else for(var n=0,r=Lawnchair.adapters.length;r>n&&!(o=Lawnchair.adapters[n].valid()?Lawnchair.adapters[n]:void 0);n++);if(!o)throw"No valid adapter.";for(var i in o)this[i]=o[i];for(var n=0,r=Lawnchair.plugins.length;r>n;n++)Lawnchair.plugins[n].call(this);this.init(e,t)};Lawnchair.adapters=[],Lawnchair.adapter=function(e,t){t.adapter=e;var o="adapter valid init keys save batch get exists all remove nuke".split(" "),n=this.prototype.indexOf;for(var r in t)if(-1===n(o,r))throw"Invalid adapter! Nonstandard method: "+r;Lawnchair.adapters.splice(0,0,t)},Lawnchair.plugins=[],Lawnchair.plugin=function(e){for(var t in e)"init"===t?Lawnchair.plugins.push(e[t]):this.prototype[t]=e[t]},Lawnchair.prototype={isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},indexOf:function(e,t,o,n){if(e.indexOf)return e.indexOf(t);for(o=0,n=e.length;n>o;o++)if(e[o]===t)return o;return-1},lambda:function(e){return this.fn(this.record,e)},fn:function(e,t){return"string"==typeof t?Function(e,t):t},uuid:function(){var e=function(){return(0|65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},each:function(e){var t=this.lambda(e);if(this.__results)for(var o=0,n=this.__results.length;n>o;o++)t.call(this,this.__results[o],o);else this.all(function(e){for(var o=0,n=e.length;n>o;o++)t.call(this,e[o],o)});return this}},Lawnchair.adapter("dom",function(){var e=window.localStorage,t=function(t){return{key:t+"._index_",all:function(){var t=e.getItem(this.key);return t&&(t=JSON.parse(t)),null===t&&e.setItem(this.key,JSON.stringify([])),JSON.parse(e.getItem(this.key))},add:function(t){var o=this.all();o.push(t),e.setItem(this.key,JSON.stringify(o))},del:function(t){for(var o=this.all(),n=[],r=0,i=o.length;i>r;r++)o[r]!=t&&n.push(o[r]);e.setItem(this.key,JSON.stringify(n))},find:function(e){for(var t=this.all(),o=0,n=t.length;n>o;o++)if(e===t[o])return o;return!1}}};return{valid:function(){return!!e},init:function(e,o){this.indexer=t(this.name),o&&this.fn(this.name,o).call(this,this)},save:function(t,o){var n=t.key?this.name+"."+t.key:this.name+"."+this.uuid();return this.indexer.find(n)===!1&&this.indexer.add(n),delete t.key,e.setItem(n,JSON.stringify(t)),t.key=n.slice(this.name.length+1),o&&this.lambda(o).call(this,t),this},batch:function(e,t){for(var o=[],n=0,r=e.length;r>n;n++)this.save(e[n],function(e){o.push(e)});return t&&this.lambda(t).call(this,o),this},keys:function(e){if(e){var t=this.name,o=this.indexer.all().map(function(e){return e.replace(t+".","")});this.fn("keys",e).call(this,o)}return this},get:function(t,o){if(this.isArray(t)){for(var n=[],r=0,i=t.length;i>r;r++){var a=this.name+"."+t[r],l=e.getItem(a);l&&(l=JSON.parse(l),l.key=t[r],n.push(l))}o&&this.lambda(o).call(this,n)}else{var a=this.name+"."+t,l=e.getItem(a);l&&(l=JSON.parse(l),l.key=t),o&&this.lambda(o).call(this,l)}return this},exists:function(e,t){var o=this.indexer.find(this.name+"."+e)===!1?!1:!0;return this.lambda(t).call(this,o),this},all:function(t){for(var o,n,r=this.indexer.all(),i=[],a=0,l=r.length;l>a;a++)n=r[a],o=JSON.parse(e.getItem(n)),o.key=n.replace(this.name+".",""),i.push(o);return t&&this.fn(this.name,t).call(this,i),this},remove:function(t,o){var n=this.name+"."+(t.key?t.key:t);return this.indexer.del(n),e.removeItem(n),o&&this.lambda(o).call(this),this},nuke:function(e){return this.all(function(t){for(var o=0,n=t.length;n>o;o++)this.remove(t[o]);e&&this.lambda(e).call(this)}),this}}}()),Lawnchair.adapter("window-name",function(e,t){var o=window.top.name?JSON.parse(window.top.name):{};return{valid:function(){return window.top.name!==void 0},init:function(n,r){o[this.name]=o[this.name]||{index:[],store:{}},e=o[this.name].index,t=o[this.name].store,this.fn(this.name,r).call(this,this)},keys:function(t){return this.fn("keys",t).call(this,e),this},save:function(n,r){var i=n.key||this.uuid();return n.key&&delete n.key,this.exists(i,function(a){a||e.push(i),t[i]=n,window.top.name=JSON.stringify(o),n.key=i,r&&this.lambda(r).call(this,n)}),this},batch:function(e,t){for(var o=[],n=0,r=e.length;r>n;n++)this.save(e[n],function(e){o.push(e)});return t&&this.lambda(t).call(this,o),this},get:function(e,o){var n;if(this.isArray(e)){n=[];for(var r=0,i=e.length;i>r;r++)n.push(t[e[r]])}else n=t[e],n&&(n.key=e);return o&&this.lambda(o).call(this,n),this},exists:function(e,o){return this.lambda(o).call(this,!!t[e]),this},all:function(o){for(var n=[],r=0,i=e.length;i>r;r++){var a=t[e[r]];a.key=e[r],n.push(a)}return this.fn(this.name,o).call(this,n),this},remove:function(n,r){for(var i=this.isArray(n)?n:[n],a=0,l=i.length;l>a;a++)delete t[i[a]],e.splice(this.indexOf(e,i[a]),1);return window.top.name=JSON.stringify(o),r&&this.lambda(r).call(this),this},nuke:function(t){return storage={},e=[],window.top.name=JSON.stringify(o),t&&this.lambda(t).call(this),this}}}()),Lawnchair.adapter("indexed-db",function(){function e(e,t){console.log("error in indexed-db adapter!",e,t)}function t(){return window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.oIndexedDB||window.msIndexedDB}return{valid:function(){return!!t()},init:function(o,n){this.idb=t(),this.waiting=[];var r=this.idb.open(this.name),i=this,a=i.fn(i.name,n),l=function(){return a.call(i,i)};r.onsuccess=function(){if(i.db=r.result,"1.0"!=i.db.version){var t=i.db.setVersion("1.0");t.onsuccess=function(){i.store=i.db.createObjectStore("teststore",{autoIncrement:!0});for(var e=0;i.waiting.length>e;e++)i.waiting[e].call(i);i.waiting=[],l()},t.onerror=function(t){console.log("Failed to create objectstore "+t),e(t)}}else{i.store={};for(var o=0;i.waiting.length>o;o++)i.waiting[o].call(i);i.waiting=[],l()}},r.onerror=e},save:function(t,o){if(!this.store)return this.waiting.push(function(){this.save(t,o)}),void 0;var n=this,r=function(e){o&&(t.key=e.target.result,n.lambda(o).call(n,t))},i=this.db.transaction(["teststore"],webkitIDBTransaction.READ_WRITE),a=i.objectStore("teststore"),l=t.key?a.put(t,t.key):a.put(t);return l.onsuccess=r,l.onerror=e,this},batch:function(e,t){for(var o=[],n=!1,r=this,i=function(t){o.push(t),n=o.length===e.length},a=setInterval(function(){n&&(t&&r.lambda(t).call(r,o),clearInterval(a))},200),l=0,s=e.length;s>l;l++)this.save(e[l],i);return this},get:function(t,o){if(!this.store)return this.waiting.push(function(){this.get(t,o)}),void 0;var n=this,r=function(e){o&&n.lambda(o).call(n,e.target.result)};if(this.isArray(t))for(var i=[],a=!1,l=t,s=function(e){i.push(e),a=i.length===l.length},c=setInterval(function(){a&&(o&&n.lambda(o).call(n,i),clearInterval(c))},200),u=0,d=l.length;d>u;u++)this.get(l[u],s);else{var m=this.db.transaction("teststore").objectStore("teststore").get(t);m.onsuccess=r,m.onerror=function(o){console.log("Failed to find "+t),e(o)}}return this},all:function(e){if(!this.store)return this.waiting.push(function(){this.all(e)}),void 0;var t=this.fn(this.name,e)||void 0,o=this,n=this.db.transaction("teststore").objectStore("teststore"),r=[];return n.openCursor().onsuccess=function(e){var n=e.target.result;n?(r.push(n.value),n.continue()):t&&t.call(o,r)},this},remove:function(t,o){if(!this.store)return this.waiting.push(function(){this.remove(t,o)}),void 0;"object"==typeof t&&(t=t.key);var n=this,r=function(){o&&n.lambda(o).call(n)},i=this.db.transaction(["teststore"],webkitIDBTransaction.READ_WRITE).objectStore("teststore").delete(t);return i.onsuccess=r,i.onerror=e,this},nuke:function(t){if(!this.store)return this.waiting.push(function(){this.nuke(t)}),void 0;var o=this,n=t?function(){o.lambda(t).call(o)}:function(){};try{this.db.transaction(["teststore"],webkitIDBTransaction.READ_WRITE).objectStore("teststore").clear().onsuccess=n}catch(r){e()}return this}}}()),Lawnchair.adapter("webkit-sqlite",function(){var e=function(e,t){console.log("error in sqlite adaptor!",e,t)},t=function(){return new Date};return Function.prototype.bind||(Function.prototype.bind=function(e){var t=[].slice,o=t.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r?this:e||{},o.concat(t.call(arguments)))};return r.prototype=n.prototype,i.prototype=new r,i}),{valid:function(){return!!window.openDatabase},init:function(t,o){var n=this,r=n.fn(n.name,o),i="CREATE TABLE IF NOT EXISTS "+this.name+" (id NVARCHAR(32) UNIQUE PRIMARY KEY, value TEXT, timestamp REAL)",a=function(){return r.call(n,n)};this.db=openDatabase(this.name,"1.0.0",this.name,t.maxSize||65536),this.db.transaction(function(t){t.executeSql(i,[],a,e)})},keys:function(t){var o=this.lambda(t),n=this,r="SELECT id FROM "+this.name+" ORDER BY timestamp DESC";return this.db.transaction(function(t){var i=function(e,t){if(0==t.rows.length)o.call(n,[]);else{for(var r=[],i=0,a=t.rows.length;a>i;i++)r.push(t.rows.item(i).id);o.call(n,r)}};t.executeSql(r,[],i,e)}),this},save:function(o,n){var r=this,i=o.key||r.uuid(),a="INSERT INTO "+this.name+" (value, timestamp, id) VALUES (?,?,?)",l="UPDATE "+this.name+" SET value=?, timestamp=? WHERE id=?",s=function(){n&&(o.key=i,r.lambda(n).call(r,o))},c=[t(),i];return r.exists(o.key,function(t){r.db.transaction(function(n){var r=function(t){c.unshift(JSON.stringify(t)),n.executeSql(a,c,s,e)},i=function(t){delete t.key,c.unshift(JSON.stringify(t)),n.executeSql(l,c,s,e)};t?i(o):r(o)})}),this},batch:function(e,t){for(var o=[],n=!1,r=this,i=function(t){o.push(t),n=o.length===e.length},a=setInterval(function(){n&&(t&&r.lambda(t).call(r,o),clearInterval(a))},200),l=0,s=e.length;s>l;l++)this.save(e[l],i);return this},get:function(t,o){var n=this,r="";r=this.isArray(t)?"SELECT id, value FROM "+this.name+" WHERE id IN ('"+t.join("','")+"')":"SELECT id, value FROM "+this.name+" WHERE id = '"+t+"'";var i=function(e,r){var i=null,a=[];if(r.rows.length)for(var l=0,s=r.rows.length;s>l;l++)i=JSON.parse(r.rows.item(l).value),i.key=r.rows.item(l).id,a.push(i);n.isArray(t)||(a=a.length?a[0]:null),o&&n.lambda(o).call(n,a)};return this.db.transaction(function(t){t.executeSql(r,[],i,e)}),this},exists:function(t,o){var n="SELECT * FROM "+this.name+" WHERE id = ?",r=this,i=function(e,t){o&&r.fn("exists",o).call(r,t.rows.length>0)};return this.db.transaction(function(o){o.executeSql(n,[t],i,e)}),this},all:function(t){var o=this,n="SELECT * FROM "+this.name,r=[],i=this.fn(this.name,t)||void 0,a=function(e,t){if(0!=t.rows.length)for(var n=0,a=t.rows.length;a>n;n++){var l=JSON.parse(t.rows.item(n).value);l.key=t.rows.item(n).id,r.push(l)}i&&i.call(o,r)};return this.db.transaction(function(t){t.executeSql(n,[],a,e)}),this},remove:function(t,o){var n=this,r="string"==typeof t?t:t.key,i="DELETE FROM "+this.name+" WHERE id = ?",a=function(){o&&n.lambda(o).call(n)};return this.db.transaction(function(t){t.executeSql(i,[r],a,e)}),this},nuke:function(t){var o="DELETE FROM "+this.name,n=this,r=t?function(){n.lambda(t).call(n)}:function(){};return this.db.transaction(function(t){t.executeSql(o,[],r,e)}),this}}}());var jWorkflow=function(){function e(e){if("function"!=typeof e)throw"expected function but was "+typeof e}function t(e){return"function"==typeof e.andThen&&"function"==typeof e.start&&"function"==typeof e.chill}function o(e){return!!e.map&&!!e.reduce}var n={order:function(n,r){var i,a=[],l=null,s=function(){var e=!1;return{take:function(){e=!0},pass:function(t){var o;e=!1,i.length?(o=i.shift(),t=o.func.apply(o.context,[t,s]),e||s.pass(t)):l.func&&l.func.apply(l.context,[t])},drop:function(t){e=!0,i=[],setTimeout(function(){s.pass(t)},1)}}}(),c={andThen:function(n,r){if(t(n)){var i=function(e,t){t.take(),n.start({callback:function(e){t.pass(e)},context:r,initialValue:e})};a.push({func:i,context:r})}else if(o(n)){var l=function(e,t){t.take();var o=n.length,r=function(){return--o||t.pass()};n.forEach(function(e){jWorkflow.order(e).start(r)})};a.push({func:l,context:r})}else e(n),a.push({func:n,context:r});return c},chill:function(e){return c.andThen(function(t,o){o.take(),setTimeout(function(){o.pass(t)},e)})},start:function(){var e,t,o;arguments[0]&&"object"==typeof arguments[0]?(e=arguments[0].callback,t=arguments[0].context,o=arguments[0].initialValue):(e=arguments[0],t=arguments[1]),l={func:e,context:t},i=a.slice(),s.pass(o)}};return n?c.andThen(n,r):c}};return n}();"object"==typeof module&&"function"==typeof require&&(module.exports=jWorkflow);