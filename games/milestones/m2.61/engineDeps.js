(function(){var e={},t=function(e,t,r){var o=function(e,t,r){var o=[],i=function(e,n){var i=o.length+1;o.push(function(){return t(e,n,function(e){var t=o[i];return!e&&t?t():e||t?r(e):r()})})};if(n(e)&&!a(e))for(var l=0,s=e.length;s>l;l++)i(l,e[l]);else{if(!m(e)||a(e))return r();for(l in e)e.hasOwnProperty(l)&&i(l,e[l])}return o[0]()};return r===void 0?function(e,t){if(n(e)&&!a(e))for(var r=0,o=e.length;o>r;r++)t.apply(e,[r,e[r]]);if(m(e)&&!a(e))for(var i in e)e.hasOwnProperty(i)&&t.apply(e,[i,e[i]])}.apply(this,arguments):o.apply(this,arguments)},r=function(e,t,r){return Array.prototype.filter.apply(e,[t,r||this])},n=function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=function(e){return"boolean"==typeof e},i=function(e){return e!==void 0},a=function(e){if(c(e))return!1;if(null===e)return!0;if(n(e)||"string"==typeof e)return 0===e.length;if(m(e))for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0},l=function(e,t){if(n(e,t))return e.length!==t.length?!1:Array.prototype.every.apply(e,[function(e,r){return t[r]===e}]);if(m(e,t)){var r=Object.keys(e),o=Object.keys(t);if(!l(r,o))return!1;for(key in e)if(!t[key]||e[key]!==t[key])return!1;return!0}return!1},s=function(e){return"function"==typeof e},u=function(e){return c(e)&&0===e%1},d=function(e){return null===e},c=function(e){return"number"==typeof e},m=function(e){return"[object Object]"===Object.prototype.toString.call(e)},p=function(e){return"string"==typeof e},h=function(e){return e===void 0},f=function(e,t){for(var r in t)t.hasOwnProperty(r)&&!e.hasOwnProperty(r)&&(e[r]=t[r]);return e},y=function(e,t){for(var r=[],n=0,o=e.length;o>n;n++){var i=e[n][t];-1===r.indexOf(i)&&r.push(i)}return r},_=function(){return!0};(function(){var E=function(e){var r=this,n={singleError:!0,messages:T,cache:!1};t(n,function(t,o){r[t]=m(o)&&e[t]?f(e[t],n[t]):m(o)&&!e[t]?f({},n[t]):i(e[t])?e[t]:n[t]}),this.errors=new g(this)};E.prototype.attributes={},E.prototype.addAttribute=function(e,t){return E.prototype.attributes[e]=t},E.prototype.addAttributeConstructor=function(e,t){return E.prototype.attributes[e]=t()},E.prototype.addAttribute("additionalProperties",function(e,n,o,i,l){var s=this;if(!0===o)return l();var u=Object.keys(n),u=r(u,function(e){return!i.properties[e]});return a(u)?l():!1===o?(u.forEach(function(t){this.addError({property:this.joinPath(e,t),propertyValue:n[t]})},this),l()):m(o)?t(u,function(t,r,i){return s.validateSchema(n[r],o,e+r,i)},l):void 0}),E.prototype.addAttribute("divisibleBy",function(e,t,r,n,o){if(0===r)throw Error("The value of this attribute should not be 0.");return c(t)&&0!==t%r&&this.addError(),o()}),E.prototype.addAttribute("enum",function(e,t,r,n,o){return-1===r.indexOf(t)&&this.addError(),o()}),E.prototype.addAttribute("except",function(e,t,r,n,o){return-1!==r.indexOf(t)&&this.addError(),o()}),E.prototype.addAttributeConstructor("format",function(){var e={"date-time":{type:"string",pattern:/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-[0-9]{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z$/},date:function(e){return p(e)?e.match(/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-[0-9]{2}$/):m(e)?"[object Date]"===Object.prototype.toString.call(e):!1},time:{type:"string",pattern:/^\d{2}:\d{2}:\d{2}$/},"utc-milisec":{type:"number"},regex:function(e){return e&&e.test&&e.exec},color:{type:"string"},style:{type:"string"},phone:{type:"number"},uri:{type:"string",pattern:/^(?:(?:ht|f)tp(?:s?)\:\/\/|~\/|\/)?(?:\w+:\w+@)?((?:(?:[-\w\d{1-3}]+\.)+(?:com|org|cat|coop|int|pro|tel|xxx|net|gov|mil|biz|info|mobi|name|aero|jobs|edu|co\.uk|ac\.uk|it|fr|tv|museum|asia|local|travel|[a-z]{2})?)|((\b25[0-5]\b|\b[2][0-4][0-9]\b|\b[0-1]?[0-9]?[0-9]\b)(\.(\b25[0-5]\b|\b[2][0-4][0-9]\b|\b[0-1]?[0-9]?[0-9]\b)){3}))(?::[\d]{1,5})?(?:(?:(?:\/(?:[-\w~!$+|.,=]|%[a-f\d]{2})+)+|\/)+|\?|#)?(?:(?:\?(?:[-\w~!$+|.,*:]|%[a-f\d{2}])+=?(?:[-\w~!$+|.,*:=]|%[a-f\d]{2})*)(?:&(?:[-\w~!$+|.,*:]|%[a-f\d{2}])+=?(?:[-\w~!$+|.,*:=]|%[a-f\d]{2})*)*)*(?:#(?:[-\w~!$ |\/.,*:;=]|%[a-f\d]{2})*)?$/},email:{type:"string",pattern:/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/},"ip-address":{type:"string",pattern:/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/},ipv6:{type:"string",pattern:/(?:(?:[a-f\d]{1,4}:)*(?:[a-f\d]{1,4}|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|(?:(?:[a-f\d]{1,4}:)*[a-f\d]{1,4})?::(?:(?:[a-f\d]{1,4}:)*(?:[a-f\d]{1,4}|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}))?)/},"host-name":{type:"string"},alpha:{required:!0,type:"string",pattern:/^[a-zA-Z]+$/},alphanumeric:{required:!0,type:["string","number"],pattern:/^[a-zA-Z0-9]+$/},decimal:function(e){return c(e)?(e+"").match(/^[0-9]+(\.[0-9]{1,2})?$/):!1},percentage:{required:!0,type:["string","number"],pattern:/^-?[0-9]{0,2}(\.[0-9]{1,2})?$|^-?(100)(\.[0]{1,2})?$/,minimum:-100,maximum:100},port:{required:!0,type:["string","number"],pattern:/\:\d+/}};return t({url:"uri",ip:"ip-address",ipv4:"ip-address",host:"host-name",hostName:"host-name"},function(t,r){e[t]=e[r]}),function(t,r,n,o,i){if(m(n))return this.validateProperty(t,r,n,i);if(p(n)&&!Object.prototype.hasOwnProperty.apply(e,[n]))throw Error("The format ‘"+n+"’ is not supported.");if(p(n)){if(n=e[n],s(n))return n(r)||this.addError(),i();if(m(n))return this.validateProperty(t,r,n,i)}}}),E.prototype.addAttribute("length",function(e,t,r,n,o){return p(t)&&t.length!==r&&this.addError(),o()}),E.prototype.addAttribute("maximum",function(e,t,r,n,o){return c(t)&&(n.exclusiveMaximum&&t>=r||t>r)&&this.addError(),o()}),E.prototype.addAttribute("maxItems",function(e,t,r,o,i){return n(t)&&t.length>r&&this.addError(),i()}),E.prototype.addAttribute("maxLength",function(e,t,r,n,o){return p(t)&&t.length>r&&this.addError(),o()}),E.prototype.addAttribute("minimum",function(e,t,r,n,o){return c(t)&&(n.exclusiveMinimum&&r>=t||r>t)&&this.addError(),o()}),E.prototype.addAttribute("minItems",function(e,t,r,o,i){return n(t)&&r>t.length&&this.addError(),i()}),E.prototype.addAttribute("minLength",function(e,t,r,n,o){return p(t)&&r>t.length&&this.addError(),o()}),E.prototype.addAttribute("pattern",function(e,t,r,n,o){return p(t)&&!t.match(r)&&this.addError(),o()}),function(){E.prototype.addAttribute("patternProperties",function(e,r,n,o,i){var l=this;if(a(n))return i();var s={},u=Object.keys(n);return t(r,function(e){t(u,function(t,r){e.match(RegExp(r))&&(s[e]=n[r])})}),a(s)?i():(t(s,function(t,n,o){return l.validateSchema(r[t],n,l.joinPath(e,t),o)},i),void 0)})}(),E.prototype.addAttribute("required",function(e,t,r,o,i){return r&&(e=h(t),t=(p(t)||n(t)||m(t))&&a(t),(e||t)&&this.addError()),i()}),E.prototype.addAttributeConstructor("type",function(){var e={string:p,number:c,"function":s,"boolean":o,object:m,array:n,integer:u,"int":u,"null":d,any:_};return function(t,r,o,i,a){if(n(o))o.some(function(t){if(!Object.prototype.hasOwnProperty.apply(e,[t]))throw Error("Type ‘"+o+"’ is not supported.");return e[t](r)})||this.errors.addError();else{if(!Object.prototype.hasOwnProperty.apply(e,[o]))throw Error("Type ‘"+o+"’ is not supported.");e[o](r)||this.addError()}return a()}}),function(){E.prototype.addAttribute("uniqueItems",function(e,r,o,i,a){var s=this;return t(r,function(t,o){p(o)&&t>r.indexOf(o)&&s.addError(),(m(o)||n(o))&&r.forEach(function(r,n){n!==t&&l(o,r)&&s.addError({property:s.joinPath(e,n)})})}),a()})}();var g=function(e){this.length=0,this.errorMessages=e.messages};g.prototype.renderErrorMessage=function(e){var t=this.errorMessages[e.attributeName];return t&&s(t)?t(e.property,e.propertyValue,e.attributeValue):t&&p(t)?(["property","propertyValue","attributeValue"].forEach(function(r){t=t.replace(RegExp("{{"+r+"}}","g"),e[r])}),t=t.replace(/{{validator}}/g,e.attributeValue),t.replace(/\s+/g," ")):e.message},g.prototype.push=function(e){this[this.length]={property:e.property,propertyValue:e.propertyValue,attributeName:e.attributeName,attributeValue:e.attributeValue,message:this.renderErrorMessage(e),validator:e.attributeName,validatorName:e.attributeName,validatorValue:e.attributeValue},this.length+=1},g.prototype.getProperties=function(){return y(this,"property")},g.prototype.getMessages=function(){return y(this,"message")};var T={required:function(e){return"The ‘"+e+"’ property is required."},minLength:function(e,t,r){return["The "+e+" property must be at least "+r+" characters.","The length of the property is "+t.length+"."].join(" ")},maxLength:function(e,t,r){return["The "+e+" property must not exceed "+r+" characters.","The length of the property is "+t.length+"."].join(" ")},length:function(e,t,r){return["The "+e+" property must be exactly "+r+" characters.","The length of the property is "+t.length+"."].join(" ")},format:function(e,t,r){return["The ‘"+e+"’ property must be a/an ‘"+r+"’.","The current value of the property is ‘"+t+"’"].join(" ")},type:function(e,t,r){return["The ‘"+e+"’ property must be a/an ‘"+r+"’.","The type of the property is ‘"+typeof t+"’"].join(" ")},except:function(){},minimum:function(e,t,r){return["The minimum value of the ‘"+e+"’ must be "+r+".","The current value of the property is ‘"+t+"’"].join(" ")},maximum:function(e,t,r){return["The maximum value of the ‘"+e+"’ must be "+r+".","The current value of the property is ‘"+t+"’."].join(" ")},pattern:function(e,t,r){return"The ‘"+e+"’ does not match the ‘"+r+"’ pattern."},maxItems:function(e,t,r){return["The ‘"+e+"’ property must not contain more than ‘"+r+"’ items.","Currently it contains ‘"+t.items+"’ items."].join(" ")},minItems:function(e,t,r){return["The ‘"+e+"’ property must contain at least ‘"+r+"’ items.","Currently it contains ‘"+t.items+"’ items."].join(" ")},divisibleBy:function(e,t,r){return"The ‘"+e+"’ is not divisible by ‘"+r+"’."},uniqueItems:function(e){return"All items in the ‘"+e+"’ property must be unique."},"enum":function(e,t,r){return"Value of the ‘"+e+"’ must be "+r.join(" or ")+"."}};E.prototype.getProperty=function(e,t){return e.match(/([a-zA-Z0-9\s]+)/g).reduce(function(e,t){return e&&i(e[t])?e[t]:void 0},t)},E.prototype.joinPath=function(e,t){return e=e||"",t+="",t.match(/^[a-zA-Z]+$/)?e?e+"."+t:t:t.match(/\d+/)?e+"["+t+"]":e+'["'+t+'"]'},E.prototype.validate=function(e,t,r){var o=this;this.instance=e,this.schema=t;var i=function(){return 0!==o.errors.length?r(o.errors):r()};if(-1!=="string,number,function,boolean,integer,int,null".split(",").indexOf(t.type))return this.validateProperty(void 0,e,t,i);if(-1!==["object","array"].indexOf(t.type)){if(p(e))try{e=JSON.parse(e)}catch(a){}return this.validateSchema(e,t,"",i)}if("any"===t.type||!t.type){if(p(e))try{return e=JSON.parse(e),this.validateSchema(e,t,"",i)}catch(l){}return m(e)||n(e)?this.validateSchema(e,t,"",i):this.validateProperty(void 0,e,t,i)}},E.prototype.validateItems=function(e,r,o,i){var l=this;return n(r.items)?h(r.additionalItems)||!0===r.additionalItems?t(r.items,function(t,r,n){return l.validateSchema(e[t],r,l.joinPath(o,t),n)},i):t(e,function(e,t,n){return r.items[e]||m(r.additionalItems)?l.validateSchema(t,r.items[e],l.joinPath(o,e),n):!1===r.additionalItems?(l.errors.push({property:l.joinPath(o,e),propertyValue:t,attributeName:"additionalItems",attributeValue:!1}),n()):void 0},i):m(r.items)&&e&&!a(e)?t(e,function(t,n,i){return l.validateSchema(e[t],r.items,l.joinPath(o,t),i)},i):i()},E.prototype.validateProperties=function(e,r,n,o){var i=this;return t(r.properties,function(t,o,a){var l="object"===o.type&&o.properties,s="array"===o.type,u=i.getProperty(t,e),d=i.joinPath(n,t);return l||s?i.validateSchema(u,r.properties[t],d,a):i.validateProperty(d,u,o,a)},o)},E.prototype.validateProperty=function(e,r,n,o){var a=this,l={};return"validateItems,validateProperties,validateSchema,validateProperty,getProperty,attributes,errors,joinPath".split(",").forEach(function(e){l[e]=this[e]},a),!0!==n.required&&h(r)?o():t(a.attributes,function(t,o,s){var u=a.errors.length;l.addError=function(o){return m(o)?a.errors.push({property:o.property||e,propertyValue:o.propertyValue||r,attributeName:o.attributeName||t,attributeValue:o.attributeValue||n[t],message:o.message||void 0}):a.errors.push({property:e,propertyValue:r,attributeName:t,attributeValue:n[t],message:o})};var d=function(e){return!0===e||p(e)?(l.addError(e),s(!0)):a.errors.length>u&&a.singleError?s(!0):s()};return i(n[t])?o.apply(l,[e,r,n[t],n,d]):s()},o)},E.prototype.validateSchema=function(e,t,r,n){var o=this;return o.validateProperty(r,e,t,function(){return t.properties?o.validateProperties(e,t,r,n):t.items?o.validateItems(e,t,r,n):n()})},e.json=function(){return{validate:function(e,t,r,n){return"function"==typeof r&&(n=r,r={}),new E(r).validate(e,t,n)},addAttribute:function(){return E.prototype.addAttribute.apply(E,arguments)},addAttributeConstructor:function(){return E.prototype.addAttributeConstructor.apply(E,arguments)}}}()})();var E=function(t){if(!Object.prototype.hasOwnProperty.apply(e,[t]))throw Error("The ‘"+t+"’ engine is not supported. Please use a different one.");return e[t]};E.validate=function(){var t=e.json;return t.validate.apply(t,arguments)},E.addValidator=function(){var t=e.json;return t.addAttribute.apply(t,arguments)},E.addAttribute=function(){var t=e.json;return t.addAttribute.apply(t,arguments)},E.addAttributeConstructor=function(){var t=e.json;return t.addAttributeConstructor.apply(t,arguments)},"undefined"!=typeof module&&module.exports?module.exports=E:"undefined"!=typeof define?define(function(){return E}):this.amanda=E})();