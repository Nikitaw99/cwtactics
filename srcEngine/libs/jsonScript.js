(function(){var e=function(e){"string"==typeof e&&(e=JSON.parse(e));for(var r=0,n=e.length;n>r;r++){var t=e[r];if(t.$set!==void 0&&"boolean"!=typeof t.$set)throw Error("rule.$set value must be a boolean");if(t.$when!==void 0){var o=t.$when;if(0!==o.length%2)throw Error("rule.$when lenght must be odd");for(var s=0,E=o.length;E>s;s+=2);}}},r=function(e,r,n,t){"number"!=typeof t&&(t=0);for(var o=0,s=e.length;s>o;o++){var E=e[o],i=E[n];if("number"==typeof i){var p=!0,u=E.$when;if(u)for(var a=0,h=u.length;h>a;a+=2){var f=r[u[a]],l=u[a+1],w=!1;if(l[0]===!0)f>=l[1]&&l[2]>=f&&(w=!0);else for(var d=0,c=l.length;c>d;d++)if(f===l[d]){w=!0;break}if(!w){p=!1;break}}p&&(E.$set&&(t=0),t+=i)}}return t};"undefined"!=typeof exports&&(exports.mapStrings=e,exports.solve=r),"undefined"!=typeof window&&(window.jsonScript||(window.jsonScript={}),window.jsonScript.mapStrings=e,window.jsonScript.solve=r)})(),function(){var e={"":["RULE"],END:["RULE",null],RULE:["WHEN","THEN"],WHEN:["SLOT","THEN"],SLOT:["IS","IN","BETWEEN"],IS:["SLOT","THEN"],IN:["SLOT","THEN"],BETWEEN:["SLOT","THEN"],THEN:["INCREASE","DECREASE","END"],INCREASE:["INCREASE","DECREASE","END"],DECREASE:["INCREASE","DECREASE","END"]},r=function(r){var n,t,o,s,E,i;i=e[""],o=[],r=r.replace(/(\r\n|\n|\r|\n|\t)/gm," "),t=r.split(" ");for(var p=0,u=t.length;u>p;p++)if(n=t[p],0!==n.length){if(-1===i.indexOf(n))throw Error(n+" token not allowed => util.expected "+JSON.stringify(i));switch(n){case"RULE":s={},o.push(s);break;case"WHEN":E=[];break;case"THEN":null!==E&&(s.$when=E,E=null);break;case"SLOT":E.push(t[p+1]),p+=1;break;case"IS":E.push([!0,t[p+1],t[p+1]]),p+=1;break;case"BETWEEN":if(E.push(t[p+1].split(",")),2!==E[E.length-1].length)throw Error("BETWEEN util.expects list with two values (lower,upper)");p+=1;break;case"IN":E.push(t[p+1].split(",")),p+=1;break;case"INCREASE":if("BY"!==t[p+2])throw Error("by util.expected after attribute but found "+t[p+2]);var a=parseInt(t[p+3],10);if("number"!=typeof a)throw Error("number util.expected by increase");s[t[p+1]]=a,p+=3;break;case"DECREASE":if("BY"!==t[p+2])throw Error("by util.expected after attribute but found "+t[p+2]);var a=-parseInt(t[p+3],10);if("number"!=typeof a)throw Error("number util.expected by decrease");s[t[p+1]]=a,p+=3;break;case"END":s=null;break;default:throw Error("unknown token => "+n)}i=e[n]}if(-1===i.indexOf(null))throw Error("end of rule defintion is not allowed");return o},n=function(e){for(var r,n,t=[],o=0,s=e.length;s>o;o++){if(r=e[o],n=Object.keys(r),t.push("RULE"),t.push("\n"),r.$when)for(var E=r.$when,i=0,p=E.length;p>i;i+=2)t.push(" SLOT"),t.push(E[i]),E[i+1][0]===!0?E[i+1][1]===E[i+1][2]?(t.push("IS"),t.push(E[i+1][1])):(t.push("BETWEEN"),t.push(E[i+1][1]+","+E[i+1][2])):(t.push("IN"),t.push(E[i+1].join(","))),t.push("\n");t.push("THEN"),t.push("\n");for(var i=0,p=n.length;p>i;i++)"$when"!==n[i]&&(0>r[n[i]]?t.push(" DECREASE"):t.push(" INCREASE"),t.push(n[i]),t.push("BY"),t.push(0>r[n[i]]?-r[n[i]]:r[n[i]]),t.push("\n"));t.push("END"),t.push("\n")}return t.join(" ")};"undefined"!=typeof exports&&(exports.compile=r,exports.decompile=n),"undefined"!=typeof window&&(window.jsonScript||(window.jsonScript={}),window.jsonScript.compile=r,window.jsonScript.decompile=n)}();