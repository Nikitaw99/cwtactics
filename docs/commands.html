<!DOCTYPE html>

<html>
<head>
  <title>commands.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="doc.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="ai.html">
                  ai.js
                </a>
              
                
                <a class="source" href="base.html">
                  base.js
                </a>
              
                
                <a class="source" href="commands.html">
                  commands.js
                </a>
              
                
                <a class="source" href="controller.html">
                  controller.js
                </a>
              
                
                <a class="source" href="datatypes.html">
                  datatypes.js
                </a>
              
                
                <a class="source" href="dependencies.html">
                  dependencies.js
                </a>
              
                
                <a class="source" href="flow.html">
                  flow.js
                </a>
              
                
                <a class="source" href="input.html">
                  input.js
                </a>
              
                
                <a class="source" href="loading.html">
                  loading.js
                </a>
              
                
                <a class="source" href="logic.html">
                  logic.js
                </a>
              
                
                <a class="source" href="model.html">
                  model.js
                </a>
              
                
                <a class="source" href="modification.html">
                  modification.js
                </a>
              
                
                <a class="source" href="renderer.html">
                  renderer.js
                </a>
              
                
                <a class="source" href="test.html">
                  test.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>commands.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">"use strict"</span>;

<span class="hljs-comment">/**
 * @class
 */</span>
cwt.Action = my.Class(<span class="hljs-comment">/** @lends cwt.Action.prototype */</span> {

  STATIC: <span class="hljs-comment">/** @lends cwt.Action */</span> {

    <span class="hljs-comment">/**
     * @constant
     */</span>
    MULTITON_NAMES: [
      <span class="hljs-string">"activatePower"</span>,
      <span class="hljs-string">"attack"</span>,
      <span class="hljs-string">"buildUnit"</span>,
      <span class="hljs-string">"capture"</span>,
      <span class="hljs-string">"doExplosion"</span>,
      <span class="hljs-string">"fireCannon"</span>,
      <span class="hljs-string">"fireLaser"</span>,
      <span class="hljs-string">"unitHide"</span>,
      <span class="hljs-string">"joinUnits"</span>,
      <span class="hljs-string">"loadUnit"</span>,
      <span class="hljs-string">"nextTurn"</span>,
      <span class="hljs-string">"changeWeather"</span>,
      <span class="hljs-string">"options"</span>,
      <span class="hljs-string">"silofire"</span>,
      <span class="hljs-string">"supplyUnit"</span>,
      <span class="hljs-string">"transferMoney"</span>,
      <span class="hljs-string">"transferProperty"</span>,
      <span class="hljs-string">"transferUnit"</span>,
      <span class="hljs-string">"unitUnhide"</span>,
      <span class="hljs-string">"unloadUnit"</span>,
      <span class="hljs-string">"wait"</span>,
      <span class="hljs-string">"startAnimation"</span>,
      <span class="hljs-string">"clearMove"</span>,
      <span class="hljs-string">"pushToMove"</span>,
      <span class="hljs-string">"flushMove"</span>
    ],

    <span class="hljs-comment">/**
     * Map actions are called in the idle state on the map.
     *
     * @constant
     */</span>
    MAP_ACTION: <span class="hljs-number">0</span>,

    <span class="hljs-comment">/**
     * Unit actions are called on units.
     *
     * @constant
     */</span>
    UNIT_ACTION: <span class="hljs-number">1</span>,

    <span class="hljs-comment">/**
     * Property actions are called on properties.
     *
     * @constant
     */</span>
    PROPERTY_ACTION: <span class="hljs-number">2</span>,

    <span class="hljs-comment">/**
     * Engine actions are callable by the engine itself.
     *
     * @constant
     */</span>
    ENGINE_ACTION: <span class="hljs-number">3</span>,

    <span class="hljs-comment">/**
     *
     *
     * @constant
     */</span>
    CLIENT_ACTION: <span class="hljs-number">4</span>,

    <span class="hljs-comment">/**
     * Holds all actions
     */</span>
    actions_: {},

    <span class="hljs-comment">/**
     * @return {Array}
     */</span>
    getRegisteredNames: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.classNames_;
    },

    <span class="hljs-comment">/**
     * @private
     */</span>
    registerAction_: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name, impl)</span> {</span>
      <span class="hljs-keyword">var</span> action = <span class="hljs-keyword">new</span> cwt.Action(impl);
      <span class="hljs-keyword">this</span>.registerInstance(name, action);
    },

    <span class="hljs-comment">/**
     *
     * @param key
     * @return {cwt.Action}
     */</span>
    getActionObject: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key)</span> {</span>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getInstance(key);
    },

    <span class="hljs-comment">/**
     *
     * @param impl
     */</span>
    unitAction: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(impl)</span> {</span>
      impl.type = cwt.Action.UNIT_ACTION;
      <span class="hljs-keyword">this</span>.registerAction_(impl.key, impl);
    },

    <span class="hljs-comment">/**
     *
     * @param impl
     */</span>
    propertyAction: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(impl)</span> {</span>
      impl.type = cwt.Action.PROPERTY_ACTION;
      <span class="hljs-keyword">this</span>.registerAction_(impl.key, impl);
    },

    <span class="hljs-comment">/**
     *
     * @param impl
     */</span>
    mapAction: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(impl)</span> {</span>
      impl.type = cwt.Action.MAP_ACTION;
      <span class="hljs-keyword">this</span>.registerAction_(impl.key, impl);
    },

    <span class="hljs-comment">/**
     *
     * @param impl
     */</span>
    clientAction: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(impl)</span> {</span>
      impl.type = cwt.Action.CLIENT_ACTION;
      <span class="hljs-keyword">this</span>.registerAction_(impl.key, impl);
    },

    <span class="hljs-comment">/**
     *
     * @param impl
     */</span>
    engineAction: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(impl)</span> {</span>
      impl.type = cwt.Action.ENGINE_ACTION;
      <span class="hljs-keyword">this</span>.registerAction_(impl.key, impl);
    }

  },

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(impl)</span> {</span>
    <span class="hljs-keyword">this</span>.type = impl.type;
    <span class="hljs-keyword">this</span>.action = impl.action;
    <span class="hljs-keyword">this</span>.condition = (impl.condition) ? impl.condition : cwt.emptyFunction;
    <span class="hljs-keyword">this</span>.prepareMenu = impl.prepareMenu || <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.isTargetValid = impl.isTargetValid || <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.prepareTargets = impl.prepareTargets || <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.multiStepAction = impl.multiStepAction || <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.prepareSelection = impl.prepareSelection || <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.targetSelectionType = impl.targetSelectionType || <span class="hljs-string">"A"</span>;
    <span class="hljs-keyword">this</span>.relation = impl.relation || <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.toDataBlock = impl.toDataBlock || <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.parseDataBlock = impl.parseDataBlock || <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.noAutoWait = impl.noAutoWait || <span class="hljs-literal">false</span>;
  }
});
my.extendClass(cwt.Action, {STATIC: cwt.IdMultiton});

cwt.Action.engineAction({
  key:<span class="hljs-string">"clearMove"</span>,

  parseDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dataBlock)</span> {</span>
    cwt.Move.tmpMovePath.clear();
  }
});
cwt.Action.engineAction({
  key:<span class="hljs-string">"flushMove"</span>,

  parseDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dataBlock)</span> {</span>
    cwt.Move.move(

      <span class="hljs-comment">/** @type {cwt.Unit} */</span> cwt.Unit.getInstance(dataBlock.p1),</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>start point</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      dataBlock.p2,
      dataBlock.p3,

      cwt.Move.tmpMovePath,</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>move meta                                                                       0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      (dataBlock.p4 === <span class="hljs-number">1</span>),
      (dataBlock.p5 === <span class="hljs-number">1</span>),
      (dataBlock.p5 === <span class="hljs-number">2</span>)
    );
  }
});
cwt.Action.engineAction({
  key: <span class="hljs-string">"changeWeather"</span>,

  toDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, dataBlock)</span> {</span>
    dataBlock.p1 = data.action.selectedEntry;
  },

  parseDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dataBlock)</span> {</span>
    cwt.Weather.changeWeather(
      cwt.WeatherSheet.sheets[dataBlock.p1]);
  }
});
cwt.Action.engineAction({
  key:<span class="hljs-string">"pushToMove"</span>,

  parseDataBlock: (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">push</span> <span class="hljs-params">(code)</span> {</span>
      cwt.Move.tmpMovePath.push(code);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dataBlock)</span> {</span>
      <span class="hljs-keyword">if</span> (dataBlock.p1 !== cwt.INACTIVE) push(dataBlock.p1);
      <span class="hljs-keyword">if</span> (dataBlock.p2 !== cwt.INACTIVE) push(dataBlock.p2);
      <span class="hljs-keyword">if</span> (dataBlock.p3 !== cwt.INACTIVE) push(dataBlock.p3);
      <span class="hljs-keyword">if</span> (dataBlock.p4 !== cwt.INACTIVE) push(dataBlock.p4);
      <span class="hljs-keyword">if</span> (dataBlock.p5 !== cwt.INACTIVE) push(dataBlock.p5);
    };
  })()
});
cwt.Action.engineAction({
  key:<span class="hljs-string">"startAnimation"</span>,

  parseDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dataBlock)</span> {</span>
    <span class="hljs-keyword">switch</span> (dataBlock.p1) {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>next turn</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
        cwt.Gameflow.changeState(<span class="hljs-string">"ANIMATION_NEXT_TURN"</span>);
        <span class="hljs-keyword">break</span>;
    }
  }
});

cwt.Action.mapAction({
  key: <span class="hljs-string">"activatePower"</span>,

  condition: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">return</span> cwt.CO.canActivatePower(cwt.Gameround.turnOwner, cwt.CO.POWER_LEVEL_COP);
  },

  hasSubMenu: <span class="hljs-literal">true</span>,
  prepareMenu: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>

    data.menu.addEntry(<span class="hljs-string">"cop"</span>);
    <span class="hljs-keyword">if</span> (cwt.CO.canActivatePower(cwt.Gameround.turnOwner, cwt.CO.POWER_LEVEL_SCOP)) {
      data.menu.addEntry(<span class="hljs-string">"scop"</span>);
    }
  },

  toDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, dataBlock)</span> {</span>
    dataBlock.p1 = (data.action.selectedSubEntry === <span class="hljs-string">"cop"</span> ? cwt.CO.POWER_LEVEL_COP : -<span class="hljs-number">1</span>);
    dataBlock.p1 = (data.action.selectedSubEntry === <span class="hljs-string">"scop"</span> ? cwt.CO.POWER_LEVEL_SCOP : -<span class="hljs-number">1</span>);
  },

  parseDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dataBlock)</span> {</span>
    cwt.CO.activatePower(cwt.Gameround.turnOwner,dataBlock.p1);
  }
});
cwt.Action.mapAction({
  key: <span class="hljs-string">"nextTurn"</span>,

  toDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, dataBlock)</span> {</span>
  },

  parseDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dataBlock)</span> {</span>
    cwt.Turn.next();
  }
});
cwt.Action.mapAction({
  key:<span class="hljs-string">"transferMoney"</span>,

  condition: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
    <span class="hljs-keyword">return</span> cwt.Team.canTransferMoney(
      cwt.Gameround.turnOwner,
      data.target.x,
      data.target.y
    );
  },

  hasSubMenu: <span class="hljs-literal">true</span>,
  prepareMenu: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
    cwt.Team.getTransferMoneyTargets(cwt.Gameround.turnOwner,data.menu);
  },

  toDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, dataBlock)</span> {</span>
    dataBlock.p1 = cwt.Gameround.turnOwner.id;
    dataBlock.p2 = data.target.property.owner.id;
    dataBlock.p3 = data.selectedSubEntry;
  },

  parseDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dataBlock)</span> {</span>
    cwt.Team.transferMoney(
      <span class="hljs-comment">/** @type {cwt.Player} */</span> cwt.Player.getInstance(dataBlock.p1),
      <span class="hljs-comment">/** @type {cwt.Player} */</span> cwt.Player.getInstance(dataBlock.p2),
      dataBlock.p3
    );
  }

});

cwt.Action.propertyAction({
  key:<span class="hljs-string">"buildUnit"</span>,

  condition: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
    <span class="hljs-keyword">return</span> (
      cwt.Factory.isFactory(data.source.property) &amp;&amp;
        cwt.Factory.canProduce(data.source.property)
      );
  },

  hasSubMenu: <span class="hljs-literal">true</span>,
  prepareMenu: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
    cwt.Factory.generateBuildMenu(
      data.source.property,
      data.menu,
      <span class="hljs-literal">true</span>
    );
  },

  toDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, dataBlock)</span> {</span>
    dataBlock.p1 = cwt.Gameround.turnOwner.id;
    dataBlock.p2 = data.target.property.owner.id;
  },

  parseDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dataBlock)</span> {</span>
    cwt.Factory.buildUnit(
      <span class="hljs-comment">/** @type {cwt.Property} */</span> cwt.Property.getInstance(dataBlock.p1),
      dataBlock.p2
    );
  }
});
cwt.Action.propertyAction({

  key:<span class="hljs-string">"transferProperty"</span>,

  relationToProp:[
    <span class="hljs-string">"S"</span>,<span class="hljs-string">"T"</span>,
    cwt.Relationship.RELATION_SAME_THING
  ],

  condition: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data  )</span>{</span>
    <span class="hljs-keyword">return</span> cwt.Team.canTransferProperty(data.source.property);
  },

  hasSubMenu: <span class="hljs-literal">true</span>,
  prepareMenu: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
    cwt.Team.getPropertyTransferTargets(data.source.property.owner, data.menu);
  },

  toDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, dataBlock)</span> {</span>
    dataBlock.p1 = data.source.propertyId;
    dataBlock.p2 = data.selectedSubEntry;
  },

  parseDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dataBlock)</span> {</span>
    cwt.Team.transferPropertyToPlayer(
      <span class="hljs-comment">/** @type {cwt.Property} */</span> cwt.Property.getInstance(dataBlock.p1),
      <span class="hljs-comment">/** @type {cwt.Player} */</span> cwt.Player.getInstance(dataBlock.p2)
    );
  }
});

<span class="hljs-comment">/*
 cwt.Action.unitAction({
 key:"detachCommander",

 condition: function(data){
 return model.events.detachCommander_check(

 model.round_turnOwner
 );
 },

 invoke: function( data ){
 controller.commandStack_sharedInvokement(
 "detachCommander_invoked",
 model.round_turnOwner,
 data.target.x,
 data.target.y
 );
 }
 });
 */</span>
<span class="hljs-comment">/*
 cwt.Action.unitAction({
 key:"attachCommander",

 condition: function(data){
 return model.events.attachCommander_check(

 model.round_turnOwner
 );
 },

 invoke: function( data ){
 controller.commandStack_sharedInvokement(
 "co_attachCommander",
 model.round_turnOwner,
 data.source.unitId
 );
 }
 });
 */</span>

cwt.Action.unitAction({
  key: <span class="hljs-string">"attack"</span>,

  relation: [
    <span class="hljs-string">"S"</span>, <span class="hljs-string">"T"</span>,
    cwt.Relationship.RELATION_NONE,
    cwt.Relationship.RELATION_SAME_THING
  ],

  condition: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
    <span class="hljs-keyword">if</span> (cwt.Gameround.inPeacePhase()) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">return</span> cwt.Attack.hasTargets(
      data.source.unit,
      data.target.x,
      data.target.y,
      data.movePath.data[<span class="hljs-number">0</span>] !== cwt.INACTIVE
    );
  },

  targetSelectionType: <span class="hljs-string">"A"</span>,
  prepareTargets: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
    cwt.Attack.calculateTargets(
      data.source.unit,
      data.target.x,
      data.target.y,
      data.selection
    );
  },

  toDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, dataBlock)</span> {</span>
    dataBlock.p1 = data.source.unitId;
    dataBlock.p2 = data.targetselection.unitId;
    dataBlock.p3 = <span class="hljs-built_in">Math</span>.round(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">100</span>);
    dataBlock.p4 = <span class="hljs-built_in">Math</span>.round(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">100</span>);
  },

  parseDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dataBlock)</span> {</span>
    cwt.Attack.attack(
      <span class="hljs-comment">/** @type {cwt.Unit} */</span> cwt.Unit.getInstance(dataBlock.p1),
      <span class="hljs-comment">/** @type {cwt.Unit} */</span> cwt.Unit.getInstance(dataBlock.p2),
      dataBlock.p3,
      dataBlock.p4
    );
  }
});
cwt.Action.unitAction({
  key: <span class="hljs-string">"capture"</span>,

  relation: [
    <span class="hljs-string">"S"</span>, <span class="hljs-string">"T"</span>,
    cwt.Relationship.RELATION_SAME_THING,
    cwt.Relationship.RELATION_NONE
  ],

  relationToProp: [
    <span class="hljs-string">"S"</span>, <span class="hljs-string">"T"</span>,
    cwt.Relationship.RELATION_ENEMY,
    cwt.Relationship.RELATION_NONE
  ],

  condition: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
    <span class="hljs-keyword">if</span> (cwt.Capture.canCapture(data.source.unit)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span> (cwt.Capture.canBeCaptured(data.target.property)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  },

  toDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, dataBlock)</span> {</span>
    dataBlock.p1 = data.target.propertyId;
    dataBlock.p2 = data.source.unitId;
  },

  parseDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dataBlock)</span> {</span>
    cwt.Capture.captureProperty(
      cwt.Property.getInstance(dataBlock.p1),
      cwt.Unit.getInstance(dataBlock.p2)
    );
  }
});
cwt.Action.unitAction({
  key:<span class="hljs-string">"doExplosion"</span>,
  noAutoWait: <span class="hljs-literal">true</span>,

  relation: [
    <span class="hljs-string">"S"</span>,<span class="hljs-string">"T"</span>,
    cwt.Relationship.RELATION_NONE,
    cwt.Relationship.RELATION_SAME_THING
  ],

  condition: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
    <span class="hljs-keyword">return</span> cwt.Explode.canExplode(data.source.unit);
  },

  toDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, dataBlock)</span> {</span>
    dataBlock.p1 = data.source.x;
    dataBlock.p2 = data.source.y;
    dataBlock.p3 = cwt.Explode.getExplosionRange(data.source.unit);
    dataBlock.p4 = cwt.Explode.getExplosionDamage(data.source.unit);
  },

  parseDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dataBlock)</span> {</span>
    cwt.Explode.doExplosion(dataBlock.p1,dataBlock.p2,dataBlock.p3,dataBlock.p4);
  }
});
cwt.Action.unitAction({
  key: <span class="hljs-string">"fireCannon"</span>,

  relation: [
    <span class="hljs-string">"S"</span>, <span class="hljs-string">"T"</span>,
    cwt.Relationship.RELATION_SAME_THING
  ],

  condition: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
    <span class="hljs-keyword">return</span> (
      cwt.Cannon.isCannonUnit(data.source.unit) &amp;&amp;
        cwt.Cannon.hasTargets(data.source.x, data.source.y, <span class="hljs-literal">null</span>)
      );
  },

  targetSelectionType: <span class="hljs-string">"A"</span>,
  prepareTargets: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
    cwt.Cannon.fillCannonTargets(data.source.x, data.source.y, data.selection);
  },

  toDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, dataBlock)</span> {</span>
    dataBlock.p1 = data.source.x;
    dataBlock.p2 = data.source.y;
    dataBlock.p3 = data.targetselection.x;
    dataBlock.p4 = data.targetselection.y;
  },

  parseDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dataBlock)</span> {</span>
    cwt.Cannon.fireCannon(dataBlock.p1, dataBlock.p2,dataBlock.p3, dataBlock.p4);
  }

});
cwt.Action.unitAction({
  key:<span class="hljs-string">"fireLaser"</span>,

  relation:[
    <span class="hljs-string">"S"</span>,<span class="hljs-string">"T"</span>,
    cwt.Relationship.RELATION_SAME_THING
  ],

  condition: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
    <span class="hljs-keyword">return</span> cwt.Laser.isLaser(data.target.unit);
  },

  toDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, dataBlock)</span> {</span>
    dataBlock.p1 = data.target.x;
    dataBlock.p2 = data.target.y;
  },

  parseDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dataBlock)</span> {</span>
    cwt.Laser.fireLaser(dataBlock.p1,dataBlock.p2);
  }
});
cwt.Action.unitAction({
  key:<span class="hljs-string">"unitHide"</span>,

  relation: [
    <span class="hljs-string">"S"</span>,<span class="hljs-string">"T"</span>,
    cwt.Relationship.RELATION_NONE,
    cwt.Relationship.RELATION_SAME_THING
  ],

  condition: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
    <span class="hljs-keyword">return</span> model.events.unitHide_check(data.source.unitId);
  },

  invoke: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
    controller.commandStack_sharedInvokement(
      <span class="hljs-string">"unitHide_invoked"</span>,
      data.source.unitId
    );
  }

});
cwt.Action.unitAction({
  key:<span class="hljs-string">"joinUnits"</span>,
  noAutoWait: <span class="hljs-literal">true</span>,

  relation:[
    <span class="hljs-string">"S"</span>,<span class="hljs-string">"T"</span>,
    cwt.Relationship.RELATION_OWN
  ],

  condition: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
    <span class="hljs-keyword">return</span> cwt.Join.canJoin(data.source.unit,data.target.unit);
  },


  toDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, dataBlock)</span> {</span>
    dataBlock.p1 = data.source.unitId;
    dataBlock.p2 = data.target.x;
    dataBlock.p2 = data.target.y;
  },

  parseDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dataBlock)</span> {</span>
    cwt.Join.join(
      <span class="hljs-comment">/** @type {cwt.Unit} */</span> cwt.Unit.getInstance(dataBlock.p1),
      dataBlock.p2, dataBlock.p3
    );
  }

});
cwt.Action.unitAction({
  key:<span class="hljs-string">"loadUnit"</span>,

  relation: [
    <span class="hljs-string">"S"</span>,<span class="hljs-string">"T"</span>,
    cwt.Relationship.RELATION_OWN
  ],

  condition: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
    <span class="hljs-keyword">return</span> model.events.loadUnit_check(data.source.unitId,data.target.unitId);
  },

  invoke: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
    controller.commandStack_sharedInvokement(
      <span class="hljs-string">"loadUnit_invoked"</span>,
      data.source.unitId,
      data.target.unitId
    );
  }

});
cwt.Action.unitAction({
  key: <span class="hljs-string">"silofire"</span>,

  relation: [
    <span class="hljs-string">"S"</span>, <span class="hljs-string">"T"</span>,
    cwt.Relationship.RELATION_SAME_THING,
    cwt.Relationship.RELATION_NONE
  ],

  relationToProp: [
    <span class="hljs-string">"S"</span>, <span class="hljs-string">"T"</span>,
    cwt.Player.RELATION_NONE
  ],

  condition: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
    <span class="hljs-keyword">if</span> (!cwt.Silo.isRocketSilo(data.target.property)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span> (!cwt.Silo.canBeFired(data.target.property, data.source.unit)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },

  prepareSelection: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
    data.selectionRange = data.target.property.type.rocketsilo.range;
  },

  isTargetValid: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, x, y)</span> {</span>
    <span class="hljs-keyword">return</span> cwt.Silo.canBeFiredTo(data.target.property, x, y);
  },

  toDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, dataBlock)</span> {</span>
    dataBlock.p1 = data.source.x;
    dataBlock.p2 = data.source.y;
    dataBlock.p3 = data.targetselection.x;
    dataBlock.p4 = data.targetselection.y;
    dataBlock.p5 = data.source.unit.owner.id;
  },

  parseDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dataBlock)</span> {</span>
    cwt.Silo.fireSilo(
      dataBlock.p1,dataBlock.p2,
      dataBlock.p3,dataBlock.p4,
      cwt.Player.getInstance(dataBlock.p5)
    );
  }
});
cwt.Action.unitAction({
  key: <span class="hljs-string">"supplyUnit"</span>,

  relation: [
    <span class="hljs-string">"S"</span>, <span class="hljs-string">"T"</span>,
    cwt.Relationship.RELATION_NONE,
    cwt.Relationship.RELATION_SAME_THING
  ],

  condition: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
    <span class="hljs-keyword">return</span> (
      cwt.Supply.isSupplier(data.target.unit) &amp;&amp;
        cwt.Supply.canSupplyTile(data.target.unit, data.target.x, data.target.y) );
  },

  toDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, dataBlock)</span> {</span>
    dataBlock.p1 = data.target.x;
    dataBlock.p2 = data.target.y;
  },

  parseDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(datBlock)</span> {</span>
    cwt.Supply.supplyNeighbours(datBlock.p1, datBlock.p2);
  }

});
cwt.Action.unitAction({
  key:<span class="hljs-string">"transferUnit"</span>,

  relation: [
    <span class="hljs-string">"S"</span>,<span class="hljs-string">"T"</span>,
    cwt.Relationship.RELATION_SAME_THING
  ],

  condition: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
    <span class="hljs-keyword">return</span> cwt.Team.canTransferUnit(data.source.unit);
  },

  hasSubMenu: <span class="hljs-literal">true</span>,
  prepareMenu: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
    cwt.Team.getUnitTransferTargets(data.source.unit.owner, data.menu);
  },

  toDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, dataBlock)</span> {</span>
    dataBlock.p1 = data.source.unitId,
    dataBlock.p2 = data.selectedSubEntry;
  },

  parseDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dataBlock)</span> {</span>
    cwt.Team.transferUnitToPlayer(
      <span class="hljs-comment">/** @type {cwt.Unit} */</span> cwt.Unit.getInstance(dataBlock.p1),
      <span class="hljs-comment">/** @type {cwt.Player} */</span> cwt.Player.getInstance(dataBlock.p2)
    );
  }

});
cwt.Action.unitAction({
  key:<span class="hljs-string">"unitUnhide"</span>,

  relation: [
    <span class="hljs-string">"S"</span>,<span class="hljs-string">"T"</span>,
    cwt.Relationship.RELATION_NONE,
    cwt.Relationship.RELATION_SAME_THING
  ],

  condition: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
    <span class="hljs-keyword">return</span> model.events.unitUnhide_check(
      data.source.unitId
    );
  },

  invoke: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
    controller.commandStack_sharedInvokement(
      <span class="hljs-string">"unitUnhide_invoked"</span>,
      data.source.unitId
    );
  }
});
cwt.Action.unitAction({
  key:<span class="hljs-string">"unloadUnit"</span>,
  multiStepAction: <span class="hljs-literal">true</span>,

  relation:[
    <span class="hljs-string">"S"</span>,<span class="hljs-string">"T"</span>,
    cwt.Relationship.RELATION_SAME_THING,
    cwt.Relationship.RELATION_NONE
  ],

  condition: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
    <span class="hljs-keyword">return</span> model.events.unloadUnit_check(

      data.source.unitId,
      data.target.x,
      data.target.y
    );
  },

  prepareMenu: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
    model.events.unloadUnit_addUnloadTargetsToMenu(
      data.source.unitId,
      data.target.x,
      data.target.y,
      data.menu
    );
  },

  targetSelectionType: <span class="hljs-string">"B"</span>,
  prepareTargets: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
    model.events.unloadUnit_addUnloadTargetsToSelection(
      data.source.unitId,
      data.target.x,
      data.target.y,
      data.action.selectedSubEntry,
      data.selection
    );
  },

  invoke: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
    controller.commandStack_sharedInvokement(
      <span class="hljs-string">"unloadUnit_invoked"</span>,
      data.source.unitId,
      data.target.x,
      data.target.y,
      data.action.selectedSubEntry,
      data.targetselection.x,
      data.targetselection.y
    );
  }
});
cwt.Action.unitAction({
  key: <span class="hljs-string">"wait"</span>,

  relation: [
    <span class="hljs-string">"S"</span>, <span class="hljs-string">"T"</span>,
    cwt.Relationship.RELATION_NONE,
    cwt.Relationship.RELATION_SAME_THING
  ],

  condition: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
    <span class="hljs-keyword">return</span> data.source.unit.canAct;
  },

  toDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, dataBlock)</span> {</span>
    dataBlock.p1 = data.source.unitId;
  },

  parseDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dataBlock)</span> {</span>
    cwt.Unit.getInstance(dataBlock.p1).canAct = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>if p2 === 1 —&gt; trapped</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  }
});

cwt.Action.clientAction({
  key:<span class="hljs-string">"options"</span>,

  condition: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },

  toDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data, dataBlock)</span> {</span>},

  parseDataBlock: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(dataBlock)</span> {</span>
    controller.screenStateMachine.event(<span class="hljs-string">"toOptions_"</span>,<span class="hljs-literal">true</span>);
  }
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>