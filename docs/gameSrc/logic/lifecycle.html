<!DOCTYPE html>

<html>
<head>
  <title>lifecycle.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="attack.html">
                attack.js
              </a>
            
              
              <a class="source" href="cannon.html">
                cannon.js
              </a>
            
              
              <a class="source" href="capture.html">
                capture.js
              </a>
            
              
              <a class="source" href="co.html">
                co.js
              </a>
            
              
              <a class="source" href="exploder.html">
                exploder.js
              </a>
            
              
              <a class="source" href="factory.html">
                factory.js
              </a>
            
              
              <a class="source" href="fog.html">
                fog.js
              </a>
            
              
              <a class="source" href="join.html">
                join.js
              </a>
            
              
              <a class="source" href="laser.html">
                laser.js
              </a>
            
              
              <a class="source" href="lifecycle.html">
                lifecycle.js
              </a>
            
              
              <a class="source" href="move.html">
                move.js
              </a>
            
              
              <a class="source" href="relationship.html">
                relationship.js
              </a>
            
              
              <a class="source" href="silo.html">
                silo.js
              </a>
            
              
              <a class="source" href="supply.html">
                supply.js
              </a>
            
              
              <a class="source" href="team.html">
                team.js
              </a>
            
              
              <a class="source" href="transport.html">
                transport.js
              </a>
            
              
              <a class="source" href="turn.html">
                turn.js
              </a>
            
              
              <a class="source" href="weather.html">
                weather.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>lifecycle.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">"use strict"</span>;

<span class="hljs-keyword">var</span> constants = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../constants"</span>);
<span class="hljs-keyword">var</span> assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../functions"</span>).assert;
<span class="hljs-keyword">var</span> model = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../model"</span>);
<span class="hljs-keyword">var</span> fog = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../logic/fog"</span>);

<span class="hljs-keyword">var</span> cfgNoUnitsLeftLoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../config"</span>).getConfig(<span class="hljs-string">"noUnitsLeftLoose"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Returns an inactive <strong>unit object</strong> or <strong>null</strong> if every slot in the unit list is used.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.getInactiveUnit = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = model.units.length; i &lt; e; i++) {
    <span class="hljs-keyword">if</span> (!model.units[i].owner) {
      <span class="hljs-keyword">return</span> model.units[i];
    }
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>@param {number} x
@param {number} y
@param {cwt.Player|cwt.Unit|cwt.Property} player
@param type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.createUnit = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y, player, type)</span> </span>{
  <span class="hljs-keyword">if</span> (constants.DEBUG) assert(model.isValidPosition(x, y));

  <span class="hljs-keyword">var</span> tile = model.mapData[x][y];

  <span class="hljs-keyword">if</span> (constants.DEBUG) assert(player <span class="hljs-keyword">instanceof</span> model.Player &amp;&amp; player.numberOfUnits &lt; constants.MAX_UNITS);

  <span class="hljs-keyword">var</span> unit = exports.getInactiveUnit();</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>set references</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  unit.owner = player;
  tile.unit = unit;
  player.numberOfUnits++;

  unit.initByType(type);

  fog.addUnitVision(x, y, player);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>@param {number} x
@param {number} y
@param {boolean} silent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.destroyUnit = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y, silent)</span> </span>{
  <span class="hljs-keyword">var</span> tile = model.mapData[x][y];

  <span class="hljs-keyword">if</span> (constants.DEBUG) assert(tile.unit);

  fog.removeUnitVision(x, y, tile.unit.owner);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>TODO check loads</p>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>remove references</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> owner = tile.unit.owner;
  owner.numberOfUnits--;

  <span class="hljs-keyword">if</span> (constants.DEBUG) assert(owner.numberOfUnits &gt;= <span class="hljs-number">0</span>);

  tile.unit.owner = <span class="hljs-literal">null</span>;
  tile.unit = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>end game when the player does not have any unit left</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (cfgNoUnitsLeftLoose.value === <span class="hljs-number">1</span> &amp;&amp; owner.numberOfUnits === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">this</span>.deactivatePlayer(owner);
  }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>A player has loosed the game round due a specific reason. This
function removes all of his units and properties. Furthermore
the left teams will be checked. If only one team is left then
the end game event will be invoked.</p>
<p>@param {cwt.Player} player</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.deactivatePlayer = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(player)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>drop units</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (constants.DEBUG) model(player <span class="hljs-keyword">instanceof</span> model.Player);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = model.units.length; i &lt; e; i++) {
    <span class="hljs-keyword">var</span> unit = model.units[i];
    <span class="hljs-keyword">if</span> (unit.owner === player) {</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>TODO</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>drop properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = model.properties.size(); i &lt; e; i++) {
    <span class="hljs-keyword">var</span> prop = model.properties[i];
    <span class="hljs-keyword">if</span> (prop.owner === player) {
      prop.makeNeutral();</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>change type when the property is a changing type property</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> changeType = prop.type.changeAfterCaptured;
    }
  }

  player.deactivate();</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>when no opposite teams are found then the game has ended</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (!model.areEnemyTeamsLeft()) {</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>TODO</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>@return {boolean}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.hasFreeUnitSlot = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(player)</span> </span>{
  <span class="hljs-keyword">return</span> player.numberOfUnits &lt; model.Player.MAX_UNITS;
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
