<!DOCTYPE html>

<html>
<head>
  <title>cannon.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="attack.html">
                attack.js
              </a>
            
              
              <a class="source" href="cannon.html">
                cannon.js
              </a>
            
              
              <a class="source" href="capture.html">
                capture.js
              </a>
            
              
              <a class="source" href="co.html">
                co.js
              </a>
            
              
              <a class="source" href="exploder.html">
                exploder.js
              </a>
            
              
              <a class="source" href="factory.html">
                factory.js
              </a>
            
              
              <a class="source" href="fog.html">
                fog.js
              </a>
            
              
              <a class="source" href="join.html">
                join.js
              </a>
            
              
              <a class="source" href="laser.html">
                laser.js
              </a>
            
              
              <a class="source" href="lifecycle.html">
                lifecycle.js
              </a>
            
              
              <a class="source" href="move.html">
                move.js
              </a>
            
              
              <a class="source" href="relationship.html">
                relationship.js
              </a>
            
              
              <a class="source" href="silo.html">
                silo.js
              </a>
            
              
              <a class="source" href="supply.html">
                supply.js
              </a>
            
              
              <a class="source" href="team.html">
                team.js
              </a>
            
              
              <a class="source" href="transport.html">
                transport.js
              </a>
            
              
              <a class="source" href="turn.html">
                turn.js
              </a>
            
              
              <a class="source" href="weather.html">
                weather.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>cannon.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>Returns <strong>true</strong> if a given <strong>unit</strong> is a cannon trigger unit, else <strong>false</strong>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.isCannonUnit = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(unit)</span> </span>{
  <span class="hljs-keyword">if</span> (cwt.DEBUG) {
    cwt.assert(unit <span class="hljs-keyword">instanceof</span> cwt.UnitClass);
  }

  <span class="hljs-keyword">return</span> (unit.type.ID === cwt.DataSheets.CANNON_UNIT_INV);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Returns <strong>true</strong> when a cannon trigger unit is at a given position (<strong>x</strong>,<strong>y</strong>) and has targets in it’s range,
else <strong>false</strong>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.hasTargets = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y, selection)</span> </span>{
  <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>.isCannonUnit(cwt.Model.mapData[x][y].unit) &amp;&amp; <span class="hljs-keyword">this</span>.markCannonTargets(x, y, selection));
};</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>@param {number} x
@param {number} y
@param {cwt.SelectionMap} selection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.fillCannonTargets = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y, selection)</span> </span>{
  <span class="hljs-keyword">this</span>.markCannonTargets(x, y, selection);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Fires a cannon at a given position.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.fireCannon = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(ox, oy, x, y)</span> </span>{
  <span class="hljs-keyword">var</span> target = cwt.Model.mapData[x][y].unit;
  <span class="hljs-keyword">var</span> type = <span class="hljs-keyword">this</span>.grabBombPropTypeFromPos(ox, oy);

  target.takeDamage(cwt.Unit.pointsToHealth(type.cannon.damage), <span class="hljs-number">9</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Marks all cannon targets in a selection. The area of fire will be defined by
the rectangle from  <code>sx,sy</code> to <code>tx,ty</code>. The cannon is on the tile <code>ox,oy</code>
with a given <code>range</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.tryToMarkCannonTargets = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(player, selection, ox, oy, otx, oty, sx, sy, tx, ty, range)</span> </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.DEBUG) cwt.assert(player <span class="hljs-keyword">instanceof</span> cwt.PlayerClass);

  <span class="hljs-keyword">var</span> tid = player.team;
  <span class="hljs-keyword">var</span> osy = sy;
  <span class="hljs-keyword">var</span> result = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">for</span> (; sx &lt;= tx; sx++) {
    <span class="hljs-keyword">for</span> (sy = osy; sy &gt;= ty; sy--) {
      <span class="hljs-keyword">if</span> (!cwt.Map.isValidPosition(sx, sy)) <span class="hljs-keyword">continue</span>;
      <span class="hljs-keyword">var</span> tile = cwt.Map.data[sx][sy];</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>range maybe don’t match</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">Math</span>.abs(sx - ox) + <span class="hljs-built_in">Math</span>.abs(sy - oy)) &gt; range) <span class="hljs-keyword">continue</span>;
      <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">Math</span>.abs(sx - otx) + <span class="hljs-built_in">Math</span>.abs(sy - oty)) &gt; range) <span class="hljs-keyword">continue</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>in fog</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (tile.visionTurnOwner &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">continue</span>;

      <span class="hljs-keyword">var</span> unit = tile.unit;
      <span class="hljs-keyword">if</span> (unit) {
        <span class="hljs-keyword">if</span> (unit.owner.team !== tid) {
          <span class="hljs-keyword">if</span> (selection) selection.setValueAt(sx, sy, <span class="hljs-number">1</span>);
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
          result = <span class="hljs-literal">true</span>;
        }
      }
    }
  }

  <span class="hljs-keyword">return</span> result;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Marks all cannon targets in a given selection model.</p>
<p>@param {cwt.Unit} cannon
@param {cwt.SelectionMap} selection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.markCannonTargets = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y, selection)</span> </span>{
  <span class="hljs-keyword">var</span> prop = cwt.Model.mapData[x][y].property;
  <span class="hljs-keyword">var</span> type = (prop.type.ID !== <span class="hljs-string">"PROP_INV"</span>) ? prop.type : <span class="hljs-keyword">this</span>.grabBombPropTypeFromPos(x, y);

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.DEBUG) cwt.assert(type.cannon);

  selection.setCenter(x, y, cwt.INACTIVE);

  <span class="hljs-keyword">var</span> otx, oty, sx, sy, tx, ty;
  <span class="hljs-keyword">var</span> max = type.cannon.range;
  <span class="hljs-keyword">var</span> ox = x;
  <span class="hljs-keyword">var</span> oy = y;
  <span class="hljs-keyword">switch</span> (type.cannon.direction) {

    <span class="hljs-keyword">case</span> <span class="hljs-string">"N"</span>:
      otx = x;
      oty = y - max - <span class="hljs-number">1</span>;
      sx = x - max + <span class="hljs-number">1</span>;
      sy = y - <span class="hljs-number">1</span>;
      tx = x + max - <span class="hljs-number">1</span>;
      ty = y - max;
      <span class="hljs-keyword">break</span>;

    <span class="hljs-keyword">case</span> <span class="hljs-string">"E"</span>:
      otx = x + max + <span class="hljs-number">1</span>;
      oty = y;
      sx = x + <span class="hljs-number">1</span>;
      sy = y + max - <span class="hljs-number">1</span>;
      tx = x + max;
      ty = y - max + <span class="hljs-number">1</span>;
      <span class="hljs-keyword">break</span>;

    <span class="hljs-keyword">case</span> <span class="hljs-string">"W"</span>:
      otx = x - max - <span class="hljs-number">1</span>;
      oty = y;
      sx = x - max;
      sy = y + max - <span class="hljs-number">1</span>;
      tx = x - <span class="hljs-number">1</span>;
      ty = y - max + <span class="hljs-number">1</span>;
      <span class="hljs-keyword">break</span>;

    <span class="hljs-keyword">case</span> <span class="hljs-string">"S"</span>:
      otx = x;
      oty = y + max + <span class="hljs-number">1</span>;
      sx = x - max + <span class="hljs-number">1</span>;
      sy = y + max;
      tx = x + max - <span class="hljs-number">1</span>;
      ty = y + <span class="hljs-number">1</span>;
      <span class="hljs-keyword">break</span>;
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.tryToMarkCannonTargets(
    cwt.Model.mapData[x][y].unit.owner,
    selection,
    ox, oy,
    otx, oty,
    sx, sy,
    tx, ty,
    max
  );
};</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>@param x
@param y
@return {cwt.PropertySheet}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.grabBombPropTypeFromPos = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y)</span> </span>{
  <span class="hljs-keyword">var</span> map = cwt.Model.mapData;
  <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">if</span> (y + <span class="hljs-number">1</span> &lt; cwt.Model.mapHeight &amp;&amp; map[x][y + <span class="hljs-number">1</span>].property &amp;&amp;
      map[x][y + <span class="hljs-number">1</span>].property.type.ID === cwt.DataSheets.PROP_INV) {
      y++;
      <span class="hljs-keyword">continue</span>;
    }

    <span class="hljs-keyword">break</span>;
  }

  <span class="hljs-keyword">if</span> (map[x][y].property.type.ID !== cwt.DataSheets.PROP_INV) {
    <span class="hljs-keyword">return</span> map[x][y].property.type;
  }

  <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">if</span> (x + <span class="hljs-number">1</span> &lt; cwt.Model.mapWidth &amp;&amp; map[x + <span class="hljs-number">1</span>][y].property &amp;&amp;
      map[x + <span class="hljs-number">1</span>][y].property.type.ID !== cwt.DataSheets.PROP_INV) {
      <span class="hljs-keyword">return</span> map[x + <span class="hljs-number">1</span>][y].property.type;
    }

    <span class="hljs-keyword">break</span>;
  }

  cwt.assert(<span class="hljs-literal">false</span>);
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
