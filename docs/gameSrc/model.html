<!DOCTYPE html>

<html>
<head>
  <title>model.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="actions.html">
                actions.js
              </a>
            
              
              <a class="source" href="ai.html">
                ai.js
              </a>
            
              
              <a class="source" href="async.html">
                async.js
              </a>
            
              
              <a class="source" href="audio.html">
                audio.js
              </a>
            
              
              <a class="source" href="circularBuffer.html">
                circularBuffer.js
              </a>
            
              
              <a class="source" href="config.html">
                config.js
              </a>
            
              
              <a class="source" href="constants.html">
                constants.js
              </a>
            
              
              <a class="source" href="cwScript.html">
                cwScript.js
              </a>
            
              
              <a class="source" href="error.html">
                error.js
              </a>
            
              
              <a class="source" href="events.html">
                events.js
              </a>
            
              
              <a class="source" href="functions.html">
                functions.js
              </a>
            
              
              <a class="source" href="image.html">
                image.js
              </a>
            
              
              <a class="source" href="input.html">
                input.js
              </a>
            
              
              <a class="source" href="loading.html">
                loading.js
              </a>
            
              
              <a class="source" href="localization.html">
                localization.js
              </a>
            
              
              <a class="source" href="main.html">
                main.js
              </a>
            
              
              <a class="source" href="matrix.html">
                matrix.js
              </a>
            
              
              <a class="source" href="model.html">
                model.js
              </a>
            
              
              <a class="source" href="network.html">
                network.js
              </a>
            
              
              <a class="source" href="renderer.html">
                renderer.js
              </a>
            
              
              <a class="source" href="sheets.html">
                sheets.js
              </a>
            
              
              <a class="source" href="statemachine.html">
                statemachine.js
              </a>
            
              
              <a class="source" href="storage.html">
                storage.js
              </a>
            
              
              <a class="source" href="systemFeatures.html">
                features.js
              </a>
            
              
              <a class="source" href="tileVariants.html">
                tileVariants.js
              </a>
            
              
              <a class="source" href="uiWidgets.html">
                uiWidgets.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>model.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">"use strict"</span>;

<span class="hljs-keyword">var</span> daysOfPeaceCfg = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./config"</span>).getConfig(<span class="hljs-string">"daysOfPeace"</span>);
<span class="hljs-keyword">var</span> createBuffer = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./circularBuffer"</span>).createBufferByClass;
<span class="hljs-keyword">var</span> constants = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./constants"</span>);
<span class="hljs-keyword">var</span> assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./functions"</span>).assert;
<span class="hljs-keyword">var</span> matrix = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./matrix"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Advance Wars 1 game mode. The first ever released game mode of the advance wars series (GBA and up).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.GAME_MODE_AW1 = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Advance Wars 2 game mode. It introduced the Super CO Power.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.GAME_MODE_AW2 = <span class="hljs-number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Object that holds information about objects at a given position (x,y).</p>
<p>@class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.PositionData = my.Class({

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">this</span>.clean();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Cleans all data of the object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  clean: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">this</span>.x = -<span class="hljs-number">1</span>;
    <span class="hljs-keyword">this</span>.y = -<span class="hljs-number">1</span>;
    <span class="hljs-keyword">this</span>.tile = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.unit = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.property = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.unitId = -<span class="hljs-number">1</span>;
    <span class="hljs-keyword">this</span>.propertyId = -<span class="hljs-number">1</span>;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Grabs the data from another position object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  grab: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(otherPos)</span> </span>{
    assert(otherPos <span class="hljs-keyword">instanceof</span> exports.PositionData);

    <span class="hljs-keyword">this</span>.x = otherPos.x;
    <span class="hljs-keyword">this</span>.y = otherPos.y;
    <span class="hljs-keyword">this</span>.tile = otherPos.tile;
    <span class="hljs-keyword">this</span>.unit = otherPos.unit;
    <span class="hljs-keyword">this</span>.unitId = otherPos.unitId;
    <span class="hljs-keyword">this</span>.property = otherPos.property;
    <span class="hljs-keyword">this</span>.propertyId = otherPos.propertyId;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Sets a position.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  set: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x, y)</span> </span>{
    <span class="hljs-keyword">this</span>.clean();

    <span class="hljs-keyword">this</span>.x = x;
    <span class="hljs-keyword">this</span>.y = y;
    <span class="hljs-keyword">this</span>.tile = exports.mapData[x][y];

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.tile.turnOwnerVisible &amp;&amp; <span class="hljs-keyword">this</span>.tile.unit) {
      <span class="hljs-keyword">this</span>.unit = <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">this</span>.unitId = exports.units.indexOf(<span class="hljs-keyword">this</span>.tile.unit);
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.tile.property) {
      <span class="hljs-keyword">this</span>.property = <span class="hljs-keyword">this</span>.tile.property;
      <span class="hljs-keyword">this</span>.propertyId = exports.properties.indexOf(<span class="hljs-keyword">this</span>.tile.property);
    }
  }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>@class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.Tile = my.Class({

  STATIC: {

    fromJSON: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{

    },

    toJSON: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{

    }
  },

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">this</span>.type = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.unit = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.property = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.visionTurnOwner = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.variant = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.visionClient = <span class="hljs-number">0</span>;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>@return {boolean}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  isOccupied: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.unit !== <span class="hljs-literal">null</span>;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>@return {boolean}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  isVisible: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.visionTurnOwner &gt; <span class="hljs-number">0</span>;
  }

});</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>exports.Property = my.Class({

  STATIC: {

    fromJSON: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{

    },

    toJSON: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{

    },

    CAPTURE_POINTS: <span class="hljs-number">20</span>,

    CAPTURE_STEP: <span class="hljs-number">10</span>
  },

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">this</span>.points = <span class="hljs-number">20</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>@type {cwt.Player}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.owner = <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">this</span>.type = <span class="hljs-literal">null</span>;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Returns true, when the given property is neutral, else false.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  isNeutral: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.owner === <span class="hljs-literal">null</span>;
  },

  makeNeutral: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">this</span>.owner = <span class="hljs-literal">null</span>;
  }

});</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Player class which holds all parameters of a army owner.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.Player = my.Class({

  STATIC: {

    fromJSON: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{

    },

    toJSON: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{

    }
  },

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">this</span>.ID = -<span class="hljs-number">1</span>;
    <span class="hljs-keyword">this</span>.reset();
  },

  isPowerActive: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(level)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.activePower === level;
  },

  isInactive: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.team != constants.INACTIVE;
  },

  deactivate: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">this</span>.team = constants.INACTIVE;
  },

  activate: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(teamNumber)</span> </span>{
    <span class="hljs-keyword">this</span>.team = teamNumber;
  },

  reset: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">this</span>.team = constants.INACTIVE;
    <span class="hljs-keyword">this</span>.name = <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">this</span>.coA = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.activePower = constants.INACTIVE;
    <span class="hljs-keyword">this</span>.power = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.powerUsed = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">this</span>.gold = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.manpower = <span class="hljs-built_in">Math</span>.POSITIVE_INFINITY;

    <span class="hljs-keyword">this</span>.numberOfUnits = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.numberOfProperties = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">this</span>.turnOwnerVisible = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.clientVisible = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.clientControlled = <span class="hljs-literal">false</span>;
  }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>@class
@extends cwt.IndexMultiton.<T></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.Unit = my.Class({

  STATIC: {</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Converts HP points to a health value.</p>
<p>@return {number}</p>
<p>@example
   6 HP -&gt; 60 health
   3 HP -&gt; 30 health</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    pointsToHealth: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(pt)</span> </span>{
      <span class="hljs-keyword">return</span> (pt * <span class="hljs-number">10</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Converts and returns the HP points from the health
value of an unit.</p>
<p>@example
  health -&gt;  HP
    69   -&gt;   7
    05   -&gt;   1
    50   -&gt;   6
    99   -&gt;  10</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    healthToPoints: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(health)</span> </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseInt</span>(health / <span class="hljs-number">10</span>, <span class="hljs-number">10</span>) + <span class="hljs-number">1</span>;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Gets the rest of unit health.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    healthToPointsRest: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(health)</span> </span>{
      <span class="hljs-keyword">return</span> health - (<span class="hljs-built_in">parseInt</span>(health / <span class="hljs-number">10</span>) + <span class="hljs-number">1</span>);
    }
  },

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">this</span>.hp = <span class="hljs-number">99</span>;
    <span class="hljs-keyword">this</span>.ammo = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.fuel = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.hidden = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.loadedIn = constants.INACTIVE;
    <span class="hljs-keyword">this</span>.type = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.canAct = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>If the value is null then unit does not exists on the map.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.owner = <span class="hljs-literal">null</span>;
  },

  initByType: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(type)</span> </span>{

  },

  isInactive: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.owner === <span class="hljs-literal">null</span>;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Damages a unit.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  takeDamage: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(damage, minRest)</span> </span>{
    <span class="hljs-keyword">this</span>.hp -= damage;

    <span class="hljs-keyword">if</span> (minRest &amp;&amp; <span class="hljs-keyword">this</span>.hp &lt;= minRest) {
      <span class="hljs-keyword">this</span>.hp = minRest;
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Heals an unit. If the unit health will be greater than the maximum
health value then the difference will be added as gold to the
owners gold depot.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  heal: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(health, diffAsGold)</span> </span>{
    <span class="hljs-keyword">this</span>.hp += health;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.hp &gt; <span class="hljs-number">99</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>pay difference of the result health and 100 as
gold ( in relation to the unit cost ) to the
unit owners gold depot</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (diffAsGold === <span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">var</span> diff = <span class="hljs-keyword">this</span>.hp - <span class="hljs-number">99</span>;
        <span class="hljs-keyword">this</span>.owner.gold += <span class="hljs-built_in">parseInt</span>((<span class="hljs-keyword">this</span>.type.cost * diff) / <span class="hljs-number">100</span>, <span class="hljs-number">10</span>);
      }

      <span class="hljs-keyword">this</span>.hp = <span class="hljs-number">99</span>;
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>@return {boolean} true when hp is greater than 0 else false</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  isAlive: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.hp &gt; <span class="hljs-number">0</span>;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Returns true when the unit ammo is lower equals 25%.</p>
<p>@return {boolean}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  hasLowAmmo: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> cAmmo = <span class="hljs-keyword">this</span>.ammo;
    <span class="hljs-keyword">var</span> mAmmo = <span class="hljs-keyword">this</span>.type.ammo;
    <span class="hljs-keyword">if</span> (mAmmo != <span class="hljs-number">0</span> &amp;&amp; cAmmo &lt;= <span class="hljs-built_in">parseInt</span>(mAmmo * <span class="hljs-number">0.25</span>, <span class="hljs-number">10</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Returns true when the unit fuel is lower equals 25%.</p>
<p>@return {boolean}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  hasLowFuel: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> cFuel = <span class="hljs-keyword">this</span>.fuel;
    <span class="hljs-keyword">var</span> mFuel = <span class="hljs-keyword">this</span>.type.fuel;
    <span class="hljs-keyword">if</span> (cFuel &lt;= <span class="hljs-built_in">parseInt</span>(mFuel * <span class="hljs-number">0.25</span>, <span class="hljs-number">10</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  },

  isCapturing: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.loadedIn != constants.INACTIVE) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-comment">/*
     if( unit.x &gt;= 0 ){
     var property = model.property_posMap[ unit.x ][ unit.y ];
     if( property !== null &amp;&amp; property.capturePoints &lt; 20 ){
     unitStatus.CAPTURES = true;
     }
     else unitStatus.CAPTURES = false;
     } */</span>
  },

  setActable: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> </span>{
    <span class="hljs-keyword">this</span>.canAct = value;
  }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>The active weather type object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.weather = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>The amount of days until the weather will be changed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.weatherLeftDays = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>The current active commanders mode.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.gameMode = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>The current active day.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.day = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>The current active turn owner. Only the turn owner can do actions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.turnOwner = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Maximum turn time limit in ms.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.turnTimeLimit = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Current elapsed turn time in ms.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.turnTimeElapsed = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Maximum game time limit in ms.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.gameTimeLimit = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Current elapsed game time in ms.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.gameTimeElapsed = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>exports.mapWidth = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>exports.mapHeight = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>generate map matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> matrix = <span class="hljs-keyword">new</span> matrix.Matrix(constants.MAX_MAP_WIDTH, constants.MAX_MAP_HEIGHT);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>, xe = constants.MAX_MAP_WIDTH; x &lt; xe; x++) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> y = <span class="hljs-number">0</span>, ye = constants.MAX_MAP_HEIGHT; y &lt; ye; y++) {
    matrix.data[x][y] = <span class="hljs-keyword">new</span> exports.Tile();
  }
}</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>exports.mapData = matrix.data;</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>All player objects of a game round. This buffer holds the maximum amount of possible player objects. Inactive
ones are marked by the inactive marker as team value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.players = createBuffer(exports.Player, constants.MAX_PLAYER);</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>set player id’s</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.players.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(player, i)</span> </span>{
  player.id = i;
});</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>All unit objects of a game round. This buffer holds the maximum amount of possible unit objects. Inactive
ones are marked by no reference in the map and with an owner value <strong>null</strong>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.units = createBuffer(exports.Unit, constants.MAX_PLAYER * constants.MAX_UNITS);</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>All property objects of a game round. This buffer holds the maximum amount of possible property objects. Inactive
ones are marked by no reference in the map.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.properties = createBuffer(exports.Property, constants.MAX_PROPERTIES);</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Returns the distance of two positions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.getDistance = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(sx, sy, tx, ty)</span> </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.DEBUG) assert(exports.isValidPosition(sx, sy));
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.DEBUG) assert(exports.isValidPosition(tx, ty));

  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.abs(sx - tx) + <span class="hljs-built_in">Math</span>.abs(sy - ty);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Returns true if the given position (x,y) is valid on the current
active map, else false.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.isValidPosition = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y)</span> </span>{
  <span class="hljs-keyword">return</span> (x &gt;= <span class="hljs-number">0</span> &amp;&amp; y &gt;= <span class="hljs-number">0</span> &amp;&amp; x &lt; exports.mapWidth &amp;&amp; y &lt; exports.mapHeight);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Returns the <strong>tile</strong> which is occupied by a given <strong>unit</strong>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.grabTileByUnit = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(unit)</span> </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>, xe = exports.mapWidth; x &lt; xe; x++) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> y = <span class="hljs-number">0</span>, ye = exports.mapHeight; y &lt; ye; y++) {
      <span class="hljs-keyword">var</span> tile = exports.mapData[x][y];
      <span class="hljs-keyword">if</span> (tile.unit === unit) {
        <span class="hljs-keyword">return</span> tile;
      }
    }
  }

  assert(<span class="hljs-literal">false</span>, <span class="hljs-string">"given unit seems to be non-existent on the actual map"</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>@param property
@param cb
@param cbThis
@param arg</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.searchProperty = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(property, cb, cbThis, arg)</span> </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>, xe = exports.mapWidth; x &lt; xe; x++) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> y = <span class="hljs-number">0</span>, ye = exports.mapHeight; y &lt; ye; y++) {
      <span class="hljs-keyword">if</span> (exports.mapData[x][y].property === property) {
        cb.call(cbThis, x, y, property, arg);
      }
    }
  }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>@param unit
@param cb
@param cbThis
@param {Object=} arg</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.searchUnit = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(unit, cb, cbThis, arg)</span> </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>, xe = exports.mapWidth; x &lt; xe; x++) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> y = <span class="hljs-number">0</span>, ye = exports.mapHeight; y &lt; ye; y++) {
      <span class="hljs-keyword">if</span> (exports.mapData[x][y].unit === unit) {
        cb.call(cbThis, x, y, unit, arg);
      }
    }
  }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Invokes a callback on all tiles in a given range at a position (x,y).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.doInRange = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y, range, cb, arg)</span> </span>{
  <span class="hljs-keyword">if</span> (constants.DEBUG) {
    assert(<span class="hljs-keyword">this</span>.isValidPosition(x, y));
    assert(<span class="hljs-keyword">typeof</span> cb === <span class="hljs-string">"function"</span>);
    assert(range &gt;= <span class="hljs-number">0</span>);
  }

  <span class="hljs-keyword">var</span> lX;
  <span class="hljs-keyword">var</span> hX;
  <span class="hljs-keyword">var</span> lY = y - range;
  <span class="hljs-keyword">var</span> hY = y + range;
  <span class="hljs-keyword">if</span> (lY &lt; <span class="hljs-number">0</span>) lY = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (hY &gt;= exports.mapHeight) hY = exports.mapHeight - <span class="hljs-number">1</span>;
  <span class="hljs-keyword">for</span> (; lY &lt;= hY; lY++) {

    <span class="hljs-keyword">var</span> disY = <span class="hljs-built_in">Math</span>.abs(lY - y);
    lX = x - range + disY;
    hX = x + range - disY;
    <span class="hljs-keyword">if</span> (lX &lt; <span class="hljs-number">0</span>) lX = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (hX &gt;= exports.mapWidth) hX = exports.mapWidth - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">for</span> (; lX &lt;= hX; lX++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>invoke the callback on all tiles in range
if a callback returns <code>false</code> then the process will be stopped</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (cb(lX, lY, exports.mapData[lX][lY], arg, <span class="hljs-built_in">Math</span>.abs(lX - x) + disY) === <span class="hljs-literal">false</span>) <span class="hljs-keyword">return</span>;

    }
  }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Returns <code>true</code> when at least two opposite teams are left, else <code>false</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.areEnemyTeamsLeft = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">var</span> player;
  <span class="hljs-keyword">var</span> foundTeam = -<span class="hljs-number">1</span>;
  <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> e = constants.MAX_PLAYER;

  <span class="hljs-keyword">for</span> (; i &lt; e; i++) {
    player = <span class="hljs-keyword">this</span>.players[i];

    <span class="hljs-keyword">if</span> (player.team !== -<span class="hljs-number">1</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>found alive player</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (foundTeam === -<span class="hljs-number">1</span>) foundTeam = player.team;
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (foundTeam !== player.team) {
        foundTeam = -<span class="hljs-number">1</span>;
        <span class="hljs-keyword">break</span>;
      }
    }
  }

  <span class="hljs-keyword">return</span> (foundTeam === -<span class="hljs-number">1</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Returns true if the given player id is the current turn owner.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.isTurnOwner = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(player)</span> </span>{
  <span class="hljs-keyword">return</span> exports.turnOwner === player;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Converts a number of days into turns.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.convertDaysToTurns = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(days)</span> </span>{
  <span class="hljs-keyword">return</span> constants.MAX_PLAYER * days;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Returns <code>true</code> when the game is in the peace phase.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.inPeacePhase = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> (exports.day &lt; daysOfPeaceCfg.value);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>@param {cwt.Unit|cwt.Property|null} obj
@return {boolean}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.isTurnOwnerObject = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj)</span> </span>{
  <span class="hljs-keyword">return</span> (obj != <span class="hljs-literal">null</span> &amp;&amp; obj.owner === exports.turnOwner);
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
