<!DOCTYPE html>

<html>
<head>
  <title>savegame.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="audio.html">
                audio.js
              </a>
            
              
              <a class="source" href="config.html">
                config.js
              </a>
            
              
              <a class="source" href="image.html">
                image.js
              </a>
            
              
              <a class="source" href="keyMapping.html">
                keyMapping.js
              </a>
            
              
              <a class="source" href="maps.html">
                maps.js
              </a>
            
              
              <a class="source" href="mod.html">
                mod.js
              </a>
            
              
              <a class="source" href="roundSetup.html">
                roundSetup.js
              </a>
            
              
              <a class="source" href="savegame.html">
                savegame.js
              </a>
            
              
              <a class="source" href="states.html">
                states.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>savegame.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">"use strict"</span>;

<span class="hljs-keyword">var</span> storage = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../storage"</span>);
<span class="hljs-keyword">var</span> model = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../model"</span>);

exports.save = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name, cb)</span> </span>{
  <span class="hljs-keyword">var</span> saveData = {};

  saveData.mpw = <span class="hljs-keyword">this</span>.width;
  saveData.mph = <span class="hljs-keyword">this</span>.height;
  saveData.map = [];
  saveData.prps = [];
  saveData.units = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>generates ID map</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> mostIdsMap = {};
  <span class="hljs-keyword">var</span> mostIdsMapCurIndex = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>, xe = model.mapWidth; x &lt; xe; x++) {

    saveData.map[x] = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> y = <span class="hljs-number">0</span>, ye = model.mapHeight; y &lt; ye; y++) {
      <span class="hljs-keyword">var</span> type = model.mapData[x][y].type.ID;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>create number for type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!mostIdsMap.hasOwnProperty(type)) {
        mostIdsMap[type] = mostIdsMapCurIndex;
        mostIdsMapCurIndex++;
      }

      saveData.map[x][y] = mostIdsMap[type];</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>save property</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> prop = model.mapData[x][y].property;
      <span class="hljs-keyword">if</span> (prop) {
        saveData.prps.push([
          cwt.Model.properties.indexOf(prop),
          x,
          y,
          prop.type.ID,
          prop.capturePoints,
          prop.owner.id
        ]);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>save unit</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> unit = model.mapData[x][y].unit;
      <span class="hljs-keyword">if</span> (unit) {
        saveData.units.push([
          cwt.Model.units.indexOf(unit),
          unit.type.ID,
          x,
          y,
          unit.hp,
          unit.ammo,
          unit.fuel,
          unit.loadedIn,
          unit.owner.id,
          unit.canAct,
          unit.hidden
        ]);
      }
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>generate type map</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  saveData.typeMap = [];
  <span class="hljs-keyword">var</span> typeKeys = <span class="hljs-built_in">Object</span>.keys(mostIdsMap);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = typeKeys.length; i &lt; e; i++) {
    saveData.typeMap[mostIdsMap[typeKeys[i]]] = typeKeys[i];
  }

  saveData.wth = <span class="hljs-keyword">this</span>.weather.ID;
  saveData.trOw = <span class="hljs-keyword">this</span>.turnOwner.id;
  saveData.day = <span class="hljs-keyword">this</span>.day;
  saveData.gmTm = <span class="hljs-keyword">this</span>.gameTimeElapsed;
  saveData.tnTm = <span class="hljs-keyword">this</span>.turnTimeElapsed;

  saveData.cfg = {};
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = <span class="hljs-keyword">this</span>.MULTITON_NAMES.length; i &lt; e; i++) {
    <span class="hljs-keyword">var</span> key = <span class="hljs-keyword">this</span>.MULTITON_NAMES[i];
    saveData.cfg[key] = cwt.Config.getValue(key);
  }

  storage.set(name, <span class="hljs-built_in">JSON</span>.stringify(saveData), cb);
};

exports.load = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name, isSave, callback)</span> </span>{
<span class="hljs-pi">  "use strict"</span>;

  <span class="hljs-keyword">var</span> gameData = <span class="hljs-literal">null</span>;

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> name === <span class="hljs-string">"string"</span>) {
    storage.get(name, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj)</span> </span>{
      cwt.assert(obj.value);
      caller(<span class="hljs-built_in">JSON</span>.parse(obj.value), isSave);
      callback();
    });
  } <span class="hljs-keyword">else</span> {
    gameData = <span class="hljs-literal">null</span>;
    callback();
  }

  <span class="hljs-keyword">var</span> model = cwt.Model;
  <span class="hljs-keyword">var</span> property;
  <span class="hljs-keyword">var</span> unit;
  <span class="hljs-keyword">var</span> player;

  model.mapWidth = gameData.mpw;
  model.mapHeight = gameData.mph;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>map</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>, xe = data.width; x &lt; xe; x++) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> y = <span class="hljs-number">0</span>, ye = that.height; y &lt; ye; y++) {
      that.data[x][y].type = cwt.DataSheets.tiles.sheets[data.typeMap[data.map[x][y]]];
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>prepare properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = cwt.MAX_PROPERTIES; i &lt; e; i++) {
    property = cwt.Model.properties[i];
    <span class="hljs-keyword">if</span> (property) {
      property.owner = <span class="hljs-literal">null</span>;
      property.type = <span class="hljs-literal">null</span>;
      property.capturePoints = <span class="hljs-number">20</span>;
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>saved properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  cwt.assert(<span class="hljs-built_in">Array</span>.isArray(data.prps));
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = data.prps.length; i &lt; e; i++) {
    <span class="hljs-keyword">var</span> propData = data.prps[i];</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>check_ map data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    cwt.assert(propData[<span class="hljs-number">0</span>] &gt;= <span class="hljs-number">0</span> &amp;&amp; propData[<span class="hljs-number">0</span>] &lt; cwt.Property.MULTITON_INSTANCES);
    cwt.assert(propData[<span class="hljs-number">1</span>] &gt;= <span class="hljs-number">0</span> &amp;&amp; propData[<span class="hljs-number">1</span>] &lt; that.width);
    cwt.assert(propData[<span class="hljs-number">2</span>] &gt;= <span class="hljs-number">0</span> &amp;&amp; propData[<span class="hljs-number">2</span>] &lt; that.height);
    cwt.assert(cwt.PropertySheet.sheets.hasOwnProperty(propData[<span class="hljs-number">3</span>]));
    cwt.assert(propData[<span class="hljs-number">5</span>] &gt;= -<span class="hljs-number">1</span> &amp;&amp; propData[<span class="hljs-number">5</span>] &lt; cwt.Player.MULTITON_INSTANCES);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>cwt.assert(
 (util.isString(propData[3]) &amp;&amp; !util.isUndefined(model.data_tileSheets[propData[3]].capturePoints)) ||
   typeof model.data_tileSheets[propData[3]].cannon !== “undefined” ||
   typeof model.data_tileSheets[propData[3]].laser !== “undefined” ||
   typeof model.data_tileSheets[propData[3]].rocketsilo !== “undefined”
);</p>

            </div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>cwt.assert((util.intRange(propData[4], 1, // capture points
 model.data_tileSheets[propData[3]].capturePoints)) ||
(util.intRange(propData[4], -99, -1)) ||
 typeof model.data_tileSheets[propData[3]].rocketsilo !== “undefined”
);</p>

            </div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>copy data into model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    property = cwt.Property.getInstance(propData[<span class="hljs-number">0</span>]);
    property.type = cwt.PropertySheet.sheets[propData[<span class="hljs-number">3</span>]];
    property.capturePoints = propData[<span class="hljs-number">4</span>];
    property.owner = (propData[<span class="hljs-number">5</span>] != cwt.INACTIVE) ? cwt.Player.getInstance(propData[<span class="hljs-number">5</span>]) : <span class="hljs-literal">null</span>;
    that.data[propData[<span class="hljs-number">1</span>]][propData[<span class="hljs-number">2</span>]].property = property;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>prepare units</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  cwt.assert(<span class="hljs-built_in">Array</span>.isArray(data.units));
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = cwt.Unit.MULTITON_INSTANCES; i &lt; e; i++) {
    unit = cwt.Unit.getInstance(i, <span class="hljs-literal">true</span>);
    <span class="hljs-keyword">if</span> (unit) {
      unit.owner = <span class="hljs-literal">null</span>;
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>saved units</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = data.units.length; i &lt; e; i++) {
    <span class="hljs-keyword">var</span> unitData = data.units[i];</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>check_ map data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    cwt.assert(unitData[<span class="hljs-number">0</span>] &gt;= <span class="hljs-number">0</span> &amp;&amp; unitData[<span class="hljs-number">0</span>] &lt; cwt.Unit.MULTITON_INSTANCES);
    cwt.assert(cwt.UnitSheet.sheets.hasOwnProperty(unitData[<span class="hljs-number">1</span>]));
    cwt.assert(that.isValidPosition(unitData[<span class="hljs-number">2</span>], unitData[<span class="hljs-number">3</span>]));
    cwt.assert(unitData[<span class="hljs-number">4</span>] &gt;= <span class="hljs-number">1</span> &amp;&amp; unitData[<span class="hljs-number">4</span>] &lt;= <span class="hljs-number">99</span>);

    <span class="hljs-keyword">var</span> type = cwt.UnitSheet.sheets[unitData[<span class="hljs-number">1</span>]];
    cwt.assert(unitData[<span class="hljs-number">5</span>] &gt;= <span class="hljs-number">0</span> &amp;&amp; unitData[<span class="hljs-number">5</span>] &lt;= type.ammo);
    cwt.assert(unitData[<span class="hljs-number">6</span>] &gt;= <span class="hljs-number">0</span> &amp;&amp; unitData[<span class="hljs-number">6</span>] &lt;= type.fuel);
    cwt.assert(<span class="hljs-keyword">typeof</span> unitData[<span class="hljs-number">7</span>] === <span class="hljs-string">"number"</span>);
    cwt.assert(unitData[<span class="hljs-number">8</span>] &gt;= -<span class="hljs-number">1</span> &amp;&amp; unitData[<span class="hljs-number">8</span>] &lt; cwt.Player.MULTITON_INSTANCES);
    cwt.assert(unitData.length &lt; <span class="hljs-number">10</span> || <span class="hljs-keyword">typeof</span> unitData[<span class="hljs-number">9</span>] === <span class="hljs-string">"boolean"</span>);
    cwt.assert(unitData.length &lt; <span class="hljs-number">11</span> || <span class="hljs-keyword">typeof</span> unitData[<span class="hljs-number">10</span>] === <span class="hljs-string">"boolean"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>copy data into model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    unit = cwt.Unit.getInstance(unitData[<span class="hljs-number">0</span>]);
    unit.type = type;
    unit.hp = unitData[<span class="hljs-number">4</span>];
    unit.ammo = unitData[<span class="hljs-number">5</span>];
    unit.fuel = unitData[<span class="hljs-number">6</span>];
    unit.loadedIn = (unitData[<span class="hljs-number">7</span>] != cwt.INACTIVE) ? cwt.Unit.getInstance(unitData[<span class="hljs-number">7</span>]) : <span class="hljs-literal">null</span>;
    unit.owner = cwt.Player.getInstance(unitData[<span class="hljs-number">8</span>]);
    unit.canAct = (<span class="hljs-keyword">typeof</span> unitData[<span class="hljs-number">9</span>] === <span class="hljs-string">"boolean"</span>) ? unitData[<span class="hljs-number">9</span>] : <span class="hljs-literal">false</span>;
    unit.hidden = (<span class="hljs-keyword">typeof</span> unitData[<span class="hljs-number">10</span>] === <span class="hljs-string">"boolean"</span>) ? unitData[<span class="hljs-number">10</span>] : <span class="hljs-literal">false</span>;
    that.data[unitData[<span class="hljs-number">2</span>]][unitData[<span class="hljs-number">3</span>]].unit = unit;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>reset player data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = cwt.Player.MULTITON_INSTANCES; i &lt; e; i++) {
    <span class="hljs-keyword">var</span> player = cwt.Player.getInstance(i);
    player.name = <span class="hljs-literal">null</span>;
    player.gold = <span class="hljs-number">0</span>;
    player.manpower = <span class="hljs-built_in">Math</span>.POSITIVE_INFINITY;
    player.team = (i &lt;= data.player - <span class="hljs-number">1</span>) ? i : cwt.NOT_AVAILABLE;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>grab save game data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (isSave) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = data.players.length; i &lt; e; i++) {
      <span class="hljs-keyword">var</span> playerData = data.players[i];</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>check_ data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      cwt.assert(playerData[<span class="hljs-number">0</span>] &gt;= <span class="hljs-number">0</span> &amp;&amp; playerData[<span class="hljs-number">0</span>] &lt; cwt.Player.MULTITON_INSTANCES);
      cwt.assert(<span class="hljs-keyword">typeof</span> playerData[<span class="hljs-number">1</span>] === <span class="hljs-string">"string"</span>);
      cwt.assert(playerData[<span class="hljs-number">3</span>] &gt;= <span class="hljs-number">0</span> &amp;&amp; playerData[<span class="hljs-number">3</span>] &lt; cwt.Player.MULTITON_INSTANCES);
      cwt.assert(playerData[<span class="hljs-number">2</span>] &gt;= <span class="hljs-number">0</span> &amp;&amp; playerData[<span class="hljs-number">2</span>] &lt; <span class="hljs-number">999999</span>);
      cwt.assert(playerData[<span class="hljs-number">4</span>] &gt;= <span class="hljs-number">0</span> &amp;&amp; playerData[<span class="hljs-number">4</span>] &lt; <span class="hljs-number">999999</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>set player data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> player = cwt.Player.getInstance(playerData[<span class="hljs-number">0</span>]);
      player.name = playerData[<span class="hljs-number">1</span>];
      player.gold = playerData[<span class="hljs-number">2</span>];
      player.team = playerData[<span class="hljs-number">3</span>];
      player.manpower = playerData[<span class="hljs-number">4</span>];
    }
  }
  <span class="hljs-keyword">this</span>.weather = cwt.WeatherSheet.defaultWeather;
  <span class="hljs-keyword">this</span>.turnOwner = cwt.Player.getInstance(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">this</span>.day = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">if</span> (isSave) {
    cwt.assert(cwt.WeatherSheet.sheets.hasOwnProperty(data.wth));
    cwt.assert(data.trOw &gt;= <span class="hljs-number">0</span> &amp;&amp; data.trOw &lt; <span class="hljs-number">9999999</span>);
    cwt.assert(data.day &gt;= <span class="hljs-number">0</span> &amp;&amp; data.day &lt; <span class="hljs-number">9999999</span>);
    cwt.assert(data.gmTm &gt;= <span class="hljs-number">0</span>);
    cwt.assert(data.tnTm &gt;= <span class="hljs-number">0</span>);

    <span class="hljs-keyword">this</span>.weather = cwt.WeatherSheet.sheets[data.wth];
    <span class="hljs-keyword">this</span>.turnOwner = cwt.Player.getInstance(data.trOw);
    <span class="hljs-keyword">this</span>.day = data.day;
    <span class="hljs-keyword">this</span>.gameTimeElapsed = data.gmTm;
    <span class="hljs-keyword">this</span>.turnTimeElapsed = data.tnTm;
  }

  cwt.Config.resetAll();
  <span class="hljs-keyword">if</span> (isSave &amp;&amp; data.cfg) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, e = <span class="hljs-keyword">this</span>.MULTITON_NAMES.length; i &lt; e; i++) {
      <span class="hljs-keyword">var</span> key = <span class="hljs-keyword">this</span>.MULTITON_NAMES[i];
      <span class="hljs-keyword">if</span> (data.cfg[key]) {
        cwt.Config.getConfig(key).setValue(data.cfg[key]);
      }
    }
  }
};


<span class="hljs-comment">/*


 (function () {

 function placeCannonMetaData(x, y) {
 var prop = model.property_posMap[x][y];
 var cannon = prop.type.cannon;
 var size = prop.type.bigProperty;

 cwt.assert(x - size.x &gt;= 0);
 cwt.assert(y - size.y &gt;= 0);

 var ax = x - size.actor[0];
 var ay = y - size.actor[1];
 var ox = x;
 var oy = y;
 for (var xe = x - size.x; x &gt; xe; x--) {

 y = oy;
 for (var ye = y - size.y; y &gt; ye; y--) {

</span></pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>place blocker</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-keyword">if</span> (x !== ox || y !== oy) {
 <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.DEBUG) util.log(<span class="hljs-string">"creating invisible property at"</span>, x, <span class="hljs-string">","</span>, y);
 model.events.property_createProperty(prop.owner, x, y, <span class="hljs-string">"PROP_INV"</span>);
 }</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>place actor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-keyword">if</span> (x === ax &amp;&amp; y === ay) {
 <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.DEBUG) util.log(<span class="hljs-string">"creating cannon unit at"</span>, x, <span class="hljs-string">","</span>, y);
 model.events.createUnit(model.unit_getFreeSlot(prop.owner), prop.owner,
 x, y, <span class="hljs-string">"CANNON_UNIT_INV"</span>);
 }

 }
 }
 }</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>// Places the necessary meta units for bigger properties.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre> model.event_on(<span class="hljs-string">"gameround_start"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
 <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span>, xe = model.map_width; x &lt; xe; x++) {
 <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> y = <span class="hljs-number">0</span>, ye = model.map_height; y &lt; ye; y++) {

 <span class="hljs-keyword">var</span> prop = model.property_posMap[x][y];
 <span class="hljs-keyword">if</span> (prop) {

 <span class="hljs-keyword">if</span> (prop.type.bigProperty &amp;&amp; prop.type.cannon) {
 placeCannonMetaData(x, y);
 } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (prop.type.cannon) {
 <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.DEBUG) util.log(<span class="hljs-string">"creating cannon unit at"</span>, x, <span class="hljs-string">","</span>, y);
 model.events.createUnit(model.unit_getFreeSlot(prop.owner), prop.owner,
 x, y, <span class="hljs-string">"CANNON_UNIT_INV"</span>);
 } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (prop.type.laser) {
 <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.DEBUG) util.log(<span class="hljs-string">"creating laser unit at"</span>, x, <span class="hljs-string">","</span>, y);
 model.events.createUnit(model.unit_getFreeSlot(prop.owner), prop.owner,
 x, y, <span class="hljs-string">"LASER_UNIT_INV"</span>);
 }

 }
 }
 }
 });

 })();</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>*/</p>

            </div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
