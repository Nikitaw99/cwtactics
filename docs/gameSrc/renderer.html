<!DOCTYPE html>

<html>
<head>
  <title>renderer.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="actions.html">
                actions.js
              </a>
            
              
              <a class="source" href="ai.html">
                ai.js
              </a>
            
              
              <a class="source" href="async.html">
                async.js
              </a>
            
              
              <a class="source" href="audio.html">
                audio.js
              </a>
            
              
              <a class="source" href="circularBuffer.html">
                circularBuffer.js
              </a>
            
              
              <a class="source" href="config.html">
                config.js
              </a>
            
              
              <a class="source" href="constants.html">
                constants.js
              </a>
            
              
              <a class="source" href="cwScript.html">
                cwScript.js
              </a>
            
              
              <a class="source" href="error.html">
                error.js
              </a>
            
              
              <a class="source" href="events.html">
                events.js
              </a>
            
              
              <a class="source" href="functions.html">
                functions.js
              </a>
            
              
              <a class="source" href="image.html">
                image.js
              </a>
            
              
              <a class="source" href="input.html">
                input.js
              </a>
            
              
              <a class="source" href="loading.html">
                loading.js
              </a>
            
              
              <a class="source" href="localization.html">
                localization.js
              </a>
            
              
              <a class="source" href="main.html">
                main.js
              </a>
            
              
              <a class="source" href="matrix.html">
                matrix.js
              </a>
            
              
              <a class="source" href="model.html">
                model.js
              </a>
            
              
              <a class="source" href="network.html">
                network.js
              </a>
            
              
              <a class="source" href="renderer.html">
                renderer.js
              </a>
            
              
              <a class="source" href="sheets.html">
                sheets.js
              </a>
            
              
              <a class="source" href="statemachine.html">
                statemachine.js
              </a>
            
              
              <a class="source" href="storage.html">
                storage.js
              </a>
            
              
              <a class="source" href="systemFeatures.html">
                systemFeatures.js
              </a>
            
              
              <a class="source" href="tileVariants.html">
                tileVariants.js
              </a>
            
              
              <a class="source" href="uiWidgets.html">
                uiWidgets.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>renderer.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">"use strict"</span>;

<span class="hljs-keyword">var</span> constants = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./constants"</span>);

<span class="hljs-keyword">var</span> canvasW = constants.TILE_BASE * constants.SCREEN_WIDTH;
<span class="hljs-keyword">var</span> canvasH = constants.TILE_BASE * constants.SCREEN_HEIGHT;

<span class="hljs-keyword">var</span> rendCursor = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./renderer/cursor"</span>);
<span class="hljs-keyword">var</span> rendAnim = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./renderer/animation"</span>);
<span class="hljs-keyword">var</span> rendUnit = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./renderer/unit"</span>);
<span class="hljs-keyword">var</span> rendMenu = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./renderer/menu"</span>);
<span class="hljs-keyword">var</span> rendFog = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./renderer/fog"</span>);

<span class="hljs-keyword">var</span> stateData = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./dataTransfer/states"</span>);
<span class="hljs-keyword">var</span> assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./functions"</span>).assert;
<span class="hljs-keyword">var</span> model = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./model"</span>);
<span class="hljs-keyword">var</span> move = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./logic/move"</span>);

rendFog.init(canvasW, canvasH);
rendUnit.init(canvasW, canvasH);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>@class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.LayeredCanvas = my.Class({
  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(canvasId, frames, w, h)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>root canvas</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.cv = <span class="hljs-built_in">document</span>.getElementById(canvasId);
    <span class="hljs-keyword">this</span>.cv.width = w;
    <span class="hljs-keyword">this</span>.cv.height = h;
    <span class="hljs-keyword">this</span>.ctx = <span class="hljs-keyword">this</span>.cv.getContext(<span class="hljs-string">"2d"</span>);
    <span class="hljs-keyword">this</span>.w = w;
    <span class="hljs-keyword">this</span>.h = h;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>cached layers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (frames &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">this</span>.contexts = [];
      <span class="hljs-keyword">this</span>.layers = [];

      <span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">while</span> (n &lt; frames) {
        <span class="hljs-keyword">var</span> cv = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"canvas"</span>);

        cv.width = w;
        cv.height = h;

        <span class="hljs-keyword">this</span>.contexts[n] = cv.getContext(<span class="hljs-string">"2d"</span>);
        <span class="hljs-keyword">this</span>.layers[n] = cv;

        n++;
      }
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>@param {Number} index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  renderLayer: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index)</span> </span>{
    <span class="hljs-keyword">if</span> (constants.DEBUG) assert(<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">0</span> || (index &gt;= <span class="hljs-number">0</span> &amp;&amp; index &lt; <span class="hljs-keyword">this</span>.layers.length));

    <span class="hljs-keyword">var</span> ctx = <span class="hljs-keyword">this</span>.getContext(constants.INACTIVE);
    ctx.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.w, <span class="hljs-keyword">this</span>.h);
    ctx.drawImage(<span class="hljs-keyword">this</span>.getLayer(index), <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.w, <span class="hljs-keyword">this</span>.h);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>@param {Number?} index
@return {HTMLCanvasElement}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getLayer: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index)</span> </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">0</span>) index = constants.INACTIVE;

    <span class="hljs-keyword">if</span> (constants.DEBUG) assert(index === constants.INACTIVE || (index &gt;= <span class="hljs-number">0</span> &amp;&amp; index &lt; <span class="hljs-keyword">this</span>.layers.length));</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>root ?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (index === constants.INACTIVE) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.cv;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.layers[index];
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>@param {Number?} index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  clear: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index)</span> </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">0</span>) index = constants.INACTIVE;

    <span class="hljs-keyword">this</span>.getContext(index).clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.w, <span class="hljs-keyword">this</span>.h);
  },

  clearAll: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> n = <span class="hljs-keyword">this</span>.layers.length - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">while</span> (n &gt;= <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">this</span>.clear(n);
      n--;
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>@param {Number?} index
@return {CanvasRenderingContext2D}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getContext: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index)</span> </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">0</span>) index = constants.INACTIVE;

    <span class="hljs-keyword">if</span> (constants.DEBUG) assert(index === constants.INACTIVE || (index &gt;= <span class="hljs-number">0</span> &amp;&amp; index &lt; <span class="hljs-keyword">this</span>.layers.length));</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>root ?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (index === constants.INACTIVE) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.ctx;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.contexts[index];
  }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>@class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.PaginationObject = my.Class({

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(list, pageSize, updateFn)</span> </span>{
    <span class="hljs-keyword">this</span>.page = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.list = list;

    <span class="hljs-keyword">this</span>.entries = [];
    <span class="hljs-keyword">while</span> (pageSize &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">this</span>.entries.push(<span class="hljs-literal">null</span>);
      pageSize--;
    }

    <span class="hljs-keyword">this</span>.updateFn = updateFn;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Selects a page from the list. The entries of the selected page will be saved in the <strong>entries</strong> property
of the pagination object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  selectPage: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index)</span> </span>{
    <span class="hljs-keyword">var</span> PAGE_SIZE = <span class="hljs-keyword">this</span>.entries.length;

    <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-number">0</span> || index * PAGE_SIZE &gt;= <span class="hljs-keyword">this</span>.list.length) {
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">this</span>.page = index;

    index = (index * PAGE_SIZE);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span>; n &lt; PAGE_SIZE; n++) {
      <span class="hljs-keyword">this</span>.entries[n] = (index + n &gt;= <span class="hljs-keyword">this</span>.list.length) ? <span class="hljs-literal">null</span> : <span class="hljs-keyword">this</span>.list[index + n];
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.updateFn) {
      <span class="hljs-keyword">this</span>.updateFn();
    }
  }

});

exports.screenWidth = canvasW;

exports.screenHeight = canvasH;

exports.screenOffsetX = <span class="hljs-number">0</span>;

exports.screenOffsetY = <span class="hljs-number">0</span>;

exports.convertToTilePos = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(p)</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseInt</span>(p / constants.TILE_BASE, <span class="hljs-number">10</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>@type {cwt.LayeredCanvas}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.layerBG = <span class="hljs-keyword">new</span> exports.LayeredCanvas(<span class="hljs-string">"canvas_layer1"</span>, <span class="hljs-number">1</span>, canvasW, canvasH);</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>@type {cwt.LayeredCanvas}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.layerMap = <span class="hljs-keyword">new</span> exports.LayeredCanvas(<span class="hljs-string">"canvas_layer2"</span>, <span class="hljs-number">8</span>, canvasW, canvasH);</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>@type {cwt.LayeredCanvas}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.layerFog = <span class="hljs-keyword">new</span> exports.LayeredCanvas(<span class="hljs-string">"canvas_layer3"</span>, <span class="hljs-number">1</span>, canvasW, canvasH);</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>@type {cwt.LayeredCanvas}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.layerUnit = <span class="hljs-keyword">new</span> exports.LayeredCanvas(<span class="hljs-string">"canvas_layer4"</span>, <span class="hljs-number">3</span>, canvasW, canvasH);</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>@type {cwt.LayeredCanvas}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.layerEffects = <span class="hljs-keyword">new</span> exports.LayeredCanvas(<span class="hljs-string">"canvas_layer5"</span>, <span class="hljs-number">1</span>, canvasW, canvasH);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>@type {cwt.LayeredCanvas}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.layerUI = <span class="hljs-keyword">new</span> exports.LayeredCanvas(<span class="hljs-string">"canvas_layer6"</span>, <span class="hljs-number">1</span>, canvasW, canvasH);</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>@param moveCode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.shiftScreen = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(moveCode)</span> </span>{
  <span class="hljs-keyword">var</span> changed = <span class="hljs-literal">false</span>;

  <span class="hljs-keyword">switch</span> (moveCode) {
    <span class="hljs-keyword">case</span> move.MOVE_CODES_UP:
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.offsetY &lt; model.mapHeight - constants.SCREEN_HEIGHT - <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">this</span>.offsetY++;
        changed = <span class="hljs-literal">true</span>;
      }
      <span class="hljs-keyword">break</span>;

    <span class="hljs-keyword">case</span> move.MOVE_CODES_RIGHT:
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.offsetX &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">this</span>.offsetX--;
        changed = <span class="hljs-literal">true</span>;
      }
      <span class="hljs-keyword">break</span>;

    <span class="hljs-keyword">case</span> move.MOVE_CODES_DOWN:
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.offsetY &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">this</span>.offsetY--;
        changed = <span class="hljs-literal">true</span>;
      }
      <span class="hljs-keyword">break</span>;

    <span class="hljs-keyword">case</span> move.MOVE_CODES_LEFT:
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.offsetX &lt; model.mapWidth - constants.SCREEN_WIDTH - <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">this</span>.offsetX++;
        changed = <span class="hljs-literal">true</span>;
      }
      <span class="hljs-keyword">break</span>;
  }

  <span class="hljs-keyword">return</span> changed;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>exports.renderScreen = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">var</span> time;
  <span class="hljs-keyword">if</span> (constants.DEBUG) time = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()).getTime();

  <span class="hljs-keyword">var</span> x = exports.screenOffsetX;
  <span class="hljs-keyword">var</span> y = exports.screenOffsetY;
  <span class="hljs-keyword">var</span> w = (model.mapWidth &lt; constants.SCREEN_WIDTH) ? model.mapWidth : constants.SCREEN_WIDTH;
  <span class="hljs-keyword">var</span> h = (model.mapHeight &lt; constants.SCREEN_HEIGHT) ? model.mapHeight : constants.SCREEN_HEIGHT;

  <span class="hljs-keyword">this</span>.renderTiles(x, y, w, h);
  <span class="hljs-keyword">this</span>.renderUnits(x, y, w, h);</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>directly update all layers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  exports.layerMap.renderLayer(rendAnim.indexMapAnimation);
  exports.layerUnit.renderLayer(rendAnim.indexUnitAnimation);

  <span class="hljs-keyword">this</span>.renderFogRect(x, y, w, h);

  <span class="hljs-keyword">if</span> (constants.DEBUG) <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"rendered the complete screen ("</span> + ((<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()).getTime() - time) + <span class="hljs-string">"ms)"</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>@param {number} code</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.shiftMap = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(code)</span> </span>{
  <span class="hljs-keyword">var</span> time;
  <span class="hljs-keyword">if</span> (constants.DEBUG) time = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()).getTime();

  <span class="hljs-keyword">var</span> fx = exports.screenOffsetX;
  <span class="hljs-keyword">var</span> fy = exports.screenOffsetY;
  <span class="hljs-keyword">var</span> fw = constants.SCREEN_WIDTH;
  <span class="hljs-keyword">var</span> fh = constants.SCREEN_HEIGHT;</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>extract needed data for the shift process</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">switch</span> (code) {
    <span class="hljs-keyword">case</span> move.MOVE_CODES_LEFT:
      fx += constants.SCREEN_WIDTH - <span class="hljs-number">1</span>;
      fw = <span class="hljs-number">1</span>;
      <span class="hljs-keyword">break</span>;

    <span class="hljs-keyword">case</span> move.MOVE_CODES_RIGHT:
      fw = <span class="hljs-number">1</span>;
      <span class="hljs-keyword">break</span>;

    <span class="hljs-keyword">case</span> move.MOVE_CODES_UP:
      fy += constants.SCREEN_HEIGHT - <span class="hljs-number">1</span>;
      fh = <span class="hljs-number">1</span>;
      <span class="hljs-keyword">break</span>;

    <span class="hljs-keyword">case</span> move.MOVE_CODES_DOWN:
      fh = <span class="hljs-number">1</span>;
      <span class="hljs-keyword">break</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>shift screen</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">this</span>.shiftTiles(code);
  <span class="hljs-keyword">this</span>.shiftUnits(code);
  <span class="hljs-keyword">this</span>.shiftFog(code);</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>fill created hole</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">this</span>.renderTiles(fx, fy, fw, fh);
  <span class="hljs-keyword">this</span>.renderUnits(fx, fy, fw, fh);
  <span class="hljs-keyword">this</span>.renderFogRect(fx, fy, fw, fh);</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>fix overlay when screen moves down</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (code === move.MOVE_CODES_DOWN) {
    <span class="hljs-keyword">this</span>.renderTileOverlayRow();
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>directly update all layers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  exports.layerMap.renderLayer(rendAnim.indexMapAnimation);
  exports.layerUnit.renderLayer(rendAnim.indexUnitAnimation);

  <span class="hljs-keyword">if</span> (constants.DEBUG) <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"shifted the screen ("</span> + ((<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()).getTime() - time) + <span class="hljs-string">"ms)"</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Renders the cursor to the UI layer.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.eraseCursor = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
  rendCursor.eraseCursor(
    exports.layerUI,
    exports.screenOffsetX, exports.screenOffsetY,
    stateData.cursorX, stateData.cursorY
  );
};</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Renders the cursor to the UI layer.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.renderCursor = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
  rendCursor.renderCursor(
    exports.layerUI,
    exports.screenOffsetX, exports.screenOffsetY,
    stateData.cursorX, stateData.cursorY
  );
};</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Shows the native browser cursor.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.showNativeCursor = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
  rendCursor.showNativeCursor(exports.layerUI);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Hides the native browser cursor.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>exports.hideNativeCursor = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
  rendCursor.hideNativeCursor(exports.layerUI);
};

exports.renderCycle = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(delta)</span> </span>{
  rendAnim.evaluateCycle(delta, exports.layerUnit, exports.layerMap);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>exports.renderFogCircle = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y, range)</span> </span>{
  rendFog.renderFogRect(exports.layerFog, exports.screenOffsetX, exports.screenOffsetY, x, y, range);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>exports.renderFogRect = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, y, w, h, circle)</span> </span>{
  rendFog.renderFogRect(exports.layerFog, exports.screenOffsetX, exports.screenOffsetY, x, y, w, h, circle);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>exports.renderFogBackgroundLayer = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
  rendFog.renderFogBackgroundLayer(exports.layerFog);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>exports.shiftFog = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(code)</span> </span>{
  rendFog.shiftFog(exports.layerFog, code);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>exports.renderUnits = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(x, oy, w, h)</span> </span>{
  rendUnit.renderUnits(exports.layerFog, exports.screenOffsetX, exports.screenOffsetY, x, oy, w, h);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>exports.shiftUnits = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(code)</span> </span>{
  rendUnit.shiftUnits(exports.layerUnit, code);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>exports.prepareMenu = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(menu)</span> </span>{
  rendMenu.prepareMenu(exports.layerUI, exports.screenWidth, exports.screenHeight, menu);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>exports.renderMenu = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
  rendMenu.renderMenu(exports.layerUI);
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
