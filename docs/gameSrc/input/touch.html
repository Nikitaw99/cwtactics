<!DOCTYPE html>

<html>
<head>
  <title>touch.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="gamepad.html">
                gamepad.js
              </a>
            
              
              <a class="source" href="keyboard.html">
                keyboard.js
              </a>
            
              
              <a class="source" href="mouse.html">
                mouse.js
              </a>
            
              
              <a class="source" href="touch.html">
                touch.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>touch.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">"use strict"</span>;

<span class="hljs-keyword">var</span> constants = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../constants'</span>);
<span class="hljs-keyword">var</span> state = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../statemachine'</span>);
<span class="hljs-keyword">var</span> input = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../input'</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">inSelection</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">var</span> state = state.activeStateId;
  <span class="hljs-keyword">return</span> (
    state === <span class="hljs-string">"INGAME_MOVEPATH"</span>
      || state === <span class="hljs-string">"INGAME_SELECT_TILE_TYPE_A"</span>
      || state === <span class="hljs-string">"INGAME_SELECT_TILE_TYPE_B"</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>|| controller.attackRangeVisible );</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">inMenu</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">var</span> state = cwt.Gameflow.activeStateId;
  <span class="hljs-keyword">return</span> ( state === <span class="hljs-string">"INGAME_MENU"</span> || state === <span class="hljs-string">"INGAME_SUBMENU"</span> );
}</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Called when an one finger tap occur</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">oneFingerTap</span><span class="hljs-params">(event, x, y)</span> </span>{
  x = cwt.Screen.offsetX + <span class="hljs-built_in">parseInt</span>(x / cwt.Screen.TILE_BASE, <span class="hljs-number">10</span>);
  y = cwt.Screen.offsetY + <span class="hljs-built_in">parseInt</span>(y / cwt.Screen.TILE_BASE, <span class="hljs-number">10</span>);

  <span class="hljs-keyword">if</span> (!inMenu()) {
    <span class="hljs-keyword">if</span> (inSelection()) {
      <span class="hljs-keyword">if</span> (cwt.Gameflow.globalData.selection.getValue(x, y) &gt; <span class="hljs-number">0</span>) {
        input.pushAction(input.TYPE_ACTION, x, y);
      } <span class="hljs-keyword">else</span> {
        input.pushAction(input.TYPE_CANCEL, x, y);
      }
    } <span class="hljs-keyword">else</span> {
      input.pushAction(input.TYPE_ACTION, x, y);
    }

  } <span class="hljs-keyword">else</span> {


    <span class="hljs-keyword">if</span> (event.target.id === <span class="hljs-string">"cwt_menu"</span>) {
      input.pushAction(input.TYPE_ACTION, constants.INACTIVE, constants.INACTIVE);
    } <span class="hljs-keyword">else</span> {
      input.pushAction(input.TYPE_CANCEL, constants.INACTIVE, constants.INACTIVE);
    }
  }
}</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Called when a two finger tap occur</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">twoFingerTap</span><span class="hljs-params">(event, x, y)</span> </span>{
  input.pushAction(input.TYPE_CANCEL, constants.INACTIVE, constants.INACTIVE);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Called when a swipe occur</p>
<p>if dx is not 0 then dy is 0
if dy is not 0 then dx is 0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">swipe</span><span class="hljs-params">(event, dx, dy)</span> </span>{
  <span class="hljs-keyword">var</span> key = <span class="hljs-literal">null</span>;

  <span class="hljs-keyword">if</span> (dx === <span class="hljs-number">1</span>) key = input.TYPE_RIGHT;
  <span class="hljs-keyword">if</span> (dy === <span class="hljs-number">1</span>) key = input.TYPE_DOWN;
  <span class="hljs-keyword">if</span> (dx === -<span class="hljs-number">1</span>) key = input.TYPE_LEFT;
  <span class="hljs-keyword">if</span> (dy === -<span class="hljs-number">1</span>) key = input.TYPE_UP;

  input.pushAction(key, ( cwt.Gameflow.state === <span class="hljs-string">"GAME_ROUND"</span> ) ? <span class="hljs-number">10</span> : <span class="hljs-number">1</span>, constants.INACTIVE);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Called when a drag occur. A drag happens when a one finger tap occurs
and wonâ€™t be released for a longer time. The drag happens when the
finger moves into one direction during the hold.</p>
<p>if dx is not 0 then dy is 0
if dy is not 0 then dx is 0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">oneFingerDrag</span><span class="hljs-params">(event, dx, dy)</span> </span>{
  <span class="hljs-keyword">var</span> key = <span class="hljs-literal">null</span>;

  <span class="hljs-keyword">if</span> (dx === <span class="hljs-number">1</span>) key = input.TYPE_RIGHT;
  <span class="hljs-keyword">if</span> (dy === <span class="hljs-number">1</span>) key = input.TYPE_DOWN;
  <span class="hljs-keyword">if</span> (dx === -<span class="hljs-number">1</span>) key = input.TYPE_LEFT;
  <span class="hljs-keyword">if</span> (dy === -<span class="hljs-number">1</span>) key = input.TYPE_UP;

  input.pushAction(key, <span class="hljs-number">1</span>, constants.INACTIVE);

  <span class="hljs-keyword">if</span> (!inMenu()) {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>ON THE</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span> (event.target.id === <span class="hljs-string">"cwt_menu"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>INSIDE THE MENU
MOVE SELECTION IN DIRECTION OF DRAG</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>OUTSIDE THE MENU</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      input.pushAction(input.TYPE_CANCEL, constants.INACTIVE, constants.INACTIVE);
    }
  }

}</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Called when a one finger tap is invoked and released after
a longer time ( &gt;= 500ms )
the position of the finger is fixed in a hold ( at least the finger
does not really moved )</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">holdOneFingerTap</span><span class="hljs-params">(event, x, y)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>OKAY FOR HOLD, this is tricky
Again separated for map and menu</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">if</span> (!inMenu()) {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>IF ATTACK RANGE VISIBLE IN RANGE</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    input.pushAction(input.TYPE_ACTION, x, y);</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p> OUTSIDE RANGE</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    input.pushAction(input.TYPE_CANCEL, x, y);</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>IF ATTACK RANGE IS NOT  VISIBLE</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    input.pushAction(input.TYPE_ACTION, x, y);

  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span> (event.target.id === <span class="hljs-string">"cwt_menu"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>WHEN HOLD HAPPENS IN THE MENU THEN
SLOWLY MOVE DOWN OR UP THROUGH
OPTIONS IN DIRECTION OF DRAGâ€¦</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>WHEN TAP HAPPENS OUTSIDE THE MENU</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    }
  }
}</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Called when the user pinches
delta is not 0 and
  delta &lt; 0 means pinch in
  delta &gt; 0 means pinch out</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pinch</span><span class="hljs-params">(event, delta)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>if (delta &lt; 0) controller.setScreenScale(controller.screenScale - 1);
else           controller.setScreenScale(controller.screenScale + 1);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>}</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>positions</p>
<ul>
<li>first finger</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> sx, sy;
<span class="hljs-keyword">var</span> ex, ey;</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <ul>
<li>second finger</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> s2x, s2y;
<span class="hljs-keyword">var</span> e2x, e2y;</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>timestamp</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> st;</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>pinch data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> pinDis, pinDis2;</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>drag data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> dragDiff = <span class="hljs-number">0</span>;
<span class="hljs-keyword">var</span> isDrag = <span class="hljs-literal">false</span>;

<span class="hljs-keyword">var</span> TOUCH_START_EVENT = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span> </span>{
  event.preventDefault();</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>SAVE POSITION AND CLEAR OLD DATA</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  sx = event.touches[<span class="hljs-number">0</span>].clientX;
  sy = event.touches[<span class="hljs-number">0</span>].clientY;
  ex = sx;
  ey = sy;
  isDrag = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>IF A SECOND FINGER IS ON THE SCREEN THEN REMEMBER ITS POSITION</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (event.touches.length === <span class="hljs-number">2</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>SAVE POSITION AND CLEAR OLD DATA</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    s2x = event.touches[<span class="hljs-number">1</span>].clientX;
    s2y = event.touches[<span class="hljs-number">1</span>].clientY;
    e2x = s2x;
    e2y = s2y;</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>REMEMBER DISTANCE BETWEEN FIRST AND SECOND FINGER</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> dx = <span class="hljs-built_in">Math</span>.abs(sx - s2x);
    <span class="hljs-keyword">var</span> dy = <span class="hljs-built_in">Math</span>.abs(sy - s2y);
    pinDis = <span class="hljs-built_in">Math</span>.sqrt(dx * dx + dy * dy)

  } <span class="hljs-keyword">else</span> s2x = -<span class="hljs-number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>REMEMBER TIME STAMP</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  st = event.timeStamp;
};

<span class="hljs-keyword">var</span> TOUCH_MOVE_EVENT = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span> </span>{
  event.preventDefault();

  <span class="hljs-keyword">var</span> dx, dy;
  ex = event.touches[<span class="hljs-number">0</span>].clientX;
  ey = event.touches[<span class="hljs-number">0</span>].clientY;</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>IF A SECOND FINGER IS ON THE SCREEN THEN REMEMBER ITS POSITION</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (event.touches.length === <span class="hljs-number">2</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>SAVE POSITION</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    e2x = event.touches[<span class="hljs-number">1</span>].clientX;
    e2y = event.touches[<span class="hljs-number">1</span>].clientY;</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>REMEMBER NEW DISTANCE BETWEEN FIRST AND SECOND FINGER
TO BE ABLE TO CALCULATION A PINCH MOVE IF TOUCH END EVENT
WILL BE TRIGGERED</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    dx = <span class="hljs-built_in">Math</span>.abs(ex - e2x);
    dy = <span class="hljs-built_in">Math</span>.abs(ey - e2y);
    pinDis2 = <span class="hljs-built_in">Math</span>.sqrt(dx * dx + dy * dy)
  } <span class="hljs-keyword">else</span> s2x = -<span class="hljs-number">1</span>;

  dx = <span class="hljs-built_in">Math</span>.abs(sx - ex);
  dy = <span class="hljs-built_in">Math</span>.abs(sy - ey);
  <span class="hljs-keyword">var</span> d = <span class="hljs-built_in">Math</span>.sqrt(dx * dx + dy * dy);
  <span class="hljs-keyword">var</span> timeDiff = event.timeStamp - st;

  <span class="hljs-keyword">if</span> (d &gt; <span class="hljs-number">16</span>) {

    <span class="hljs-keyword">if</span> (timeDiff &gt; <span class="hljs-number">300</span>) {

      isDrag = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">if</span> (dragDiff &gt; <span class="hljs-number">75</span>) {
        <span class="hljs-keyword">if</span> (dx &gt; dy) oneFingerDrag(event, (sx &gt; ex) ? -<span class="hljs-number">1</span> : +<span class="hljs-number">1</span>, <span class="hljs-number">0</span>);
        <span class="hljs-keyword">else</span>         oneFingerDrag(event, <span class="hljs-number">0</span>, (sy &gt; ey) ? -<span class="hljs-number">1</span> : +<span class="hljs-number">1</span>);
        dragDiff = <span class="hljs-number">0</span>;
        sx = ex;
        sy = ey;
      } <span class="hljs-keyword">else</span> {
        dragDiff += timeDiff;
      }
    }
  }
};

<span class="hljs-keyword">var</span> TOUCH_END_EVENT = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event)</span> </span>{
  event.preventDefault();</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>CALCULATE DISTANCE AND TIME GAP BETWEEN START AND END EVENT</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> dx = <span class="hljs-built_in">Math</span>.abs(sx - ex);
  <span class="hljs-keyword">var</span> dy = <span class="hljs-built_in">Math</span>.abs(sy - ey);
  <span class="hljs-keyword">var</span> d = <span class="hljs-built_in">Math</span>.sqrt(dx * dx + dy * dy);
  <span class="hljs-keyword">var</span> timeDiff = event.timeStamp - st;</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>IS IT A TWO PINCH GESTURE?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (s2x !== -<span class="hljs-number">1</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Math</span>.abs(pinDis2 - pinDis) &lt;= <span class="hljs-number">32</span>) {
      twoFingerTap(event, ex, ey);
    } <span class="hljs-keyword">else</span> pinch(event, (pinDis2 &lt; pinDis) ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>controller.inputCoolDown = 500;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span> (d &lt;= <span class="hljs-number">16</span>) {
      <span class="hljs-keyword">if</span> (timeDiff &lt;= <span class="hljs-number">500</span>) oneFingerTap(event, ex, ey);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (timeDiff &lt;= <span class="hljs-number">300</span>) {
      <span class="hljs-keyword">if</span> (dx &gt; dy) swipe(event, (sx &gt; ex) ? -<span class="hljs-number">1</span> : +<span class="hljs-number">1</span>, <span class="hljs-number">0</span>);
      <span class="hljs-keyword">else</span>         swipe(event, <span class="hljs-number">0</span>, (sy &gt; ey) ? -<span class="hljs-number">1</span> : +<span class="hljs-number">1</span>);
    }
  }
};

exports.backend = <span class="hljs-keyword">new</span> input.InputBackend(
  <span class="hljs-literal">null</span>,
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">if</span> (constants.DEBUG) <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"enable touch"</span>);

    <span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">'touchstart'</span>, TOUCH_START_EVENT, <span class="hljs-literal">false</span>);
    <span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">'touchmove'</span>, TOUCH_MOVE_EVENT, <span class="hljs-literal">false</span>);
    <span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">'touchend'</span>, TOUCH_END_EVENT , <span class="hljs-literal">false</span>);
  },
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
    <span class="hljs-built_in">document</span>.removeEventListener(<span class="hljs-string">'touchstart'</span>, TOUCH_START_EVENT, <span class="hljs-literal">false</span>);
    <span class="hljs-built_in">document</span>.removeEventListener(<span class="hljs-string">'touchmove'</span>, TOUCH_MOVE_EVENT, <span class="hljs-literal">false</span>);
    <span class="hljs-built_in">document</span>.removeEventListener(<span class="hljs-string">'touchend'</span>, TOUCH_END_EVENT , <span class="hljs-literal">false</span>);
  }
);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
